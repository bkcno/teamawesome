webpackJsonp([2],{1:function(e,t,i){var s=i(0),n=i(2),a=n.View.extend({classLabel:"cdb.core.View",constructor:function(e){this.options=s.defaults(e,this.options),this._models=[],this._subviews={},n.View.call(this,e),a.viewCount++,a.views[this.cid]=this,this._created_at=new Date},add_related_model:function(e){if(!e)throw new Error("added non valid model");this._models.push(e)},addView:function(e){this._subviews[e.cid]=e,e._parent=this},removeView:function(e){delete this._subviews[e.cid]},clearSubViews:function(){s(this._subviews).each(function(e){e.clean()}),this._subviews={}},clean:function(){return this.trigger("clean"),this.clearSubViews(),this._parent&&(this._parent.removeView(this),this._parent=null),this.remove(),this.allOff(),a.viewCount--,delete a.views[this.cid],this},allOff:function(){this.off(),this.model&&this.model.off&&this.model.off(null,null,this);var e=this;s(this._models).each(function(t){t.off(null,null,e)}),this._models=[]},show:function(){this.$el.show()},hide:function(){this.$el.hide()},retrigger:function(e,t,i){i||(i=e);var s=this;t.bind&&t.bind(e,function(){s.trigger(i)},s),this.add_related_model(t)},killEvent:function(e){e&&e.preventDefault&&e.preventDefault(),e&&e.stopPropagation&&e.stopPropagation()},cleanTooltips:function(){this.$(".tipsy").remove()}},{viewCount:0,views:{},extendEvents:function(e){return function(){return s.extend(e,this.constructor.__super__.events)}},runChecker:function(){s.each(a.views,function(e){s.each(e,function(t,i){"_parent"!==i&&e.hasOwnProperty(i)&&t instanceof a&&void 0===e._subviews[t.cid]&&(console.log("========="),console.log("untracked view: "),console.log(t.el),console.log("parent"),console.log(e.el),console.log(" "))})})}});e.exports=a},1112:function(e,t,i){i(403),i(265),i(1558).attach(document.body);var s=i(3),n=i(0),a=i(131),o=i(1454),r=i(20),l=i(402),d=i(1450),h=i(138),c=i(1452),u=i(7),_=window.vizJSON,g=window.authTokens,p=window.mapzenApiKey,m=window.mapboxApiKey,f=window.stateJSON,w=window.layersData,v=window.baseURL,C=_.layers.some(function(e){return e.legends&&e.legends.length}),y=new a({base_url:v}),b=new o;b.resetByLayersData(w);var S=new c({title:_.title,description:u.stripHTML(_.description),showMenu:_.options.dashboard_menu,showLegends:_.options.legends&&C,showLayerSelector:!!_.options.layer_selector});r.init({visId:_.id,configModel:y}),s("#dashboard").prepend(S.render().$el);var M=n.findWhere(_.overlays,{type:"logo"}),B={no_cdn:!1,cartodb_logo:void 0!==M,renderMenu:_.options.dashboard_menu,share_urls:!0,authToken:g,layerSelectorEnabled:!0,mapzenApiKey:p,mapboxApiKey:m},D=h.getStateFromCurrentURL();D&&!n.isEmpty(D)?n.extend(B,{state:D}):f&&"{}"!==f&&n.extend(B,{state:f}),l.createDashboard(".js-embed-map",_,B,function(e,t){e&&console.error("Dashboard has some errors:",e);var i=t.getMap().map,n=_.options.scrollwheel,a=n?"enableScrollWheel":"disableScrollWheel";i&&i[a]&&i[a](),S.injectTitle(s(".js-embed-map"));var o=new d({deepInsightsDashboard:t,layerStyleCollection:b});window.embedIntegrations=o}),window.layerStyleCollection=b},114:function(e,t,i){var s=i(3),n={};n._isViewport=function(e){return s(window).width()<e},n.isMobileViewport=function(){return this._isViewport(480)},n.isTabletViewport=function(){return this._isViewport(760)},e.exports=n},131:function(e,t,i){var s=i(2),n=i(0);e.exports=s.Model.extend({defaults:{base_url:"/CHANGEME"},urlVersion:function(e,t,i){return t=t||"",this.get(e+"_"+t+"_url_version")||i||"v1"},getSqlApiUrl:function(e){return e=e||"v2",this._getSqlApiBaseUrl()+"/api/"+e+"/sql"},_getSqlApiBaseUrl:function(){return this.get("sql_api_template")?this.get("sql_api_template").replace("{user}",this.get("user_name")):this.get("sql_api_protocol")+"://"+this.get("user_name")+"."+this.get("sql_api_domain")+":"+this.get("sql_api_port")},dataServiceEnabled:function(e){var t=this.get("dataservices_enabled");return!!(t&&n.size(t)&&e)&&!!t[e]},dataLibraryEnabled:function(){return this.get("data_library_enabled")},isHosted:function(){return this.get("cartodb_com_hosted")}})},132:function(e,t,i){function webpackContext(e){return i(webpackContextResolve(e))}function webpackContextResolve(e){var t=s[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var s={"./af":141,"./af.js":141,"./ar":148,"./ar-dz":142,"./ar-dz.js":142,"./ar-kw":143,"./ar-kw.js":143,"./ar-ly":144,"./ar-ly.js":144,"./ar-ma":145,"./ar-ma.js":145,"./ar-sa":146,"./ar-sa.js":146,"./ar-tn":147,"./ar-tn.js":147,"./ar.js":148,"./az":149,"./az.js":149,"./be":150,"./be.js":150,"./bg":151,"./bg.js":151,"./bn":152,"./bn.js":152,"./bo":153,"./bo.js":153,"./br":154,"./br.js":154,"./bs":155,"./bs.js":155,"./ca":156,"./ca.js":156,"./cs":157,"./cs.js":157,"./cv":158,"./cv.js":158,"./cy":159,"./cy.js":159,"./da":160,"./da.js":160,"./de":163,"./de-at":161,"./de-at.js":161,"./de-ch":162,"./de-ch.js":162,"./de.js":163,"./dv":164,"./dv.js":164,"./el":165,"./el.js":165,"./en-au":166,"./en-au.js":166,"./en-ca":167,"./en-ca.js":167,"./en-gb":168,"./en-gb.js":168,"./en-ie":169,"./en-ie.js":169,"./en-nz":170,"./en-nz.js":170,"./eo":171,"./eo.js":171,"./es":173,"./es-do":172,"./es-do.js":172,"./es.js":173,"./et":174,"./et.js":174,"./eu":175,"./eu.js":175,"./fa":176,"./fa.js":176,"./fi":177,"./fi.js":177,"./fo":178,"./fo.js":178,"./fr":181,"./fr-ca":179,"./fr-ca.js":179,"./fr-ch":180,"./fr-ch.js":180,"./fr.js":181,"./fy":182,"./fy.js":182,"./gd":183,"./gd.js":183,"./gl":184,"./gl.js":184,"./gom-latn":185,"./gom-latn.js":185,"./he":186,"./he.js":186,"./hi":187,"./hi.js":187,"./hr":188,"./hr.js":188,"./hu":189,"./hu.js":189,"./hy-am":190,"./hy-am.js":190,"./id":191,"./id.js":191,"./is":192,"./is.js":192,"./it":193,"./it.js":193,"./ja":194,"./ja.js":194,"./jv":195,"./jv.js":195,"./ka":196,"./ka.js":196,"./kk":197,"./kk.js":197,"./km":198,"./km.js":198,"./kn":199,"./kn.js":199,"./ko":200,"./ko.js":200,"./ky":201,"./ky.js":201,"./lb":202,"./lb.js":202,"./lo":203,"./lo.js":203,"./lt":204,"./lt.js":204,"./lv":205,"./lv.js":205,"./me":206,"./me.js":206,"./mi":207,"./mi.js":207,"./mk":208,"./mk.js":208,"./ml":209,"./ml.js":209,"./mr":210,"./mr.js":210,"./ms":212,"./ms-my":211,"./ms-my.js":211,"./ms.js":212,"./my":213,"./my.js":213,"./nb":214,"./nb.js":214,"./ne":215,"./ne.js":215,"./nl":217,"./nl-be":216,"./nl-be.js":216,"./nl.js":217,"./nn":218,"./nn.js":218,"./pa-in":219,"./pa-in.js":219,"./pl":220,"./pl.js":220,"./pt":222,"./pt-br":221,"./pt-br.js":221,"./pt.js":222,"./ro":223,"./ro.js":223,"./ru":224,"./ru.js":224,"./sd":225,"./sd.js":225,"./se":226,"./se.js":226,"./si":227,"./si.js":227,"./sk":228,"./sk.js":228,"./sl":229,"./sl.js":229,"./sq":230,"./sq.js":230,"./sr":232,"./sr-cyrl":231,"./sr-cyrl.js":231,"./sr.js":232,"./ss":233,"./ss.js":233,"./sv":234,"./sv.js":234,"./sw":235,"./sw.js":235,"./ta":236,"./ta.js":236,"./te":237,"./te.js":237,"./tet":238,"./tet.js":238,"./th":239,"./th.js":239,"./tl-ph":240,"./tl-ph.js":240,"./tlh":241,"./tlh.js":241,"./tr":242,"./tr.js":242,"./tzl":243,"./tzl.js":243,"./tzm":245,"./tzm-latn":244,"./tzm-latn.js":244,"./tzm.js":245,"./uk":246,"./uk.js":246,"./ur":247,"./ur.js":247,"./uz":249,"./uz-latn":248,"./uz-latn.js":248,"./uz.js":249,"./vi":250,"./vi.js":250,"./x-pseudo":251,"./x-pseudo.js":251,"./yo":252,"./yo.js":252,"./zh-cn":253,"./zh-cn.js":253,"./zh-hk":254,"./zh-hk.js":254,"./zh-tw":255,"./zh-tw.js":255};webpackContext.keys=function(){return Object.keys(s)},webpackContext.resolve=webpackContextResolve,e.exports=webpackContext,webpackContext.id=132},138:function(e,t,i){var s=i(936),n=i(0);e.exports={getURLFromState:function(e){var t=new s(this.getLocalURL());if(t.removeQuery("state"),!n.isEmpty(e)){var i=JSON.stringify(e);t.setQuery("state",i)}return t.toString()},getStateFromCurrentURL:function(){var e=this.getLocalURL();return this.getStateFromURL(e)},getStateFromURL:function(e){var t,i=new s(e),a={};return i.hasQuery("state")&&(t=i.query(!0).state,n.isEmpty(t)||(a=JSON.parse(decodeURIComponent(t)))),a},getLocalURL:n.constant(window.location.href)}},1450:function(e,t,i){var s=i(4),n=i(1453),a=["deepInsightsDashboard","layerStyleCollection"],o=function(e){s(e,a,this),this._getWidgets().each(function(e){this._bindWidgetChanges(e)},this),n.trackLegends(this._getLayers())};o.prototype._bindWidgetChanges=function(e){e.bind("change:hasInitialState",function(e){e.bind("change:autoStyle",this._onWidgetAutoStyleChanged,this),e.isAutoStyle()&&(e.layerModel.get("initialStyle")?this._onWidgetAutoStyleChanged(e):e.layerModel.once("change:initialStyle",function(){this._onWidgetAutoStyleChanged(e)},this))},this)},o.prototype._onWidgetAutoStyleChanged=function(e){var t,i=this._getWidgets().any(function(e){return e.isAutoStyle()},this),s=e.isAutoStyle(),a=e.layerModel.id;s?(n.updateLegends(a),t=this._layerStyleCollection.findById(a),e.layerModel&&(e.layerModel.attributes.initialStyle=t.get("cartocss"))):i||n.resetLegends(a)},o.prototype._getLayer=function(e){return this.visMap().getLayerById(e.id)},o.prototype._getLayers=function(e){return this.visMap().layers},o.prototype.visMap=function(){return this._vis().map},o.prototype._getWidgets=function(){return this._deepInsightsDashboard._dashboard.widgets._widgetsCollection},o.prototype._vis=function(){return this._deepInsightsDashboard.getMap()},e.exports=o},1451:function(e,t,i){var s=i(0),n=i(2),a=i(1),o=i(2042),r=i(4),l=["title","description","showMenu"],d=a.extend({className:"CDB-Embed-overlay",events:{"click .js-toggle":"_toggle"},initialize:function(e){r(e,l,this),s.isUndefined(e.template)||(this._template=e.template),this._initModels(),this._initBinds()},render:function(){this.$el.empty();var e={title:this._title,description:this._description,legends:!0,showMenu:this._showMenu},t=this._renderOverlay(e);return this._template&&(t=this._renderTemplate(e)),this.$el.html(t),this},_renderOverlay:function(e){return o(e)},_renderTemplate:function(e){return this._template({content:this._renderOverlay(s.extend(e,{legends:!1}))})},_initModels:function(){this.model=new n.Model({collapsed:!1})},_initBinds:function(){this.listenTo(this.model,"change:collapsed",this._toggleCollapsed,this)},_toggle:function(){this.model.set("collapsed",!this.model.get("collapsed"))},_toggleCollapsed:function(){var e=this.model.get("collapsed");this.$(".CDB-Overlay-title").toggleClass("is-collapsed",e),this.$(".CDB-ArrowToogle").toggleClass("is-down",!e),this.$(".CDB-Overlay-inner").toggleClass("is-active",!e)}});e.exports=d},1452:function(e,t,i){var s=i(2),n=i(0),a=i(42),o=i(1),r=i(4),l=i(1455),d=i(2043),h=i(1451),c={map:"map",legends:"legends"},u={map:"map",legends:"legends",layers:"layers"},_=["title","description","showMenu","showLegends","showLayerSelector"],g=o.extend({module:"embed:embed-view",className:"CDB-Embed-view",initialize:function(e){if(r(e,_,this),this._onlyLayerSelector=!this._showLegends&&this._showLayerSelector,this._showLegends=this._showLegends||this._showLayerSelector,this._showLegends){var t=n.find(this._tabs,function(e){return e.isSelected});this._tabsModel=new s.Model({selected:t?t.name:c.map}),this._initBinds()}},render:function(){this.$el.html(d({title:this._title,description:this._description,showMenu:this._showMenu,showLegends:this._showLegends}));var e={name:c.map,title:u.map,isSelected:!0},t={name:c.legends,title:this._onlyLayerSelector?u.layers:c.legends};if(this._showLegends){var i=new l({model:this._tabsModel,tabs:[e,t]});this.addView(i),this.$(".js-tabs").replaceWith(i.render().$el)}return this},_initBinds:function(){this.listenTo(this._tabsModel,"change:selected",this._onSelectedTabChanged),window.addEventListener("resize",this.onWindowResized.bind(this),{passive:!0})},_onSelectedTabChanged:function(){var e=".js-embed-"+this._tabsModel.get("selected"),t=this.$(e);t.siblings().removeClass("is-active"),t.addClass("is-active");var i=t.find(".ps-container").get(0);i&&a.update(i)},injectTitle:function(e){var t=e.find(".CDB-Legends-canvasInner");this.$scrollShadowTop=e.find(".CDB-Legends-canvasShadow--top"),this.$scrollShadowBottom=e.find(".CDB-Legends-canvasShadow--bottom"),this.titleView=new h({title:this._title,description:this._description,showMenu:this._showMenu}),this.addView(this.titleView),this.listenTo(this.titleView.model,"change:collapsed",function(e){e.get("collapsed")?(this.$scrollShadowTop.removeClass("is-visible"),this.$scrollShadowBottom.removeClass("is-visible"),t.scrollTop(0),a.update(t.get(0))):t.get(0).scrollHeight>t.height()&&this.$scrollShadowBottom.addClass("is-visible")}),t.prepend(this.titleView.render().el),t.find(".CDB-LayerLegends").detach().appendTo(t.find(".CDB-Overlay-inner"))},onWindowResized:function(){window.innerWidth>599&&this._tabsModel.get("selected")!==c.map&&this._tabsModel.set({selected:c.map}),this.titleView&&window.innerWidth>1199&&this.titleView.model.set("collapsed",!1)}});e.exports=g},1453:function(e,t,i){var s,n=i(0),a=i(581),o=n.keys(a),r=["category","choropleth"],l={trackLegends:function(e){s={},n.each(e.models,function(e){var t,i={};null!=e.legends&&(t=e.legends,n.each(o,function(e){var s=t[e];!0===s.get("visible")&&(i[e]=s)}),s[e.id]=i)})},getLegends:function(){return s},updateLegends:function(e){var t=s[e];n.each(r,function(e){var i=t[e];i&&i.set({visible:!1})})},resetLegends:function(e){var t=s[e];n.each(t,function(e){e.set({visible:!0})})}};e.exports=l},1454:function(e,t,i){var s=i(2);e.exports=s.Collection.extend({model:function(e,t){var i={};return i.id=e.id,e.options.tile_style&&(i.cartocss=e.options.tile_style),new s.Model(i)},resetByLayersData:function(e){this.reset(e,{silent:!0})},findById:function(e){return this.findWhere({id:e})}})},1455:function(e,t,i){var s=i(1),n=i(2045),a=i(2044),o=i(4),r=["tabs"],l=s.extend({module:"embed:tabs:tabs-view",tagName:"nav",className:"CDB-Embed-tabs CDB-NavMenu js-tabs",events:{"click .js-tab":"_onTabClicked"},initialize:function(e){o(e,r,this),this.listenTo(this.model,"change:selected",this._onSelectedTabChanged)},render:function(){return this.$el.empty(),this.$el.html(n()),this._tabs.map(function(e){this.$(".js-tabs-container").append(a({name:e.name,title:e.title||e.name,isSelected:e.isSelected}))}.bind(this)),this},_onSelectedTabChanged:function(){var e=this.model.get("selected"),t=this.$('[data-tab="'+e+'"]');t.siblings().removeClass("is-selected"),t.addClass("is-selected")},_onTabClicked:function(e){var t=this.$(e.currentTarget),i=t.data("tab");this.model.set({selected:i})}});e.exports=l},20:function(e,t,i){var s=i(272);e.exports=function(){return{init:function(e){if(!e)throw new Error("visId, userId and configModel are required");if(!e.visId)throw new Error("visId is required");if(!e.configModel)throw new Error("configModel is required");this._userId=e.userId,this._visId=e.visId,this._configModel=e.configModel},track:function(e,t){if(!e)throw new Error("eventName is required");new s({eventName:e,eventProperties:t},{userId:this._userId,visId:this._visId,configModel:this._configModel}).save()}}}()},2042:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)__p+='<div class="CDB-Overlay-title',description||legends||(__p+=" is-collapsed"),__p+='">\n  <h1 class="CDB-Text CDB-Size-large u-ellipsis" title="'+(null==(__t=title)?"":__t)+'">'+(null==(__t=title)?"":__t)+"</h1>\n\n  ",(description||legends)&&(__p+='\n    <div class="CDB-Overlay-options">\n      <button class="CDB-Shape js-toggle u-lSpace">\n        <div class="CDB-ArrowToogle is-blue is-down is-mini"></div>\n      </button>\n    </div>\n  '),__p+="\n</div>\n\n",(description||legends)&&(__p+='\n  <div class="CDB-Overlay-inner is-active',legends||(__p+=" is-description"),__p+='">\n    ',description&&(__p+='<div class="CDB-Embed-description',legends&&(__p+=" is-legends"),__p+=' CDB-Text CDB-Size-medium u-altTextColor" title="'+(null==(__t=description)?"":__t)+'">'+(null==(__t=description)?"":__t)+"</div>"),__p+="\n  </div>\n"),__p+="\n";return __p}},2043:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)showMenu&&showLegends&&(__p+='\n  <header class="CDB-Embed-header ',showLegends||(__p+=" CDB-Embed-header--shadow "),__p+='">\n    <h1 class="CDB-Text CDB-Size-large u-ellipsis" title="'+(null==(__t=title)?"":__t)+'">'+(null==(__t=title)?"":__t)+"</h1>\n    ",description&&(__p+='<div class="CDB-Embed-description CDB-Text CDB-Size-medium u-altTextColor" title="'+(null==(__t=description)?"":__t)+'">'+(null==(__t=description)?"":__t)+"</div>"),__p+="\n  </header>\n"),__p+="\n\n",showLegends&&(__p+='\n  <div class="CDB-Embed-tabs CDB-NavMenu js-tabs"></div>\n'),__p+='\n\n<div class="CDB-Embed-content">\n  <div class="CDB-Embed-tab ',showMenu&&(__p+=" CDB-Embed-tab--menu "),__p+=' is-active js-embed-map"></div>\n\n  ',showLegends&&(__p+='\n    <div class="CDB-Embed-tab CDB-Embed-legends js-embed-legends"></div>\n  '),__p+="\n</div>\n";return __p}},2044:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)__p+='<li class="CDB-NavMenu-item js-tab',isSelected&&(__p+=" is-selected"),__p+='" data-tab="'+(null==(__t=name)?"":__t)+'">\n    <button class="CDB-NavMenu-link u-upperCase">'+(null==(__t=title)?"":__t)+"</button>\n</li>";return __p}},2045:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<ul class="CDB-NavMenu-inner CDB-NavMenu-inner--legends CDB-Text is-semibold CDB-Size-medium js-tabs-container"></ul>\n';return __p}},2091:function(e,t,i){i(403),e.exports=i(1112)},23:function(e,t,i){var s=i(0),n=i(35),a=i(5),o={second:{display:"HH:mm:ss",unit:"s"},minute:{display:"HH:mm - MMM Do, YYYY",unit:"m"},hour:{display:"HH:00 - MMM Do, YYYY",unit:"h"},day:{display:"MMM Do, YYYY",unit:"d"},week:{display:"MMM Do, YYYY",unit:"w"},month:{display:"MMM YYYY",unit:"M"},quarter:{display:"[Q]Q YYYY",unit:"Q"},year:{display:"YYYY",unit:"y"},decade:{display:"YYYY",unit:"y"}},r={};r.formatNumber=function(e,t){if(!s.isNumber(e)||0===e)return e;var i=n.format(".2s"),a=0,o=Math.abs(e);if(e>1e3)return e=i(e)+(t?" "+t:"");o>100?a=0:o>10?a=1:o>1?a=2:o>0&&(a=Math.max(Math.ceil(Math.abs(Math.log(o)/Math.log(10)))+2,3)),e=e.toFixed(a);var r=e.match(/(\.0+)$/);return r&&(e=e.replace(r[0],"")),e},r.formatDate=function(e){return n.time.format("%Y-%m-%d")(e)},r.formatTime=function(e){return n.time.format("%H:%M:%S %d/%m/%Y")(e)},r.timeFactory=function(e){return n.time.format(e)},r.formatValue=function(e){return s.isNumber(e)?r.formatNumber(e):s.isDate(e)?r.formatDate(e):e},r.timestampFactory=function(e,t){return function(i){if(!s.has(o,e))return"-";var n=o[e],r=a.unix(i).utc();return s.isFinite(t)&&r.utcOffset(t/60),r.format(n.display)}},e.exports=r},272:function(e,t,i){var s=i(2),n=i(0);e.exports=s.Model.extend({defaults:{eventName:"",eventProperties:{}},url:function(){return this._configModel.get("base_url")+"/api/v3/metrics"},initialize:function(e,t){if(!t.visId)throw new Error("visId is required");if(!t.configModel)throw new Error("configModel is required");this._userId=t.userId,this._visId=t.visId,this._configModel=t.configModel},toJSON:function(){return{name:this.get("eventName"),properties:n.extend({},this.get("eventProperties"),{visualization_id:this._visId,user_id:this._userId})}}})},297:function(e,t){e.exports=function(e,t,i){return t.split(".").reduce(function(e,t){return(e||{})[t]},e)||i}},298:function(e,t,i){var s=i(8),n=i(299),a=i(614),o=i(297),r=s.core.Model.extend({initialize:function(e,t,i){this.options=i||{},this.styles=i&&i.auto_style,this.dataviewModel=e,this.colors=new a(this.styles),this.layer=t},getStyle:function(){var e=this.layer.get("initialStyle");if(e)return r.FILL_SELECTORS.forEach(function(t){e=n.changeStyle(e,t,this._getFillColor(t))}.bind(this)),r.OPACITY_SELECTORS.forEach(function(t){e=n.changeStyle(e,t,this._getOpacity())}.bind(this)),n.replaceWrongSpaceChar(e)},_getColor:function(){return o(this.styles,"definition.color")},_getOpacity:function(){return o(this.styles,"definition.color.opacity")}});r.FILL_SELECTORS=["marker-fill","polygon-fill","line-color"],r.OPACITY_SELECTORS=["marker-fill-opacity","polygon-opacity","line-opacity"],e.exports=r},299:function(e,t,i){function generateCSSTreeFromCartoCSS(e){return n().use(a).process(e,{syntax:o})}function isPropertyIncluded(e,t){var i=generateCSSTreeFromCartoCSS(e),s=i.result.root,n=!1;return s&&s.walkDecls(t,function(e){var t=e.parent;isSelectorRule(t)&&!isMapnikGeometrySelectorRule(t)||(n=!0)}),n}function isSelectorRule(e){return"rule"===e.type&&-1!==e.selector.search(/\[(.)+\]/g)}function isMapnikGeometrySelectorRule(e){return isSelectorRule(e)&&-1!==e.selector.search("mapnik::geometry_type")}function isOutlineRule(e){return"rule"===e.type&&-1!==e.selector.search("::outline")}function replaceWrongSpaceChar(e){return e.replace(new RegExp(String.fromCharCode(160),"g")," ")}function changeStyle(e,t,i){if(s.isUndefined(i))return e;var n=generateCSSTreeFromCartoCSS(e),a=n.result.root,o=!1;return a?(a.walkDecls(t,function(e){var n=e.parent;isOutlineRule(n)&&s.contains(r,t)||(isSelectorRule(n)||o?e.remove():(e.value=i,o=!0))}),n.css):e}var s=i(0),n=i(99),a=i(732),o=i(723),r=["line-color","line-opacity"];e.exports={changeStyle:s.memoize(changeStyle,function(e,t,i){return e+t+i}),isPropertyIncluded:isPropertyIncluded,replaceWrongSpaceChar:replaceWrongSpaceChar}},300:function(e,t,i){var s=i(0),n=i(1),a=i(4),o=i(620),r=i(335),l=["dataviewModel","widgetModel","paginatorModel"];e.exports=n.extend({options:{paginator:!1,itemsPerPage:6},className:"CDB-Widget-list js-list",tagName:"ul",initialize:function(e){a(e,l,this),this._dataviewModel.get("sync_on_bbox_change")||this.$el.addClass("CDB-Widget-list--nodynamic"),this._initBinds()},render:function(){this.clearSubViews(),this.$el.empty();var e=this._dataviewModel.getData();return s.isEmpty(e)||0===s.size(e)?this._renderPlaceholder():this._renderList(),this},_initBinds:function(){this.listenTo(this._paginatorModel,"change:page",this.render),this.listenTo(this._widgetModel,"change:search",this.toggle),this.listenTo(this._widgetModel,"change:style change:autoStyle",this.render),this.listenTo(this._dataviewModel,"change:data",this.render),this.listenTo(this._dataviewModel,"change:sync_on_bbox_change",this.blockFiltering)},_renderPlaceholder:function(){this.$el.addClass("CDB-Widget-list--withBorders CDB-Widget-list--fake"),this.$el.append(r())},_renderList:function(){this._createList(),this.$el.removeClass("CDB-Widget-list--withBorders CDB-Widget-list--fake CDB-Widget-list--noresults"),this._renderItems()},_renderItems:function(){var e=this._paginatorModel.get("page"),t=e-1,i=this.pagesData[t];s.each(i,function(e){this._addItem(e)}.bind(this))},_createList:function(){this.pagesData={};var e=this._getData(),t=0;e.each(function(e,i){i%this.options.itemsPerPage==0&&(0!==i&&(t+=1),this.pagesData[t]=[]),this.pagesData[t].push(e)},this)},_getData:function(){return this._dataviewModel.getData()},_addItem:function(e){var t=new o({model:e,widgetModel:this._widgetModel,dataviewModel:this._dataviewModel});t.bind("itemClicked",this._setFilters,this),this.addView(t),this.$el.append(t.render().el)},_setFilters:function(e){var t=e.get("selected"),i=this._dataviewModel.filter,s=e.get("name");if(t)if(0===i.rejectedCategories.size()&&0===i.acceptedCategories.size()){var n=this._dataviewModel.getData();n.each(function(e){e.get("name")!==s&&e.set("selected",!1)}),i.accept(e.get("name"))}else e.set("selected",!1),i.reject(s);else e.set("selected",!0),i.accept(s);this._widgetModel.set("acceptedCategories",this._widgetModel._acceptedCategories().pluck("name"))},blockFiltering:function(e){e.changed.sync_on_bbox_change?this.$el.removeClass("CDB-Widget-list--nodynamic"):(this.$el.addClass("CDB-Widget-list--nodynamic"),this._dataviewModel.filter.acceptAll())},removeSelections:function(){this._dataviewModel.filter.acceptAll()},toggle:function(){this[this._widgetModel.isSearchEnabled()?"hide":"show"]()},show:function(){this.$el.removeClass("is-hidden")},hide:function(){this.$el.addClass("is-hidden")}})},301:function(e,t,i){var s=i(3),n=i(1),a=i(4),o=i(913),r=i(336),l=["dataviewModel","widgetModel","paginatorModel"];e.exports=n.extend({options:{itemsPerPage:6,template:o,paginator:!1},className:"CDB-Widget-nav CDB-Widget-contentSpaced",events:{"click .js-searchToggle":"_onSearchClicked","click .js-next":"_onNextPage","click .js-prev":"_onPrevPage"},initialize:function(e){a(e,l,this),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this._initViews(),this},_initBinds:function(){this.listenTo(this._paginatorModel,"change:page",this.render),this.listenTo(this._dataviewModel,"change:categoriesCount",this.render),this.listenTo(this._dataviewModel,"change:data change:searchData",this._onDataChanged),this.listenTo(this._widgetModel,"change:search",this.toggle)},_initViews:function(){var e=this._dataviewModel.getCount();if(e>5){var t=this.options.template;this.$el.html(t({categoriesCount:e})),this.options.paginator&&this.$el.append(r({currentPage:this._paginatorModel.get("page"),pages:this._totalPages()}))}else this._paginatorModel.set("page",1)},_setPage:function(){var e=this._totalPages();(this._paginatorModel.get("page")>e||this._paginatorModel.get("page")<1)&&this._paginatorModel.set({page:1},{silent:!0})},_onSearchClicked:function(){this._widgetModel.setupSearch()},_onDataChanged:function(){this._setPage(),this.render()},_onPrevPage:function(){this._changePage(-1)},_onNextPage:function(){this._changePage(1)},_changePage:function(e){var t=this._totalPages(),i=this._paginatorModel.get("page"),s=i+e;s>t&&(s=1),s<1&&(s=t),this._paginatorModel.set("page",s)},_totalPages:function(){return Math.ceil(this._dataviewModel.getSize()/this.options.itemsPerPage)},toggle:function(){this[this._widgetModel.isSearchEnabled()?"hide":"show"]()},hide:function(){this.$el.addClass("is-hidden")},show:function(){this.$el.removeClass("is-hidden")},clean:function(){s(window).unbind("resize."+this.cid),n.prototype.clean.call(this)}})},302:function(e,t,i){var s=i(3),n=i(0),a=i(35),o=i(699),r=i(647),l=i(1),d=i(23),h=i(612),c=i(114),u=function(e,t,i,s,n,a,o){var r=a+1*o;return"M "+e+" "+t+" L "+i+" "+s+" C "+(n+.1)+" "+r+" "+(n-.1)+" "+r+" "+e+" "+t+" z"};e.exports=l.extend({options:{showOnWidthChange:!0,chartBarColor:"#F2CC8F",labelsMargin:16,hasAxisTip:!1,minimumBarHeight:2,animationSpeed:750,handleWidth:8,handleRadius:3,divisionWidth:80,animationBarDelay:function(e,t){return Math.random()*(100+10*t)},transitionType:"elastic"},initialize:function(){if(this._originalData=this.options.originalData,!n.isNumber(this.options.height))throw new Error("height is required");if(!this.options.dataviewModel)throw new Error("dataviewModel is required");if(!this.options.layerModel)throw new Error("layerModel is required");if(!this.options.type)throw new Error("type is required");n.bindAll(this,"_selectBars","_adjustBrushHandles","_onBrushMove","_onBrushEnd","_onMouseMove","_onMouseOut"),this.forceResize=n.debounce(this._resizeToParentElement.bind(this),50),this.setElement(s('<svg class=""></svg>')[0]),this._widgetModel=this.options.widgetModel,this._dataviewModel=this.options.dataviewModel,this._layerModel=this.options.layerModel,this.canvas=a.select(this.el).style("overflow","visible").attr("width",0).attr("height",this.options.height),this.canvas.append("g").attr("class","CDB-WidgetCanvas"),this._setupModel(),this._setupBindings(),this._setupDimensions(),this._setupD3Bindings(),this._setupFillColor(),this.hide(),this._tooltipFormatter=d.formatNumber,this._createFormatter()},render:function(){return this._generateChart(),this._generateChartContent(),this},replaceData:function(e){this.model.set({data:e})},toggleLabels:function(e){this.model.set("showLabels",e)},chartWidth:function(){var e=this.model.get("margin");return Math.max(0,this.model.get("width")-e.left-e.right)},chartHeight:function(){var e=this.model.get("margin"),t=this.model.get("showLabels")?this.options.labelsMargin:0;return this.model.get("height")-e.top-e.bottom-t},getSelectionExtent:function(){if(this.brush&&this.brush.extent()){var e=this.brush.extent();return e[1]-e[0]}return 0},_resizeToParentElement:function(){if(this.$el.parent()){var e=this.isHidden();this.hide();var t=this.$el.parent(),i=t.parent&&t.parent()&&t.parent().length>0?t.parent():null,n=t.width()||0;this.model.get("animated")&&this.$el.siblings().each(function(){n-=s(this).width()}),i&&i.outerWidth&&this._isTabletViewport()&&(n-=i.outerWidth(!0)-i.width()),e?this.hide():this.show(),this.model.set("width",n)}},_onChangeLeftAxisTip:function(){this._updateAxisTip("left")},_onChangeRightAxisTip:function(){this._updateAxisTip("right")},_overlap:function(e,t){var i=e.node().getBoundingClientRect(),s=t.node().getBoundingClientRect();return!(i.right<s.left||i.left>s.right||i.bottom<s.top||i.top>s.bottom)},_updateTriangle:function(e,t,i,s,n){var o=!e||this._isTabletViewport()&&this._isTimeSeries()?1:-1,r=a.transform(t.attr("transform")),l=Math.min(14,n),d=s-l/2,h=e?Math.min(i+n-(d+l),0):Math.abs(Math.min(d-i,0)),c=[0,0],_=[l,0],g=[l/2-h,7*o];t.attr("d",u(c[0],c[1],_[0],_[1],g[0],g[1],o)),r.translate[0]=s-l/2+h,t.attr("transform",r.toString())},_updateAxisTip:function(e){var t=e+"_axis_tip",i="right"===e,s=!i,n="week"===this._dataviewModel.get("aggregation"),o=this.model.get(t);if(void 0!==o){var r=this.model.get("left_axis_tip"),l=this.model.get("right_axis_tip"),d=this.chart.select(".CDB-Chart-axisTipText.CDB-Chart-axisTip-"+e),h=this.chart.select(".CDB-Chart-axisTip.CDB-Chart-axisTip-"+e),c=this.chart.select(".CDB-Chart-axisTipRect.CDB-Chart-axisTip-"+e),u=this.chart.select(".CDB-Chart-handle.CDB-Chart-handle-"+e),_=u.select(".CDB-Chart-axisTipTriangle");if(d.data([o]).text(function(e){var i=this.formatter(e);return this._dataviewModel.trigger("on_update_axis_tip",{attr:t,text:i}),i}.bind(this)),d.node()){var g=d.node().getBBox(),p=g.width,m=p+6,f=this.options.handleWidth,w=this.barWidth,v=this.chartWidth();c.attr("width",m),d.attr("dx",3),d.attr("dy",g.height-Math.abs((g.height-17)/2));var C=a.transform(u.attr("transform")).translate,y=+C[0]+this.options.handleWidth/2,b=!i||this._isMobileViewport()&&this._isTimeSeries()?-26:this.chartHeight()+9.1-1;b=Math.floor(b);var S=m/2,M=(f+w)/2;M-=i?w:0,this._isDateTimeSeries()&&!n||(M=f/2);var B=M-S,D=y+B,x=D+m,T=B+S,j=x-(v+f);D<0&&(B-=D),j>0&&(B-=j);var k=s?r<=l:r<=l&&!(r===l&&this._isDateTimeSeries());this._showAxisTip(e,k),h.attr("transform","translate("+B+", "+b+")"),this._updateTriangle(i,_,B,T,m),this.model.get("dragging")&&this._isMobileViewport()&&this._isTimeSeries()&&this._showAxisTip(e,!0)}}},_onChangeData:function(){this.model.previous("data").length!==this.model.get("data").length?this.reset():this.refresh(),this._setupFillColor(),this._refreshBarsColor()},_onChangeRange:function(){var e=this.model.get("lo_index"),t=this.model.get("hi_index");0===e&&0===t||null===e&&null===t||(this.selectRange(e,t),this._adjustBrushHandles(),this._setAxisTipAccordingToBins(),this._selectBars(),this.trigger("on_brush_end",e,t))},_onChangeWidth:function(){var e=this.model.get("width");this.canvas.attr("width",e),this.chart.attr("width",e),this.options.showOnWidthChange&&e>0&&this.show(),this.reset();var t=this.model.get("lo_index"),i=this.model.get("hi_index");this.selectRange(t,i),this._updateAxisTip("left"),this._updateAxisTip("right")},_onChangeNormalized:function(){this.model.set("show_shadow_bars",!this.model.get("normalized")),this._generateShadowBars(),this.updateYScale(),this.refresh()},_onChangeHeight:function(){var e=this.model.get("height");this.$el.height(e),this.chart.attr("height",e),this.leftHandle.attr("height",e),this.rightHandle.attr("height",e),this.updateYScale(),this.reset()},_onChangeShowLabels:function(){this._axis.style("opacity",this.model.get("showLabels")?1:0)},_onChangePos:function(){var e=this.model.get("pos"),t=this.model.get("margin"),i=+e.x,s=+e.y;this.chart.transition().duration(150).attr("transform","translate("+(t.left+i)+", "+(t.top+s)+")")},_onChangeDragging:function(){this.chart.classed("is-dragging",this.model.get("dragging")),!this.model.get("dragging")&&this._isMobileViewport()&&this._isTimeSeries()&&(this._showAxisTip("right",!1),this._showAxisTip("left",!1))},_toggleAxisTip:function(e,t){var i=this.chart.select(".CDB-Chart-axisTipText.CDB-Chart-axisTip-"+e),s=this.chart.select(".CDB-Chart-axisTipRect.CDB-Chart-axisTip-"+e),n=this.chart.select(".CDB-Chart-handle.CDB-Chart-handle-"+e),a=n.select(".CDB-Chart-axisTipTriangle");i&&i.transition().duration(60).attr("opacity",t),s&&s.transition().duration(60).attr("opacity",t),a&&a.transition().duration(60).style("opacity",t)},_showAxisTip:function(e,t){this._toggleAxisTip(e,t?1:0)},_setAxisTipAccordingToBins:function(){var e=this._getValueFromBinIndex(this._getLoBarIndex()),t=this._getValueFromBinIndex(this._getHiBarIndex());this._isDateTimeSeries()&&(t=h.substractOneUnit(t,this._dataviewModel.get("aggregation"))),this._setAxisTip(e,t)},_setAxisTip:function(e,t){this.options.hasAxisTip&&this.model.set({left_axis_tip:e,right_axis_tip:t})},reset:function(){this._removeChartContent(),this._setupDimensions(),this._calcBarWidth(),this._generateChartContent(),this._generateShadowBars()},refresh:function(){this._createFormatter(),this._setupDimensions(),this._removeAxis(),this._generateAxis(),this._updateChart(),this._refreshBarsColor(),this.chart.select(".CDB-Chart-handles").moveToFront(),this.chart.select(".Brush").moveToFront()},resetIndexes:function(){this.model.set({lo_index:null,hi_index:null})},removeShadowBars:function(){this.model.set("show_shadow_bars",!1)},_removeShadowBars:function(){this.chart.selectAll(".CDB-Chart-shadowBars").remove()},_removeBars:function(){this.chart.selectAll(".CDB-Chart-bars").remove()},_removeBrush:function(){this.chart.selectAll(".Brush").remove(),this.chart.classed("is-selectable",!1),this._axis.classed("is-disabled",!1)},_removeLines:function(){this.chart.select(".CDB-Chart-lines").remove(),this.chart.select(".CDB-Chart-line--bottom").remove()},_removeChartContent:function(){this._removeBrush(),this._removeHandles(),this._removeBars(),this._removeAxis(),this._removeLines()},_generateChartContent:function(){this._generateAxis(),this._isTabletViewport()&&this._isTimeSeries()||this._generateLines(),this._generateBars(),this._isMobileViewport()&&this._isTimeSeries()||this._generateBottomLine(),this._generateHandles(),this._setupBrush()},_generateLines:function(){this._generateHorizontalLines(),this._generateVerticalLines()},_generateVerticalLines:function(){this.chart.select(".CDB-Chart-lines").append("g").selectAll(".CDB-Chart-line").data(this.verticalRange.slice(1,this.verticalRange.length-1)).enter().append("svg:line").attr("class","CDB-Chart-line").attr("y1",0).attr("x1",function(e){return e}).attr("y2",this.chartHeight()).attr("x2",function(e){return e})},_generateHorizontalLines:function(){this.chart.append("g").attr("class","CDB-Chart-lines").append("g").attr("class","y").selectAll(".CDB-Chart-line").data(this.horizontalRange.slice(0,this.horizontalRange.length-1)).enter().append("svg:line").attr("class","CDB-Chart-line").attr("x1",0).attr("y1",function(e){return e}).attr("x2",this.chartWidth()).attr("y2",function(e){return e})},_generateBottomLine:function(){this.chart.append("line").attr("class","CDB-Chart-line CDB-Chart-line--bottom").attr("x1",0).attr("y1",this.chartHeight()-1).attr("x2",this.chartWidth()-1).attr("y2",this.chartHeight()-1)},_setupD3Bindings:function(){a.selection.prototype.moveToBack=function(){return this.each(function(){var e=this.parentNode.firstChild;e&&this.parentNode.insertBefore(this,e)})},a.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})}},_setupModel:function(){this.model=new r({bounded:!1,showLabels:!0,data:this.options.data,height:this.options.height,display:!0,show_shadow_bars:this.options.displayShadowBars,margin:n.clone(this.options.margin),width:0,pos:{x:0,y:0},normalized:this.options.normalized,local_timezone:this.options.local_timezone})},_setupBindings:function(){this.listenTo(this.model,"change:data",this._onChangeData),this.listenTo(this.model,"change:display",this._onChangeDisplay),this.listenTo(this.model,"change:dragging",this._onChangeDragging),this.listenTo(this.model,"change:height",this._onChangeHeight),this.listenTo(this.model,"change:left_axis_tip",this._onChangeLeftAxisTip),this.listenTo(this.model,"change:lo_index change:hi_index",this._onChangeRange),this.listenTo(this.model,"change:pos",this._onChangePos),this.listenTo(this.model,"change:right_axis_tip",this._onChangeRightAxisTip),this.listenTo(this.model,"change:showLabels",this._onChangeShowLabels),this.listenTo(this.model,"change:show_shadow_bars",this._onChangeShowShadowBars),this.listenTo(this.model,"change:width",this._onChangeWidth),this.listenTo(this.model,"change:normalized",this._onChangeNormalized),this._widgetModel&&(this.listenTo(this._widgetModel,"change:autoStyle",this._refreshBarsColor),this.listenTo(this._widgetModel,"change:style",function(){this._setupFillColor(),this._refreshBarsColor()})),this._dataviewModel&&this.listenTo(this._dataviewModel,"change:offset change:localTimezone",function(){this.refresh()}),this.listenTo(this._layerModel,"change:cartocss",function(){this._areGradientsAlreadyGenerated()||this._setupFillColor()}),this._originalData&&this.listenTo(this._originalData,"change:data",function(){this.updateYScale(),this._removeShadowBars(),this._generateShadowBars()})},_setupDimensions:function(){this._setupScales(),this._setupRanges(),this.forceResize()},_getData:function(){return this._originalData&&this._originalData.getData()||this.model.get("data")},_getMaxData:function(e){return a.max(e,function(e){return n.isEmpty(e)?0:e.freq})},_getXScale:function(){return a.scale.linear().domain([0,100]).range([0,this.chartWidth()])},_getYScale:function(){var e=this.model.get("normalized")?this.model.get("data"):this._getData();return a.scale.linear().domain([0,this._getMaxData(e)]).range([this.chartHeight(),0])},updateXScale:function(){this.xScale=this._getXScale()},updateYScale:function(){this.yScale=this._getYScale()},resetYScale:function(){this.yScale=this._originalYScale},_getDataForScales:function(){return!this.model.get("bounded")&&this._originalData?this._originalData.getData():this.model.get("data")},_setupScales:function(){var e=this._getDataForScales();if(this.updateXScale(),this._originalYScale&&!this.model.get("normalized")||(this._originalYScale=this.yScale=this._getYScale()),e&&e.length){var t=e[0].start,i=e[e.length-1].end;this.xAxisScale=a.scale.linear().range([t,i]).domain([0,this.chartWidth()])}},_setupRanges:function(){this.verticalRange=this._calculateVerticalRangeDivisions(),this.horizontalRange=a.range(0,this.chartHeight()+this.chartHeight()/2,this.chartHeight()/2)},_calculateVerticalRangeDivisions:function(){return this._isDateTimeSeries()&&this.model.get("data").length>0?this._calculateTimelySpacedDivisions():this._calculateEvenlySpacedDivisions()},_calculateTimelySpacedDivisions:function(){this._calcBarWidth();for(var e=Math.round(this.chartWidth()/this.options.divisionWidth),t=Math.ceil(this.model.get("data").length/e),i=[0],s=0,a=0;a<e;a++)s=a<e-1?s+t:this.model.get("data").length,i.push(Math.ceil(this.xAxisScale.invert(this._getValueFromBinIndex(s))));if(i=n.uniq(i),i.length>=3){var o=n.last(i,2);o[1]-o[0]<this.options.divisionWidth&&(i=n.without(i,o[0]))}return i},_calculateEvenlySpacedDivisions:function(){var e=Math.round(this.chartWidth()/this.options.divisionWidth),t=this.chartWidth()/e,i=this.chartWidth()+t;return a.range(0,i,t).slice(0,e+1)},_calcBarWidth:function(){this.barWidth=this.chartWidth()/this.model.get("data").length},_generateChart:function(){var e=this.model.get("margin");this.chart=a.select(this.el).selectAll(".CDB-WidgetCanvas").append("g").attr("class","CDB-Chart").attr("transform","translate("+e.left+", "+e.top+")"),this.chart.classed(this.options.className||"",!0)},_onChangeShowShadowBars:function(){this.model.get("show_shadow_bars")?this._generateShadowBars():this._removeShadowBars()},_onChangeDisplay:function(){this.model.get("display")?this._show():this._hide()},hide:function(){this.model.set("display",!1)},show:function(){this.model.set("display",!0)},_hide:function(){this.$el.hide()},_show:function(){this.$el.show()},isHidden:function(){return!this.model.get("display")},_selectBars:function(){this.chart.selectAll(".CDB-Chart-bar").classed({"is-selected":function(e,t){return this._isBarChartWithinFilter(t)}.bind(this),"is-filtered":function(e,t){return!this._isBarChartWithinFilter(t)}.bind(this)})},_isBarChartWithinFilter:function(e){var t=this.brush.extent(),i=t[0],s=t[1],n=Math.floor(e*this.barWidth),a=Math.floor(n+this.barWidth),o=Math.floor(this.xScale(i)),r=Math.floor(this.xScale(s));return n>o&&n<r||a>o&&a<r||n<=o&&a>=r},_isDragging:function(){return this.model.get("dragging")},setAnimated:function(){return this.model.set("animated",!0)},_isAnimated:function(){return this.model.get("animated")},_move:function(e){this.model.set({pos:e})},expand:function(e){this.canvas.attr("height",this.model.get("height")+e),this._move({x:0,y:e})},contract:function(e){this.canvas.attr("height",e),this._move({x:0,y:0})},resizeHeight:function(e){this.model.set("height",e)},setNormalized:function(e){return this.model.set("normalized",!!e),this},removeSelection:function(){this.resetIndexes(),this.chart.selectAll(".CDB-Chart-bar").classed({"is-selected":!1,"is-filtered":!1}),this._refreshBarsColor(),this._removeBrush(),this._setupBrush()},selectRange:function(e,t){if(e||t){var i=this._dataviewModel.get("data");if(!i[e]||!i[t-1])return this.trigger("on_reset_filter");var s=this._getBarPosition(e),n=this._getBarPosition(t);this.model.set({lo_index:e,hi_index:t}),this._selectRange(s,n)}},_selectRange:function(e,t){this.chart.select(".Brush").transition().duration(this.brush.empty()?0:150).call(this.brush.extent([e,t])).call(this.brush.event)},_getLoBarIndex:function(){var e=this.brush.extent();return Math.round(this.xScale(e[0])/this.barWidth)},_getHiBarIndex:function(){var e=this.brush.extent();return Math.round(this.xScale(e[1])/this.barWidth)},_getBarIndex:function(){var e=a.event.sourceEvent.layerX;return Math.floor(e/this.barWidth)},_getBarPosition:function(e){return e*(100/this.model.get("data").length)},_setupBrush:function(){var e=a.svg.brush().x(this.xScale).on("brush",this._onBrushMove).on("brushend",this._onBrushEnd),t=this.chart.append("g").attr("class","Brush").call(e),i=this._isTabletViewport()&&this._isTimeSeries()?2*this.chartHeight():this.chartHeight();t.selectAll("rect").attr("y",0).attr("height",i),t.selectAll("rect.background").on("mouseout",this._onMouseOut).on("mousemove",this._onMouseMove),t.selectAll("rect").classed("ps-prevent-touchmove",!0),t.selectAll("g").classed("ps-prevent-touchmove",!0),this.brush=e,this.chart.selectAll("g.resize rect").attr("width",this.options.handleWidth).attr("x",-this.options.handleWidth/2)},_onBrushMove:function(){this.brush.empty()||(this.chart.classed("is-selectable",!0),this._axis.classed("is-disabled",!0),this.model.set({dragging:!0}),this._selectBars(),this._setupFillColor(),this._refreshBarsColor(),this._adjustBrushHandles(),this._updateAxisTip("left"),this._updateAxisTip("right"))},_onBrushEnd:function(){var e,t,i=this.model.get("data"),s=this.brush,n=this._getLoBarIndex(),o=this._getHiBarIndex();if(this.model.set({dragging:!1}),s.empty()&&this._isAnimated())return void this.trigger("on_brush_click",s.extent()[0]/100);if(e=this._getBarPosition(n),t=this._getBarPosition(o),a.event.sourceEvent){if(n===o&&(o>=i.length?(n=i.length-1,o=i.length):o+=1),this.model.set({lo_index:n,hi_index:o},{silent:!0}),this.model.trigger("change:lo_index"),a.event.sourceEvent&&void 0===e&&void 0===t){var r=this._getBarIndex();this.model.set({lo_index:r,hi_index:r+1})}this._setupFillColor(),this._refreshBarsColor()}},_onMouseOut:function(){this.chart.selectAll(".CDB-Chart-bar").classed("is-highlighted",!1).attr("fill",this._getFillColor.bind(this)),this.trigger("hover",{target:null})},_onMouseMove:function(){var e=a.event.offsetX-this.model.get("margin").left,t=Math.floor(e/this.barWidth),i=this.model.get("data");if(void 0!==i[t]&&null!==i[t]){var s=i[t].freq,n={},o=this.chart.select(".CDB-Chart-bar:nth-child("+(t+1)+")");if(o&&o.node()&&!o.classed("is-selected")){var r=t*this.barWidth+this.barWidth/2,l=this.yScale(s),d=this.chartHeight()-this.yScale(s);if(d<this.options.minimumBarHeight&&d>0&&(l=this.chartHeight()-this.options.minimumBarHeight),!this._isDragging()&&s>0){var h=this.formatter(s);n={target:o[0][0],top:l,left:r,data:h}}else n=null}else n=null;this.trigger("hover",n),this.chart.selectAll(".CDB-Chart-bar").classed("is-highlighted",!1).attr("fill",this._getFillColor.bind(this)),o&&o.node()&&(o.attr("fill",function(){return this._getHoverFillColor(i[t],t)}.bind(this)),o.classed("is-highlighted",!0))}},_adjustBrushHandles:function(){var e=this.brush.extent(),t=e[0],i=e[1];this._moveHandle(t,"left"),this._moveHandle(i,"right"),this._setAxisTipAccordingToBins()},_moveHandle:function(e,t){var i=this.chart.select(".CDB-Chart-handle-"+t),s=e.toFixed(5),n=this.xScale(s)-this.options.handleWidth/2,a=s>=0&&s<=100?"inline":"none";i.style("display",a).attr("transform","translate("+n+", 0)")},_generateAxisTip:function(e){var t=this.chart.select(".CDB-Chart-handle.CDB-Chart-handle-"+e),i="right"!==e||this._isMobileViewport()&&this._isTimeSeries()?-26:this.chartHeight()+9.1;i=Math.floor(i);var s="right"!==e||this._isMobileViewport()&&this._isTimeSeries()?-11:this.chartHeight()+9.1+2,n="right"===e?-1:1,a=7*n,o=t.selectAll("g").data([""]).enter().append("g").attr("class","CDB-Chart-axisTip CDB-Chart-axisTip-"+e).attr("transform","translate(0,"+i+")");t.append("path").attr("class","CDB-Chart-axisTipRect CDB-Chart-axisTipTriangle").attr("transform","translate("+(this.options.handleWidth/2-7)+", "+s+")").attr("d",u(0,0,14,0,7,a,n)).style("opacity","1"),o.append("rect").attr("class","CDB-Chart-axisTipRect CDB-Chart-axisTip-"+e).attr("rx","2").attr("ry","2").attr("opacity","1").attr("height",17),o.append("text").attr("class","CDB-Text CDB-Size-small CDB-Chart-axisTipText CDB-Chart-axisTip-"+e).attr("dy","11").attr("dx","0").attr("opacity","1").text(function(e){return e})},_isTabletViewport:function(){return c.isTabletViewport()},_generateHandle:function(e){var t=this._isTabletViewport()&&this._isTimeSeries()?2*this.chartHeight():this.chartHeight(),i={width:this.options.handleWidth,height:t,radius:this.options.handleRadius},s=this.chart.select(".CDB-Chart-handles").append("g").attr("class","CDB-Chart-handle CDB-Chart-handle-"+e);if(this.options.hasAxisTip&&this._generateAxisTip(e),this.options.hasHandles){s.append("rect").attr("class","CDB-Chart-handleRect").attr("width",i.width).attr("height",i.height).attr("rx",i.radius).attr("ry",i.radius);var n=this._isTabletViewport()&&this._isTimeSeries()?this.chartHeight():this.chartHeight()/2;n-=3;for(var a=(i.width-2)/2,o=0;o<3;o++)s.append("line").attr("class","CDB-Chart-handleGrip").attr("x1",a).attr("y1",n+3*o).attr("x2",a+2).attr("y2",n+3*o)}return s},_generateHandles:function(){this.chart.append("g").attr("class","CDB-Chart-handles"),this.leftHandle=this._generateHandle("left"),this.rightHandle=this._generateHandle("right")},_removeHandles:function(){this.chart.select(".CDB-Chart-handles").remove()},_removeAxis:function(){this.canvas.select(".CDB-Chart-axis").remove()},_generateAdjustAnchorMethod:function(e){return function(t,i){return 0===i?"start":i===e.length-1?"end":"middle"}},_generateAxis:function(){this._axis=this._generateNumericAxis(),this._onChangeShowLabels()},_generateNumericAxis:function(){function verticalToValue(t){return e.xAxisScale?e.xAxisScale(t):null}var e=this,t=this._generateAdjustAnchorMethod(this.verticalRange),i=this.chart.append("g").attr("class","CDB-Chart-axis CDB-Text CDB-Size-small");return i.append("g").selectAll(".Label").data(this.verticalRange).enter().append("text").attr("x",function(e){return e}).attr("y",function(){return e.chartHeight()+15}).attr("text-anchor",t).text(function(t){var i=verticalToValue(t);if(n.isFinite(i))return e.formatter(i)}),i},_getMinValueFromBinIndex:function(e){var t=this.model.get("data"),i=t[e];return i?null!=i.min?i.min:i.start:null},_getMaxValueFromBinIndex:function(e){var t=null,i=this.model.get("data"),s=i[e];return s&&(t=this._isDateTimeSeries()&&!n.isUndefined(s.next)?s.next:null!=s.min?s.max:s.end),t},_getValueFromBinIndex:function(e){if(!n.isNumber(e))return null;var t=null,i=!0,s=this.model.get("data");e>=s.length&&(e=s.length-1,i=!1);var a=s[e];return a&&(t=i?a.start:n.isFinite(a.next)?a.next:a.end),t},_getIndexFromValue:function(e){return n.findIndex(this.model.get("data"),function(t){return t.start<=e&&e<=t.end})},_getMaxFromData:function(){return this.model.get("data").length>0?n.last(this.model.get("data")).end:null},_calculateDataDomain:function(){var e,t,i,s,a=n.clone(this.model.get("data"));if(this._hasFilterApplied()){var o=this._getLoBarIndex(),r=this._getHiBarIndex()-1,l=a.slice(o,r);if(n.isNaN(o)||n.isNaN(r))return[0,0];if(i=this._getMinValueFromBinIndex(o),s=this._getMaxValueFromBinIndex(r),a[o]&&0===a[o].freq&&(e=n.find(l,function(e){return 0!==e.freq},this)),a[r]&&0===a[r].freq){var d=l.reverse();t=n.find(d,function(e){return 0!==e.freq},this)}}else i=this._getMinValueFromBinIndex(0),s=this._getMaxValueFromBinIndex(a.length-1),e=n.find(a,function(e){return 0!==e.freq}),t=n.find(a.reverse(),function(e){return 0!==e.freq});return i=e?null!=e.min?e.min:e.start:i,s=t?null!=t.max?t.max:t.end:s,[i,s]},_removeFillGradients:function(){a.select(this.el).select("defs").remove(),delete this._linearGradients},_areGradientsAlreadyGenerated:function(){return!!this._linearGradients},_generateFillGradients:function(){if(!this._widgetModel||!this._widgetModel.isAutoStyleEnabled())return!1;var e=this._widgetModel.getAutoStyle();if(n.isEmpty(e)||n.isEmpty(e.definition))return!1;var t=this,i=e.definition[Object.keys(e.definition)[0]],s=i&&i.color&&i.color.range,r=o.interpolateRgbBasis(s),l=n.map(s,function(e){return a.rgb(e).darker(.3).toString()}),d=o.interpolateRgbBasis(l),h=this.model.get("data"),c=this._calculateDataDomain(),u=a.scale.linear().domain(c).range([0,1]),_=a.select(this.el).append("defs");this._linearGradients=_.selectAll(".gradient").data(h).enter().append("linearGradient").attr("class","gradient").attr("id",function(e,i){return this.__scale__=a.scale.linear().range([t._getMinValueFromBinIndex(i),t._getMaxValueFromBinIndex(i)]).domain([0,1]),"bar-"+t.cid+"-"+i}).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%"),this._linearGradientsHover=_.selectAll(".gradient-hover").data(h).enter().append("linearGradient").attr("class","gradient-hover").attr("id",function(e,i){return this.__scale__=a.scale.linear().range([t._getMinValueFromBinIndex(i),t._getMaxValueFromBinIndex(i)]).domain([0,1]),"bar-"+t.cid+"-"+i+"-hover"}).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%"),this._linearGradients.selectAll("stop").data(a.range(5)).enter().append("stop").attr("offset",function(e,t){return(this.__offset__=Math.floor(t/4*100))+"%"}).attr("stop-color",function(){var e=this.parentNode.__scale__,t=u(e(this.__offset__/100));return r(t)}),this._linearGradientsHover.selectAll("stop").data(a.range(5)).enter().append("stop").attr("offset",function(e,t){return(this.__offset__=Math.floor(t/4*100))+"%"}).attr("stop-color",function(){var e=this.parentNode.__scale__,t=u(e(this.__offset__/100));return d(t)})},_setupFillColor:function(){this._removeFillGradients(),this._generateFillGradients()},_getFillColor:function(e,t){return this._widgetModel?this._widgetModel.isAutoStyle()?this._hasFilterApplied()&&!this._isBarChartWithinFilter(t)?"rgba(0, 0, 0, 0.06)":"url(#bar-"+this.cid+"-"+t+")":this._hasFilterApplied()?this._isBarChartWithinFilter(t)?"#2E3C43":"rgba(0, 0, 0, 0.06)":this._widgetModel.getWidgetColor()||this.options.chartBarColor:this.options.chartBarColor},_getHoverFillColor:function(e,t){var i=this._getFillColor(e,t);return this._widgetModel&&this._widgetModel.isAutoStyle()?"url(#bar-"+this.cid+"-"+t+"-hover)":a.rgb(i).darker(.3).toString()},_updateChart:function(){var e=this,t=this.model.get("data"),i=this.chart.selectAll(".CDB-Chart-bar").data(t);i.enter().append("rect").attr("class","CDB-Chart-bar").attr("fill",this._getFillColor.bind(this)).attr("x",function(t,i){return i*e.barWidth}).attr("y",e.chartHeight()).attr("height",0).attr("width",Math.max(0,this.barWidth-1)),i.transition().duration(200).attr("height",function(t){if(n.isEmpty(t))return 0;if(e._isMobileViewport()&&e._isTimeSeries())return 3;var i=e.chartHeight()-e.yScale(t.freq);return i<e.options.minimumBarHeight&&i>0&&(i=e.options.minimumBarHeight),i}).attr("y",function(t){if(n.isEmpty(t))return e.chartHeight();if(e._isMobileViewport()&&e._isTimeSeries())return e.chartHeight()/2+3;var i=e.chartHeight()-e.yScale(t.freq);return i<e.options.minimumBarHeight&&i>0?e.chartHeight()-e.options.minimumBarHeight:e.yScale(t.freq)}),i.exit().transition().duration(200).attr("height",function(){return 0}).attr("y",function(){return e.chartHeight()})},_refreshBarsColor:function(){this.chart.selectAll(".CDB-Chart-bar").classed("is-highlighted",!1).attr("fill",this._getFillColor.bind(this))},_isMobileViewport:function(){return c.isMobileViewport()},_generateBars:function(){var e=this,t=this.model.get("data");this._calcBarWidth();var i=(2*t.length-1>this.chartWidth()||this._isMobileViewport())&&this._isDateTimeSeries()?0:1,s=this.chart.append("g").attr("transform","translate(0, 0)").attr("class","CDB-Chart-bars").selectAll(".CDB-Chart-bar").data(t);s.enter().append("rect").attr("class","CDB-Chart-bar").attr("fill",this._getFillColor.bind(e)).attr("x",function(t,i){return i*e.barWidth}).attr("y",e.chartHeight()).attr("height",0).attr("data-tooltip",function(t){return e._tooltipFormatter(t.freq)}).attr("width",Math.max(1,this.barWidth-i)),s.transition().ease(this.options.transitionType).duration(this.options.animationSpeed).delay(this.options.animationBarDelay).transition().attr("height",function(t){if(n.isEmpty(t))return 0;if(e._isMobileViewport()&&e._isTimeSeries())return 3;var i=e.chartHeight()-e.yScale(t.freq);return i<e.options.minimumBarHeight&&i>0&&(i=e.options.minimumBarHeight),i}).attr("y",function(t){if(n.isEmpty(t))return e.chartHeight();if(e._isMobileViewport()&&e._isTimeSeries())return e.chartHeight()/2+3;var i=e.chartHeight()-e.yScale(t.freq);return i<e.options.minimumBarHeight&&i>0?e.chartHeight()-e.options.minimumBarHeight:e.yScale(t.freq)})},showShadowBars:function(){this.options.displayShadowBars&&this.model.set("show_shadow_bars",!0)},_generateShadowBars:function(){var e=this._getData();if(!e||!e.length||!this.model.get("show_shadow_bars")||this.model.get("normalized"))return void this._removeShadowBars();this._removeShadowBars();var t=this,i=a.scale.linear().domain([0,this._getMaxData(e)]).range([this.chartHeight(),0]),s=this.chartWidth()/e.length;this.chart.append("g").attr("transform","translate(0, 0)").attr("class","CDB-Chart-shadowBars").selectAll(".CDB-Chart-shadowBar").data(e).enter().append("rect").attr("class","CDB-Chart-shadowBar").attr("x",function(e,t){return t*s}).attr("y",function(e){if(n.isEmpty(e))return t.chartHeight();var s=t.chartHeight()-i(e.freq);return s<t.options.minimumBarHeight&&s>0?t.chartHeight()-t.options.minimumBarHeight:i(e.freq)}).attr("width",Math.max(.5,s-1)).attr("height",function(e){if(n.isEmpty(e))return 0;var s=t.chartHeight()-i(e.freq);return s<t.options.minimumBarHeight&&s>0&&(s=t.options.minimumBarHeight),s}),this.chart.selectAll(".CDB-Chart-shadowBars").moveToBack(),this.chart.selectAll(".CDB-Chart-lines").moveToBack()},_hasFilterApplied:function(){return null!=this.model.get("lo_index")&&null!=this.model.get("hi_index")},_isTimeSeries:function(){return 0===this.options.type.indexOf("time")},_isDateTimeSeries:function(){return"time-date"===this.options.type},_calculateDivisionWithByAggregation:function(e){switch(e){case"year":return 50;case"quarter":case"month":return 80;case"week":case"day":return 120;default:return 140}},_createFormatter:function(){this.formatter=d.formatNumber,this._isDateTimeSeries()&&(this.formatter=d.timestampFactory(this._dataviewModel.get("aggregation"),this._dataviewModel.getCurrentOffset()),this.options.divisionWidth=this._calculateDivisionWithByAggregation(this._dataviewModel.get("aggregation")))},unsetBounds:function(){this.model.set("bounded",!1),this.updateYScale(),this.contract(this.options.height),this.resetIndexes(),this.removeSelection(),this._setupFillColor()},setBounds:function(){this.model.set("bounded",!0),this.updateYScale(),this.expand(4),this.removeShadowBars()}})},303:function(e,t,i){var s=i(3),n=i(1),a=i(302),o=i(114),r=i(6);e.exports=n.extend({className:"CDB-Chart--histogram",options:{tooltipDataAttribute:"data-tooltip"},defaults:{histogramChartHeight:72,histogramChartMobileHeight:16},initialize:function(){if(!this.options.dataviewModel)throw new Error("dataviewModel is required");if(!this.options.layerModel)throw new Error("layerModel is required");this._timeSeriesModel=this.options.timeSeriesModel,this._dataviewModel=this.options.dataviewModel,this._layerModel=this.options.layerModel,this._rangeFilter=this.options.rangeFilter,this._originalData=this._dataviewModel.getUnfilteredDataModel(),this._initBinds()},render:function(){return this.clearSubViews(),this._createHistogramView(),this},selectRange:function(e,t){this._chartView.selectRange(e,t)},resetFilter:function(){this._rangeFilter.unsetRange()},_initBinds:function(){this.listenTo(this._dataviewModel,"change:data",this._onChangeData,this),this.listenTo(this._dataviewModel,"change:column",this.resetFilter,this),this.listenTo(this._timeSeriesModel,"change:normalized",this._onNormalizedChanged),this.listenTo(this._timeSeriesModel,"change:local_timezone",this._onChangeLocalTimezone),this.listenTo(this._timeSeriesModel,"forceResize",this._onForceResize),this.listenTo(this._rangeFilter,"change",this._onFilterChanged)},_toggleTooltip:function(e){if(!e||!e.target)return this._clearTooltip();this._showTooltip(e)},_showTooltip:function(e){this.tooltip&&e&&this.tooltip.getElement()===e.target||(this._clearTooltip(),this.tooltip=new r({el:e.target,title:function(){return this._getTooltipTitle(e)}.bind(this),trigger:"manual"}),this.tooltip.showTipsy(),this.addView(this.tooltip))},_getTooltipTitle:function(e){return s(e.target).attr(this.options.tooltipDataAttribute)},_clearTooltip:function(){this.tooltip&&(this.tooltip.hideTipsy(),this.removeView(this.tooltip),this.tooltip=void 0)},_createHistogramView:function(){this._chartView=this._instantiateChartView(),this.addView(this._chartView),this.$el.append(this._chartView.render().el),this._chartView.show(),this.listenTo(this._chartView,"on_brush_end",this._onBrushEnd,this),this.listenTo(this._chartView,"on_reset_filter",this.resetFilter,this),this.listenTo(this._chartView,"hover",this._toggleTooltip,this),this.listenTo(this._chartView.model,"change:width",this._onChangeChartWidth,this)},_instantiateChartView:function(){return new a({type:this._getChartType(),chartBarColor:this._timeSeriesModel.getWidgetColor()||"#F2CC8F",animationSpeed:100,margin:{top:this._getMarginTop(),right:4,bottom:4,left:this._getMarginLeft()},hasHandles:!0,handleWidth:8,hasAxisTip:!0,animationBarDelay:function(e,t){return 3*t},height:this.defaults.histogramChartHeight,dataviewModel:this._dataviewModel,layerModel:this._layerModel,data:this._dataviewModel.getData(),originalData:this._originalData,displayShadowBars:!this._timeSeriesModel.get("normalized"),normalized:!!this._timeSeriesModel.get("normalized"),widgetModel:this._timeSeriesModel,local_timezone:!!this._timeSeriesModel.get("local_timezone")})},_getChartType:function(){return"time-"+this._dataviewModel.getColumnType()},_onChangeData:function(){this._chartView&&(this._chartView.replaceData(this._dataviewModel.getData()),this._chartView.updateXScale(),this._chartView.updateYScale())},_onBrushEnd:function(e,t){var i=this._dataviewModel.getData();this._rangeFilter.setRange(i[e].start,i[t-1].end),this._timeSeriesModel.set({lo_index:e,hi_index:t})},_onChangeChartWidth:function(){var e=o.isTabletViewport();this._chartView.toggleLabels(!e);var t=e?this.defaults.histogramChartMobileHeight:this.defaults.histogramChartHeight;this._chartView.model.set("height",t)},_onNormalizedChanged:function(){this._chartView&&this._chartView.setNormalized(this._timeSeriesModel.get("normalized"))},_onChangeLocalTimezone:function(){this._dataviewModel.set("localTimezone",this._timeSeriesModel.get("local_timezone"))},_onForceResize:function(){this._chartView.forceResize()},_resetFilterInDI:function(){this._timeSeriesModel.set({min:void 0,max:void 0,lo_index:void 0,hi_index:void 0}),this._chartView.removeSelection()},_onFilterChanged:function(){this._rangeFilter.has("min")||this._rangeFilter.has("max")||this._resetFilterInDI()},_getMarginLeft:function(){return 4},_getMarginTop:function(){return o.isTabletViewport()?0:4}})},304:function(e,t,i){var s=i(8),n=i(1),a=i(35),o=i(927),r=i(23),l=i(77),d=i(925),h=i(6);e.exports=n.extend({className:"CDB-Widget-contentSpaced CDB-Widget-contentFull",events:{"click .js-clear":"_onClick"},options:{showClearButton:!0},initialize:function(e){if(!e.dataviewModel)throw new Error("dataviewModel is required");if(!e.layerModel)throw new Error("layerModel is required");if(!e.rangeFilter)throw new Error("rangeFilter is required");if(!e.timeSeriesModel)throw new Error("timeSeriesModel is required");if(void 0===e.selectedAmount)throw new Error("selectedAmount is required");this._timeSeriesModel=e.timeSeriesModel,this._dataviewModel=e.dataviewModel,this._rangeFilter=e.rangeFilter,this._selectedAmount=e.selectedAmount,this._layerModel=e.layerModel,this.model=new s.core.Model,this._createFormatter(),this._initBinds()},render:function(){var e=this._timeSeriesModel.get("title"),t=!this._rangeFilter.isEmpty();return this.$el.html(o({start:this.model.get("left_axis_tip")||this.formatter(this._rangeFilter.get("min")),end:this.model.get("right_axis_tip")||this.formatter(this._rangeFilter.get("max")),title:e,showClearButton:this.options.showClearButton&&t,showSelection:t})),this._animateValue(),this._initViews(),this},_initViews:function(){var e=new h({el:this.$el.find(".js-actions"),gravity:"auto"});this.addView(e)},_createFormatter:function(){this.formatter=r.formatNumber,"date"===this._dataviewModel.getColumnType()&&(this.formatter=r.timestampFactory(this._dataviewModel.get("aggregation"),this._dataviewModel.getCurrentOffset()))},_onLocalTimezoneChanged:function(){this._createFormatter(),this.render()},_animateValue:function(){var e=new l({el:this.$el}),t=this._rangeFilter.isEmpty()?"totalAmount":"filteredAmount",i=this._dataviewModel.get(t);e.animateFromValues.call(this,this._selectedAmount,i,".js-val",d,{formatter:r.formatNumber,templateData:{suffix:" Selected"}}),this._selectedAmount=i},_initBinds:function(){this.listenTo(this.model,"change:left_axis_tip change:right_axis_tip",this.render),this.listenTo(this._timeSeriesModel,"change:title",this.render),this.listenTo(this._timeSeriesModel,"change:local_timezone",this._onLocalTimezoneChanged),this.listenTo(this._dataviewModel,"change:totalAmount",this._animateValue),this.listenTo(this._dataviewModel,"on_update_axis_tip",this._onUpdateAxisTip),this.listenTo(this._rangeFilter,"change",this.render)},_onUpdateAxisTip:function(e){this.model.set(e.attr,e.text)},_setupScales:function(){var e=this._dataviewModel.get("data"),t=this._dataviewModel.getColumnType();this._scale="date"===t?a.time.scale().domain([1e3*e[0].start,1e3*e[e.length-1].end]).range([this._dataviewModel.get("start"),this._dataviewModel.get("end")]):a.scale.linear().domain([e[0].start,e[e.length-1].end]).range([this._dataviewModel.get("start"),this._dataviewModel.get("end")])},_onClick:function(){this.trigger("resetFilter",this)}})},305:function(e,t,i){var s=i(0),n=i(642),a=function(e){this.defs=[],s.each(e,function(e){this.addType(e)},this)};a.prototype.DEFAULT_CLASS_NAMES="CDB-Widget CDB-Widget--light",a.prototype.addType=function(e){if(!e.match){if(!e.type)throw new Error("def.type or def.match must be provided for createContentView to work");e.match=function(e){return e.get("type")===this.type}}if(!s.isFunction(e.createContentView))throw new Error("def.createContentView must be a function");this.defs.push(e)},a.prototype.createWidgetView=function(e){var t=s.find(this.defs,function(t){return t.match(e)});if(t){var i={className:this.DEFAULT_CLASS_NAMES,model:e,contentView:t.createContentView(e)};return new n(s.isFunction(t.customizeWidgetAttrs)?t.customizeWidgetAttrs(i):i)}},e.exports=a},335:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li>\n<li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li>\n<li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li>\n<li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li>\n';return __p}},336:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<section class="CDB-Widget-pagination">\n  <button class="CDB-Widget-paginationButton u-rSpace--m js-prev">\n    <svg width="6px" height="10px" viewBox="0 0 6 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n      <g fill="#1785FB">\n        <path d="M5.09530663,4.3528203 C5.12374481,4.37148693 5.15072296,4.39333837 5.17574487,4.41836028 C5.20217765,4.44479306 5.22503325,4.47380933 5.24426546,4.50470442 C5.4081023,4.70181793 5.39325947,4.99960853 5.21412378,5.17874423 C5.15044967,5.24241833 5.07410755,5.28556158 4.99327465,5.30793729 L0.85159735,9.44961458 C0.653891927,9.64732 0.339500325,9.64512912 0.144238179,9.44986697 C-0.0453133946,9.2603154 -0.0509109683,8.93790934 0.144490568,8.7425078 L4.10763557,4.7793628 L0.182869475,0.85459671 C-0.012532062,0.659195174 -0.00693448836,0.336789113 0.182617085,0.14723754 C0.377879231,-0.0480246061 0.692270834,-0.050215493 0.889976256,0.147489929 L5.09530663,4.3528203 Z" transform="translate(2.679181, 4.798552) scale(-1, 1) translate(-2.679181, -4.798552) "></path>\n      </g>\n    </svg>\n  </button>\n  <p class="CDB-Text CDB-Size-small is-semibold u-upperCase">\n    <span class="u-mainTextColor">'+__e(currentPage)+'</span>\n    <span class="u-altTextColor u-lSpace u-rSpace">of</span>\n    <span class="u-mainTextColor">'+__e(pages)+'</span>\n  </p>\n  <button class="CDB-Widget-paginationButton u-lSpace--m js-next">\n    <svg width="6px" height="10px" viewBox="0 0 6 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n      <g fill="#1785FB">\n        <path d="M5.28600662,4.78918286 C5.3144448,4.80784949 5.34142295,4.82970094 5.36644486,4.85472284 C5.39287764,4.88115562 5.41573324,4.91017189 5.43496545,4.94106698 C5.59880229,5.13818049 5.58395946,5.4359711 5.40482376,5.61510679 C5.34114966,5.6787809 5.26480754,5.72192414 5.18397463,5.74429985 L1.04229734,9.88597714 C0.844591917,10.0836826 0.530200314,10.0814917 0.334938168,9.88622953 C0.145386595,9.69667796 0.139789021,9.3742719 0.335190558,9.17887036 L4.29833556,5.21572536 L0.373569464,1.29095927 C0.178167927,1.09555773 0.183765501,0.773151675 0.373317075,0.583600101 C0.56857922,0.388337955 0.882970823,0.386147068 1.08067625,0.58385249 L5.28600662,4.78918286 Z"></path>\n      </g>\n    </svg>\n  </button>\n</section>\n';return __p}},337:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<ul class="CDB-Widget-chart CDB-Widget-chart--fake">\n  ';for(var i=0;i<15;i++)__p+='\n  <li class="CDB-Widget-chartItem CDB-Widget-chartItem--'+__e(_.sample(["small","medium","big"],1)[0])+' CDB-Widget-chartItem--fake"></li>\n  ';__p+="\n</ul>\n"}return __p}},338:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<div class="CDB-Widget-header CDB-Widget-header--timeSeries">\n  <div class="CDB-Widget-timeSeriesTimeInfo CDB-Widget-timeSeriesTimeInfo--fake"></div>\n</div>\n<div class="CDB-Widget-content CDB-Widget-content--',hasTorqueLayer?__p+="torqueTimeSeries":__p+="timeSeries",__p+=' u-flex u-alignCenter">\n  ',hasTorqueLayer&&(__p+='\n    <div class="CDB-Widget-timeSeriesFakeControl"></div>\n  '),__p+='\n  <div class="CDB-Widget-timeSeriesFakeChart ',hasTorqueLayer&&(__p+="CDB-Widget-timeSeriesFakeChart--torque"),__p+='">\n    ';for(var i=0;i<50;i++)__p+='\n      <div class="CDB-Widget-timeSeriesFakeChartItem" style="height: '+__e(Math.floor(100*Math.random()))+'%"></div>\n    ';__p+="\n  </div>\n</div>\n"}return __p}},342:function(e,t,i){(function(e){!function(e){function maybeCall(e,t,i){return"function"==typeof e?e.call(t,i):e}function isElementInDOM(e){for(;e=e.parentNode;)if(e==document)return!0;return!1}function Tipsy(t,i){this.$element=e(t),this.options=i,this.enabled=!0,this.fixTitle()}Tipsy.prototype={show:function(){var t=this.getTitle();if(t&&this.enabled){var i=this.tip();i.find(".tipsy-inner")[this.options.html?"html":"text"](t),i[0].className="tipsy",i.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body),this.options.className&&i.addClass(maybeCall(this.options.className,this.$element[0]));var s,n=e.extend({},this.$element.offset(),{width:this.$element[0].getBoundingClientRect().width,height:this.$element[0].getBoundingClientRect().height}),a=i[0].offsetWidth,o=i[0].offsetHeight,r=maybeCall(this.options.gravity,this.$element[0],i[0]);switch(r.charAt(0)){case"n":s={top:n.top+n.height+this.options.offset,left:n.left+n.width/2-a/2},mo={top:parseInt(n.top+n.height+this.options.offset+6),opacity:this.options.opacity};break;case"s":s={top:n.top-o-this.options.offset,left:n.left+n.width/2-a/2},mo={top:parseInt(n.top-o-this.options.offset-6),opacity:this.options.opacity};break;case"e":s={top:n.top+n.height/2-o/2,left:n.left-a-this.options.offset},mo={left:parseInt(n.left-a-this.options.offset-6),opacity:this.options.opacity};break;case"w":s={top:n.top+n.height/2-o/2,left:n.left+n.width+this.options.offset},mo={left:parseInt(n.left+n.width+this.options.offset+6),opacity:this.options.opacity}}2==r.length&&("w"==r.charAt(1)?s.left=n.left+n.width/2-15:s.left=n.left+n.width/2-a+15),i.css(s).addClass("tipsy-"+r),i.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+r.charAt(0),this.options.fade?i.stop().css({opacity:0,display:"block",visibility:"visible"}).animate(mo,200):i.css({visibility:"visible",opacity:this.options.opacity})}},hide:function(){switch(gravity=maybeCall(this.options.gravity,this.$element[0]),gravity.charAt(0)){case"n":mo={top:parseInt(this.tip().css("top"))+6,opacity:0};break;case"s":mo={top:parseInt(this.tip().css("top"))-6,opacity:0};break;case"e":mo={left:parseInt(this.tip().css("left"))-6,opacity:0};break;case"w":mo={left:parseInt(this.tip().css("left"))+6,opacity:0}}this.options.fade?this.tip().stop().animate(mo,200,function(){e(this).remove()}):this.tip().remove()},fixTitle:function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("original-title"))&&e.attr("original-title",e.attr("title")||"").removeAttr("title")},getTitle:function(){var e,t=this.$element,i=this.options;this.fixTitle();var e,i=this.options;return"string"==typeof i.title?e=t.attr("title"==i.title?"original-title":i.title):"function"==typeof i.title&&(e=i.title.call(t[0])),(e=(""+e).replace(/(^\s*|\s*$)/,""))||i.fallback},tip:function(){return this.$tip||(this.$tip=e('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>'),this.$tip.data("tipsy-pointee",this.$element[0])),this.$tip},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},remove:function(){this.enabled=!1,this.$tip&&this.$tip.remove()},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled}},e.fn.tipsy=function(t){function get(i){var s=e.data(i,"tipsy");return s||(s=new Tipsy(i,e.fn.tipsy.elementOptions(i,t)),e.data(i,"tipsy",s)),s}function enter(){var e=get(this);e.hoverState="in",0==t.delayIn?e.show():(e.fixTitle(),setTimeout(function(){"in"==e.hoverState&&e.show()},t.delayIn))}function leave(){var e=get(this);e.hoverState="out",0==t.delayOut?e.hide():setTimeout(function(){"out"==e.hoverState&&e.hide()},t.delayOut)}if(!0===t)return this.data("tipsy");if("string"==typeof t){var i=this.data("tipsy");return i&&i[t](),this}if(t=e.extend({},e.fn.tipsy.defaults,t),t.live||this.each(function(){get(this)}),"manual"!=t.trigger){var s=t.live?"live":"bind",n="hover"==t.trigger?"mouseenter":"focus",a="hover"==t.trigger?"mouseleave":"blur";this[s](n,enter)[s](a,leave)}return this},e.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:0,opacity:.8,title:"title",trigger:"hover"},e.fn.tipsy.revalidate=function(){e(".tipsy").each(function(){var t=e.data(this,"tipsy-pointee");t&&isElementInDOM(t)||e(this).remove()})},e.fn.tipsy.elementOptions=function(t,i){return e.metadata?e.extend({},i,e(t).metadata()):i},e.fn.tipsy.autoNS=function(){return e(this).offset().top>e(document).scrollTop()+e(window).height()/2?"s":"n"},e.fn.tipsy.autoWE=function(){return e(this).offset().left>e(document).scrollLeft()+e(window).width()/2?"e":"w"},e.fn.tipsy.autoBounds=function(t,i){return function(){var s={ns:i[0],ew:i.length>1&&i[1]},n=e(document).scrollTop()+t,a=e(document).scrollLeft()+t,o=e(this);return o.offset().top<n&&(s.ns="n"),o.offset().left<a&&(s.ew="w"),e(window).width()+e(document).scrollLeft()-o.offset().left<t&&(s.ew="e"),e(window).height()+e(document).scrollTop()-o.offset().top<t&&(s.ns="s"),s.ns+(s.ew?s.ew:"")}}}(e)}).call(t,i(3))},377:function(e,t){function webpackEmptyContext(e){throw new Error("Cannot find module '"+e+"'.")}webpackEmptyContext.keys=function(){return[]},webpackEmptyContext.resolve=webpackEmptyContext,e.exports=webpackEmptyContext,webpackEmptyContext.id=377},4:function(e,t,i){var s=i(0);e.exports=function(e,t,i){if(void 0===t)throw new Error("Opts are required");s.each(t,function(t){if(void 0===e[t])throw new Error(t+" is required");i["_"+t]=e[t]},i)}},402:function(e,t,i){e.exports={VERSION:"",createDashboard:i(603)}},45:function(e,t,i){var s=i(0),n=i(3),a=i(2),o=i(1);e.exports=o.extend({className:"CDB-Box-modalOverlay",events:{click:"_onOverlayClicked"},initialize:function(e){this.container=e&&e.container,this.onClickAction=e&&e.onClickAction,this.model=new a.Model({visible:!s.isUndefined(e&&e.visible)&&e.visible}),this._initBinds(),this.render()},_initBinds:function(){this.listenTo(this.model,"change:visible",this._onVisibilityChange)},render:function(){return(this.container||n(document.body)).append(this.$el),this.$el.toggle(this.isVisible()),this},_onOverlayClicked:function(){this.onClickAction&&this.onClickAction(),this.hide()},show:function(){this.model.set("visible",!0)},hide:function(){this.model.set("visible",!1)},toggle:function(){this.model.set("visible",!this.model.get("visible"))},isVisible:function(){return this.model.get("visible")},_onVisibilityChange:function(){this.$el.toggle(this.isVisible())}})},55:function(e,t,i){var s=i(610),n=i(264),a=new n({locale:"en",phrases:s.en}),o=a.t.bind(a),r={"aggregate-intersection":{title:o("analyses.aggregate-intersection.short-title")},"bounding-box":{title:o("analyses.bounding-box.short-title")},"bounding-circle":{title:o("analyses.bounding-circle.short-title")},buffer:{title:o("analyses.area-of-influence.short-title")},centroid:{title:o("analyses.centroid.short-title")},"convex-hull":{title:o("analyses.convex-hull.short-title")},"concave-hull":{title:o("analyses.concave-hull.short-title")},"data-observatory-measure":{title:o("analyses.data-observatory-measure.short-title")},"data-observatory-multiple-measures":{title:o("analyses.data-observatory-multiple-measures.short-title")},"filter-by-node-column":{title:o("analyses.filter-by-node-column.short-title")},"filter-category":{title:o("analyses.filter.short-title")},"filter-range":{title:o("analyses.filter.short-title")},"georeference-city":{title:o("analyses.georeference.short-title")},"georeference-ip-address":{title:o("analyses.georeference.short-title")},"georeference-country":{title:o("analyses.georeference.short-title")},"georeference-long-lat":{title:o("analyses.georeference.short-title")},"georeference-postal-code":{title:o("analyses.georeference.short-title")},"georeference-street-address":{title:o("analyses.georeference.short-title")},"georeference-admin-region":{title:o("analyses.georeference.short-title")},intersection:{title:o("analyses.filter-intersection.short-title")},kmeans:{title:o("analyses.kmeans.short-title")},"line-to-single-point":{title:o("analyses.connect-with-lines.short-title")},"line-source-to-target":{title:o("analyses.connect-with-lines.short-title")},"line-sequential":{title:o("analyses.connect-with-lines.short-title")},merge:{title:o("analyses.merge.short-title")},moran:{title:o("analyses.moran-cluster.short-title")},"routing-sequential":{title:o("analyses.routing.short-title")},"routing-to-layer-all-to-all":{title:o("analyses.routing.short-title")},"routing-to-single-point":{title:o("analyses.routing.short-title")},sampling:{title:o("analyses.sampling.short-title")},"spatial-markov-trend":{title:o("analyses.spatial-markov-trend.short-title")},"trade-area":{title:o("analyses.area-of-influence.short-title")},"weighted-centroid":{title:o("analyses.centroid.short-title")},closest:{title:o("analyses.find-nearest.short-title")},"deprecated-sql-function":{title:o("analyses.deprecated-sql-function.short-title")}},l=function(e){var t=""===e?"unknown":e;return r[t]||{title:o("analyses."+t)}};e.exports={MAP:r,title:function(e){return l(e).title}}},56:function(e,t,i){var s=i(0);e.exports=function(e){return s.escape(e)}},57:function(e,t,i){var s=i(0);e.exports={COLORS:["#11A579","#E83f74","#9F5DC8","#EF8205","#29B3B2","#E54F3B","#59BB12","#EF57BA","#E2AF00","#12AADE"],letter:function(e){if(!e||!s.isString(e))return"";var t=e.match(/^([a-z]+)/);return s.isArray(t)&&t[0]||""},getColorForLetter:function(e){if(!e)return this.COLORS[0];var t=e.charCodeAt(0)-97,i=(t/this.COLORS.length%1*10).toFixed();return this.COLORS[i]||this.COLORS[0]}}},58:function(e,t,i){var s=i(3),n=i(0),a=i(1),o=i(918),r=i(45);e.exports=a.extend({className:"CDB-Dropdown",events:{"click .js-toggleLocalTimezone":"_toggleLocalTimezone","click .js-toggleNormalized":"_toggleNormalized","click .js-toggleCollapsed":"_toggleCollapsed","click .js-removeWidget":"_removeWidget","click .js-editWidget":"_editWidget"},initialize:function(e){if(!e.target)throw new Error("target is not defined");this._target=this.options.target,this._$container=this.options.container,this._initBinds()},render:function(){var e=n.defaults(this.options.flags||{},{canCollapse:!0}),t=n.defaults({},this.model.attributes,{flags:e},{local_timezone:!1,normalized:!1,collapsed:!1,show_options:!1});return this.$el.html(o(t)),this._dropdownOverlay=new r({visible:!0,onClickAction:this._onGlobalClick.bind(this)}),this.addView(this._dropdownOverlay),this},_initBinds:function(){this.add_related_model(this.model),this.model.bind("change:widget_dropdown_open",this._onChangeOpen,this),this._$container.delegate(this._target,"click",n.bind(this._toggle,this))},_removeWidget:function(){this.model.trigger("removeWidget",this.model),this._toggle()},_editWidget:function(){this.model.trigger("editWidget",this.model),this._toggle()},_bindESC:function(){s(document).bind("keyup."+this.cid,n.bind(this._onKeyUp,this))},_unbindESC:function(){s(document).unbind("keyup."+this.cid)},_onGlobalClick:function(e){this.model.set("widget_dropdown_open",!1)},_onKeyUp:function(e){if(27===e.keyCode)return this.model.set("widget_dropdown_open",!1),!1},_onChangeOpen:function(){this.model.get("widget_dropdown_open")?this._open():this._close()},_toggleCollapsed:function(){var e=!this.model.get("collapsed");this.model.set("collapsed",e),this._toggle()},_toggleNormalized:function(){var e=!this.model.get("normalized");this.model.set("normalized",e),this._toggle()},_toggleLocalTimezone:function(){var e=!this.model.get("local_timezone");this.model.set("local_timezone",e),this._toggle()},_open:function(){this._bindESC(),this.render(),this._$container.append(this.$el),this.$el.show(),this._adjustVerticalPosition()},_adjustVerticalPosition:function(){this._getDropdownBottom()>this._getBodyHeight()&&this.$el.addClass("has-top-position")},_getDropdownBottom:function(){return this.$el.offset().top+this.$el.height()},_getBodyHeight:function(){return s("body").height()},_close:function(){this._unbindESC(),this._dropdownOverlay&&this._dropdownOverlay.clean(),this.$el.hide(),this.$el.removeClass("has-top-position")},_toggle:function(){this.model.set("widget_dropdown_open",!this.model.get("widget_dropdown_open"))},clean:function(){this.model.set("widget_dropdown_open",!1),this._unbindESC(),this._dropdownOverlay&&this._dropdownOverlay.clean(),this._$container.undelegate(this._target,"click"),a.prototype.clean.call(this)}})},581:function(e,t){var i={bubble:{legendType:"size"},category:{legendType:"color"},choropleth:{legendType:"color"},custom:{legendType:"color"},custom_choropleth:{legendType:"color"}};e.exports=i},6:function(e,t,i){var s=i(0),n=i(1);i(342),e.exports=n.extend({options:{gravity:"s",opacity:1,fade:!0},events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave"},initialize:function(e){if(!e.el)throw new Error("Element is needed to have tipsy tooltip working");this._mouseEnterAction=e.mouseEnterAction,this._mouseLeaveAction=e.mouseLeaveAction,this._tipsyOpenedManually="manual"===e.trigger,this._initTipsy()},_initTipsy:function(){var e=s.clone(this.options);"auto"===e.gravity&&(e.gravity=this.getOptimalGravity(e.gravityConfiguration&&e.gravityConfiguration.preferredGravities||["s","n","e","w"],e.gravityConfiguration&&e.gravityConfiguration.margin||0,window)),e.title||(e.title=this.getTitleFromDataAttribute),this.$el.tipsy(e),this.tipsy=this.$el.data("tipsy")},_onMouseEnter:function(){this._mouseEnterAction&&this._mouseEnterAction()},_onMouseLeave:function(){this._mouseLeaveAction&&this._mouseLeaveAction()},setOffset:function(e){this.tipsy.options.offset=e},showTipsy:function(){this.$el.tipsy("show")},hideTipsy:function(){this.$el.tipsy("hide")},getElement:function(){return this.el},getOptimalGravity:function(e,t,i){return function(n){if(!n)return e[0]||"n";var r=this,l=r.getBoundingClientRect(),d={n:"bottom",s:"top",w:"right",e:"left"},h={top:i.pageYOffset+t,right:i.innerWidth+i.pageXOffset-t,bottom:i.innerHeight+i.pageYOffset-t,left:i.pageXOffset+t},c={top:l.top-n.offsetHeight,right:l.left+l.width+n.offsetWidth,bottom:l.top+l.height+n.offsetHeight,left:l.left-n.offsetWidth},u="",_=s.find(e,function(e){var t=d[e],i=a(t,h[t],c[t]);return!i||"top"!==t&&"bottom"!==t||(u=o(d,h,c)),i});return _?_+u:e[0]}},getTitleFromDataAttribute:function(){return this.getAttribute("data-tooltip")},destroyTipsy:function(){this.tipsy&&(this.tipsy.hide(),this.$el.unbind("mouseleave mouseenter")),this._tipsyOpenedManually&&this.hideTipsy(),this.$el.removeData("tipsy"),delete this.tipsy},clean:function(){this.destroyTipsy()}});var a=function(e,t,i){return"top"===e||"left"===e?t<=i:"right"===e||"bottom"===e?t>=i:void 0},o=function(e,t,i){var n=s.filter(["e","w"],function(s){var n=e[s];return a(n,t[n],i[n])});return 1===n.length?n[0]:""}},603:function(e,t,i){var s=i(0),n=i(8),a=i(604),o=i(608),r=i(643),l=i(613),d=i(138),h=function(e,t,i,a){var h=document.querySelector(e);if(!h)throw new Error("no element found with selector "+e);i=i||{},i.renderMenu=!s.isBoolean(i.renderMenu)||i.renderMenu,i.autoStyle=!!s.isBoolean(i.autoStyle)&&i.autoStyle;var c=new r,u=new n.core.Model({title:t.title,description:t.description,updatedAt:t.updated_at,userName:t.user.fullname,userProfileURL:t.user.profile_url,userAvatarURL:t.user.avatar_url,renderMenu:i.renderMenu,autoStyle:i.autoStyle,showLogo:i.cartodb_logo,initialPosition:{bounds:t.bounds}}),_=new o({el:h,widgets:c,model:u}),g=i.state||d.getStateFromCurrentURL();g&&!s.isEmpty(g.map)&&(s.isArray(g.map.center)&&(t.center=g.map.center),s.isNumber(g.map.zoom)&&(t.zoom=g.map.zoom),g.map.ne&&g.map.sw&&(t.bounds=[g.map.ne,g.map.sw])),n.createVis(_.$("#map"),t,s.extend(i,{skipMapInstantiation:!0})).once("load",function(e){var i=g&&g.widgets||{},o=new l(c,e.dataviews),r={formula:o.createFormulaModel.bind(o),histogram:o.createHistogramModel.bind(o),"time-series":o.createTimeSeriesModel.bind(o),category:o.createCategoryModel.bind(o)};t.widgets.forEach(function(t){var a=s.extend({},t,t.options),o=r[t.type],l=i[t.id];if(s.isFunction(o)){var d,h;t.layer_id?d=e.map.layers.get(t.layer_id):Number.isInteger(t.layerIndex)&&(d=e.map.layers.at(t.layerIndex)),t.source&&t.source.id&&(h=e.analysis.findNodeById(t.source.id),a.source=h),o(a,d,l)}else n.log.error("No widget found for type "+t.type)}),_.render();var d={dashboardView:_,widgets:o,areWidgetsInitialised:function(){var e=o.getCollection();return!(e.size()>0)||e.hasInitialState()},vis:e};e.instantiateMap({success:function(){a&&a(null,d)},error:function(e){a&&a(new Error(e),d)}})})};e.exports=function(e,t,i,o){function _load(t){h(e,t,i,function(e,t){var n=new a(t);i.share_urls&&n.onStateChanged(s.debounce(function(e,t){window.history.replaceState("Object","Title",t)},500)),o&&o(e,n)})}var r=arguments,l=r[r.length-1];s.isFunction(l)&&(o=l),"string"==typeof t?n.core.Loader.get(t,function(e){e?_load(e):o&&o(new Error("Error fetching viz.json file: "+t))}):_load(t)}},604:function(e,t,i){function Dashboard(e){this._dashboard=e,this.onDataviewsFetched(function(){e.widgets._widgetsCollection.initialState(),e.widgets._widgetsCollection.each(function(e){e&&e.applyInitialState&&e.applyInitialState()})})}var s=i(138),n=i(0);Dashboard.prototype={getView:function(){return this._dashboard.dashboardView},getMap:function(){return this._dashboard.vis},reloadMap:function(){this.getMap().reload()},forceResize:function(){this._dashboard.widgets.getCollection().each(function(e){e.forceResize()})},getWidgets:function(){return this._dashboard.widgets.getList()},getDashboardURL:function(){return s.getURLFromState(this.getState())},getState:function(){var e={},t=this.getMapState();n.isEmpty(t)||(e.map=t);var i=this._dashboard.widgets.getCollection(),s=i.getStates();return n.isEmpty(s)||(e.widgets=s),e},getMapState:function(){var e=this._dashboard.vis.map,t=e.getViewBounds(),i=e.get("center"),s=e.get("zoom");return{ne:t[0],sw:t[1],center:i,zoom:s}},setState:function(e){this._dashboard.widgets.setWidgetsState(e.widgets),this._dashboard.vis.mapvis.map.setBounds([e.map.ne,e.map.sw])},onDataviewsFetched:function(e){this._dashboard.areWidgetsInitialised()?e&&e():this._dashboard.vis.once("dataviewsFetched",function(){e&&e()})},onStateChanged:function(e){this.onDataviewsFetched(function(){e&&this._bindChange(e)}.bind(this))},_bindChange:function(e){this._dashboard.widgets.getCollection().bind("change",function(){e(this.getState(),this.getDashboardURL())},this),this._dashboard.vis.map.bind("change",function(){e(this.getState(),this.getDashboardURL())},this)},getWidget:function(e){return this._dashboard.widgets.get(e)},createCategoryWidget:function(e,t){return this._dashboard.widgets.createCategoryModel(e,t,null)},createHistogramWidget:function(e,t){return this._dashboard.widgets.createHistogramModel(e,t,null)},createFormulaWidget:function(e,t){return this._dashboard.widgets.createFormulaModel(e,t,null)},createTimeSeriesWidget:function(e,t){return this._dashboard.widgets.createTimeSeriesModel(e,t,null)}},e.exports=Dashboard},605:function(e,t,i){var s=i(0),n=i(1),a=i(305),o=i(632),r=i(634);e.exports=n.extend({className:"CDB-Dashboard-belowMap",initialize:function(e){this._widgetViewFactory=new a([{match:function(e){if("time-series"===e.get("type")){var t=e.dataviewModel,i=e.layerModel;return t&&"torque"===i.get("type")&&!0===e.get("animated")}return!1},createContentView:function(e){return new r({model:e})},customizeWidgetAttrs:function(e){return e.className+=" CDB-Widget--timeSeries",e}},{type:"time-series",createContentView:function(e){return new o({model:e})},customizeWidgetAttrs:function(e){return e.className+=" CDB-Widget--timeSeries",e}}]),this._widgets=e.widgets,this._widgets.bind("add",this._maybeRenderWidgetView,this),this._widgets.bind("reset",this.render,this),this._widgets.bind("add reset remove",this._onWidgetsChange,this),this.add_related_model(this._widgets)},render:function(){return this.clearSubViews(),this.$el.empty(),this._widgets.each(this._maybeRenderWidgetView,this),this._toggleVisiblity(),this},_maybeRenderWidgetView:function(e){var t=this._widgetViewFactory.createWidgetView(e);t&&(this.addView(t),this.$el.append(t.render().el))},_toggleVisiblity:function(){this.$el.toggle(!s.isEmpty(this._subviews))},_onWidgetsChange:function(){this._widgets.each(function(e){e.forceResize()}),this._toggleVisiblity()}})},606:function(e,t,i){var s=i(8),n=i(1),a=i(0),o=i(3),r=i(904),l=i(5),d=i(42),h=n.extend({className:"CDB-Dashboard-menu",events:{"click .js-toggle-view":"_toogleView"},initialize:function(){this.viewModel=new s.core.Model({open:!1,footer:o(window).width()<1201}),this._initBinds()},_initBinds:function(){this.listenTo(this.viewModel,"change",this.render),this._resize=a.debounce(this._onResizeWindow.bind(this),20),o(window).on("resize",this._resize)},render:function(){var e=this.model.get("title"),t=this.viewModel.get("open"),i=this.viewModel.get("footer");e&&e.length>120&&(e=e.slice(0,110)+"... %23 map"),this.$el.html(r({hasTranslation:t||i,showLogo:this.model.get("showLogo"),title:this.model.get("title"),description:this.model.get("description"),updatedAt:l(this.model.get("updatedAt")).fromNow(),userName:this.model.get("userName"),url:window.location.href,urlWithoutParams:window.location.protocol+"//"+window.location.host+window.location.pathname,inIframe:window.location!==window.parent.location,shortTitle:e,userAvatarURL:this.model.get("userAvatarURL"),userProfileURL:this.model.get("userProfileURL")})),this.$el.toggleClass("is-active",t);var s=this._getDescription().get(0);return d.initialize(s,{wheelSpeed:2,suppressScrollX:!0}),this},_getDescription:function(){return this.$(".js-scroll-wrapper")},_toogleView:function(){var e=this.viewModel.get("open");this.viewModel.set({open:!e})},_onResizeWindow:function(){this.viewModel.set({footer:o(window).width()<1201})},clean:function(){o(window).off("resize",this._resize),n.prototype.clean.call(this)}});e.exports=h},607:function(e,t,i){var s=i(0),n=i(3),a=i(42),o=i(1),r=i(619),l=i(628),d=i(629),h=i(305),c=i(905),u=window.matchMedia;e.exports=o.extend({className:"CDB-Widget-canvas",initialize:function(e){this._widgetViewFactory=new h([{type:"formula",createContentView:function(e){return new l({model:e})}},{type:"histogram",createContentView:function(e){return new d({model:e})}},{type:"category",createContentView:function(e){return new r({model:e})}}]),this._widgets=e.widgets,this._widgets.bind("add",this._maybeRenderWidgetView,this),this._widgets.bind("reset",this.render,this),this._widgets.bind("orderChanged",this.render,this),this._widgets.bind("change:collapsed",this._onWidgetUpdate,this),this._widgets.bind("add remove reset",this._onWidgetsChange,this),this.add_related_model(this._widgets),this._resizeHandler=this._onResize.bind(this)},render:function(){return this._cleanScroll(),this._observer&&this._observer.disconnect(),this.clearSubViews(),this.$el.html(c()),this.$el.toggleClass("CDB-Widget-canvas--withMenu",this.model.get("renderMenu")),this._widgets.each(this._maybeRenderWidgetView,this),this._toggleVisiblity(),this._renderScroll(),this._renderShadows(),this._bindScroll(),this._initResize(),this},_initResize:function(){["(max-width: 1600px)","(max-width: 1280px)","(max-width: 759px)"].forEach(function(e){u(e).addListener(this._resizeHandler)},this)},_updateScrollCss:function(){this._onWidgetUpdate();var e=this._container();if(e){var t=e.clientWidth,i=e.clientHeight,s=e.scrollWidth,n=e.scrollHeight,a=t<s,o=i<n;this._$container().toggleClass("hasXScroll",a),this._$container().toggleClass("hasYScroll",o)}},_$container:function(){return n(this._container())},_container:function(){return this.el.querySelector(".js-container")},_maybeRenderWidgetView:function(e){var t=this._widgetViewFactory.createWidgetView(e);t&&(this.addView(t),this._$container().append(t.render().el))},_bindScroll:function(){this._$container().on("ps-y-reach-start",s.bind(this._onScrollTop,this)).on("ps-y-reach-end",s.bind(this._onScrollBottom,this)).on("ps-scroll-y",s.bind(this._onScroll,this))},_renderScroll:function(){a.initialize(this._container(),{wheelSpeed:1,wheelPropagation:!1,swipePropagation:!0,stopPropagationOnClick:!1,minScrollbarLength:20,useBothWheelAxes:!0})},_onWidgetUpdate:function(){a.update(this._container())},_renderShadows:function(){this.$shadowTop=n("<div>").addClass("CDB-Widget-canvasShadow CDB-Widget-canvasShadow--top"),this.$shadowBottom=n("<div>").addClass("CDB-Widget-canvasShadow CDB-Widget-canvasShadow--bottom"),this.$el.append(this.$shadowTop),this.$el.append(this.$shadowBottom)},_onScrollTop:function(){this.$shadowTop.removeClass("is-visible")},_onScroll:function(){var e=this._$container(),t=e.scrollTop(),i=e.get(0).scrollHeight,s=e.outerHeight(),n=i-s;this.$shadowTop.toggleClass("is-visible",t>0),this.$shadowBottom.toggleClass("is-visible",t<n)},_updateScroll:function(){this._$container().scrollLeft=0,this._$container().scrollTop=0},_onResize:function(e){this._updateScroll(),this._onScroll()},_onScrollBottom:function(){this.$shadowBottom.removeClass("is-visible")},_cleanScroll:function(){n(window).off("resize",this._resizeHandler),this._container()&&(this._$container().off("ps-scroll-y"),a.destroy(this._container()))},_toggleVisiblity:function(){this.$el.toggle(!s.isEmpty(this._subviews))},_onWidgetsChange:function(){this._toggleVisiblity()},clean:function(){this._cleanScroll(),this._observer&&this._observer.disconnect(),o.prototype.clean.call(this)}})},608:function(e,t,i){var s=i(3),n=i(1),a=i(906),o=i(605),r=i(606),l=i(607);e.exports=n.extend({className:"CDB-Dashboard-canvas",initialize:function(e){this._widgets=e.widgets,this._infoView=e.infoView,this.el.classList.add(this.className),this.$el.html(a()),this._onWindowResize=this._onWindowResize.bind(this),s(window).bind("resize",this._onWindowResize)},render:function(){this.clearSubViews();var e,t=this.model.get("renderMenu");return this.$el.toggleClass("CDB-Dashboard-canvas--withMenu",t),t&&(e=new r({model:this.model}),this.addView(e),this.$el.append(e.render().el)),this._widgets.some(function(e){return"time-series"===e.get("type")})&&this.$el.toggleClass("CDB-Dashboard-canvas--withTimeSeries"),e=new o({widgets:this._widgets}),this.addView(e),this.$(".js-map-wrapper").toggleClass("CDB-Dashboard-mapWrapper--withMenu",t).append(e.render().el),e=new l({widgets:this._widgets,model:this.model}),this.addView(e),this.$el.append(e.render().el),this},getInitialMapState:function(){return{bounds:this.model.get("initialPosition").bounds}},_onWindowResize:function(){this._widgets.each(function(e){e.forceResize()})},clean:function(){s(window).unbind("resize",this._onWindowResize),n.prototype.clean.call(this)}})},609:function(e,t){e.exports={analyses:{unknown:"Unknown",source:"Source","connect-with-lines":{"short-title":"Connect with lines"},georeference:{"short-title":"Geocode"},"data-observatory-measure":{"short-title":"Data observatory"},"data-observatory-multiple-measures":{"short-title":"Data observatory"},merge:{"short-title":"Join columns"},"filter-by-node-column":{"short-title":"Filter by layer"},centroid:{"short-title":"Centroid"},"group-points":{"short-title":"Group points"},"convex-hull":{"short-title":"Convex Hull"},"concave-hull":{"short-title":"Concave Hull"},"bounding-box":{"short-title":"Bounding Box"},"bounding-circle":{"short-title":"Bounding Circle"},"area-of-influence":{"short-title":"AOI"},"filter-intersection":{"short-title":"Filter points in polygons"},"aggregate-intersection":{"short-title":"Aggregate intersection"},filter:{"short-title":"Filter"},sampling:{"short-title":"Sampling"},kmeans:{"short-title":"Clusters"},"moran-cluster":{"short-title":"Outliers & clusters"},"spatial-markov-trend":{"short-title":"Trends"},routing:{"short-title":"Routing"},"deprecated-sql-function":{"short-title":"SQL Function"},"find-nearest":{"short-title":"Find nearest"}}}},610:function(e,t,i){e.exports={en:i(609)}},611:function(e,t,i){var s=i(0),n={generic:{level:"error",refresh:!0},limit:{level:"error",error:"Timeout",message:"The server is taking too long to respond, due to poor conectivity or a temporary error with our servers. Please try again soon.",refresh:!0},no_data_available:{level:"alert",error:"No data available",message:"There are no results for the combination of filters applied to your data. Try tweaking your filters, or zoom and pan the map to adjust the Map View.",refresh:!1},too_many_bins:{level:"error",error:"Too many bins returned",message:"There are too many bins returned. Try selecting a less granular aggregation or filtering the data source.",refresh:!1},dataview:{level:"error",refresh:!1}};e.exports=function(e){var t=e&&e.type&&s.has(n,e.type)?e.type:"generic";return s.extend({},e,n[t])}},612:function(e,t,i){var s=i(5),n=i(0),a={};a.substractOneUnit=function(e,t){if(!n.isNumber(e))return e;var i=s.unix(e).utc();return t&&"week"===t?i.subtract(1,"day"):i.subtract(1,t),i.unix()},e.exports=a},613:function(e,t,i){var s=i(0),n=i(78),a=i(618),o=i(631),r=i(633),l={auto_style_allowed:"autoStyleEnabled"},d=function(e){return s.reduce(l,function(t,i,s){if(void 0!==e[s])return t[i]=e[s],t},{})},h=function(e,t){s.each(t,function(t){if(void 0===e[t])throw new Error(t+" is required")})},c=function(e,t,i){return s.extend(e,t,{hasInitialState:i})},u=function(e){if(!(e.source instanceof Object&&e.source.cid))throw new Error("Source must be defined and be an instance of AnalysisModel.")},_=function(e,t){this._widgetsCollection=e,this._dataviews=t};_.prototype.getCollection=function(){return this._widgetsCollection},_.prototype.get=function(e){return this._widgetsCollection.get(e)},_.prototype.getList=function(){return this._widgetsCollection.models},_.prototype.createCategoryModel=function(e,t,i){h(e,["title"]);var n=c(e,i,this._widgetsCollection.hasInitialState());u(n);var o=this._dataviews.createCategoryModel(n),r=["id","title","order","collapsed","prefix","suffix","show_stats","show_source","style","hasInitialState"],l=s.pick(n,r),_=d(n);l.attrsNames=r;var g=new a(l,{dataviewModel:o,layerModel:t},_);return g.setInitialState(i),this._widgetsCollection.add(g),g},_.prototype.createHistogramModel=function(e,t,i,n){h(e,["title"]);var a=c(e,i,this._widgetsCollection.hasInitialState());u(a);var r=this._dataviews.createHistogramModel(a);r.has("bins")||r.set("bins",10,{silent:!0});var l=["id","title","order","collapsed","bins","show_stats","show_source","normalized","style","hasInitialState","table_name"],_=s.pick(a,l),g=d(a);_.type="histogram",_.attrsNames=l;var p=new o(_,{dataviewModel:r,layerModel:t},g);return p.setInitialState(i),this._widgetsCollection.add(p),p},_.prototype.createFormulaModel=function(e,t,i){h(e,["title"]);var a=c(e,i,this._widgetsCollection.hasInitialState());u(a);var o=this._dataviews.createFormulaModel(a),r=["id","title","order","collapsed","prefix","suffix","show_stats","show_source","description","hasInitialState"],l=s.pick(a,r);l.type="formula",l.attrsNames=r;var d=new n(l,{dataviewModel:o,layerModel:t});return d.setInitialState(i),this._widgetsCollection.add(d),d},_.prototype.createTimeSeriesModel=function(e,t,i,n){e.column_type=e.column_type||"date",u(e);var a=this._dataviews.createHistogramModel(e),o=["id","style","title","normalized","animated","timezone"],l=s.pick(e,o);l.type="time-series",l.attrsNames=o;var d=new r(l,{dataviewModel:a,layerModel:t},n);return d.setInitialState(i),this._widgetsCollection.add(d),d},_.prototype.setWidgetsState=function(e){this._widgetsCollection.setStates(e)},e.exports=_},614:function(e,t,i){function getColorRange(e){return e&&e.definition&&e.definition.color&&e.definition.color.range||n}function CategoryColors(e){this.updateColors(e)}var s=i(0),n=["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74"];CategoryColors.prototype.updateColors=function(e){var t=getColorRange(e);this.colors={},s.each(t,function(e){this.colors[e]=null},this)},CategoryColors.prototype.updateData=function(e){s.each(this.colors,function(t,i){s.contains(e,t)?e=s.without(e,t):this.colors[i]=null},this),s.each(e,function(e){var t=this.getNextAvailableColor();t&&(this.colors[t]=e)},this)},CategoryColors.prototype.getNextAvailableColor=function(){for(var e in this.colors)if(null===this.colors[e])return e;return null},CategoryColors.prototype.getColorByCategory=function(e){for(var t in this.colors)if(this.colors[t]===e)return t;return"#A5AA99"},CategoryColors.prototype.getCategoryByColor=function(e){return this.colors[e]},e.exports=CategoryColors},615:function(e,t,i){var s=i(0),n=i(298);e.exports=n.extend({updateStyle:function(e){this.styles=e.auto_style,this.colors.updateColors(e.auto_style),this.colors.updateData(s.pluck(this.dataviewModel.get("data"),"name"))},_getRange:function(){return s.map(this.dataviewModel.get("data"),function(e){return this.colors.getColorByCategory(e.name)},this)},getDef:function(){var e=this.dataviewModel,t=e.get("data"),i=this._getRange(),a={};return n.FILL_SELECTORS.forEach(function(n){var o={},r=n.substring(0,n.indexOf("-"));o={color:{domain:s.pluck(t,"name"),range:i,attribute:e.get("column")}},a["marker"===r?"point":r]=o}),a},_getFillColor:function(){var e=this.dataviewModel,t=e.get("data"),i=e.get("column");return this._getCategoryRamp(t,i)},_getCategoryRamp:function(e,t){for(var i="ramp(["+t+"], ",s="",n="",a=0;a<e.length;a++){var o=e[a],r=a!==e.length-1?", ":"";s+='"'+this.colors.getColorByCategory(o.name)+'"'+r,o.agg?a===e.length-1&&(n=n.substring(0,n.length-2)):"string"!=typeof o.name?n+=o.name+r:n+='"'+String(o.name).replace(/"/g,'\\"')+'"'+r}return i+"("+s+"), ("+n+"), '=')"}})},616:function(e,t,i){var s={category:i(615),histogram:i(617)};e.exports={get:function(e,t,i){var n=s[e.get("type")];if(n)return new n(e,t,i);throw new Error("dataview type not supported")}}},617:function(e,t,i){var s=i(0),n=i(27),a=i(298),o=i(299),r=a.extend({updateStyle:function(e){this.styles=e.auto_style},_getFillColor:function(e){var t=this._getColor(),i=t||{};if(!t){var s=this.dataviewModel.getDistributionType(this.dataviewModel.getUnfilteredDataModel().get("data"));i=r.SCALES_MAP[e][s]}return"ramp(["+this.dataviewModel.get("column")+"], "+(t?"('"+i.range.join("', '")+"'), ":"cartocolor("+i.palette+", "+this.dataviewModel.get("bins")+"), ")+i.quantification+")"},getDef:function(e){var t={},i=this.dataviewModel.getDistributionType(this.dataviewModel.getUnfilteredDataModel().get("data")),l=this.dataviewModel.get("bins"),d=this.dataviewModel.get("column"),h=this.styles,c=this.styles&&this.styles.custom||!1;return a.FILL_SELECTORS.forEach(function(a){if(o.isPropertyIncluded(e,a)){var u=r.SCALES_MAP[a][i],_=a.substring(0,a.indexOf("-")),g={};u&&(g=!0===c?s.extend(g,h.definition):{color:{range:n[u.palette][l]||n[u.palette][Object.keys(n[u.palette]).length],quantification:u.quantification,attribute:d}}),t["marker"===_?"point":_]=g}}),t}});r.SCALES_MAP={"polygon-fill":{F:{palette:"PinkYl",quantification:"equal"},L:{palette:"Emrld",quantification:"headtails"},J:{palette:"Emrld",quantification:"headtails"},A:{palette:"Geyser",quantification:"quantiles"},C:{palette:"Sunset",quantification:"jenks"},U:{palette:"Sunset",quantification:"jenks"}},"line-color":{F:{palette:"PinkYl",quantification:"equal"},L:{palette:"Emrld",quantification:"headtails"},J:{palette:"Emrld",quantification:"headtails"},A:{palette:"Geyser",quantification:"quantiles"},C:{palette:"Sunset",quantification:"jenks"},U:{palette:"Sunset",quantification:"jenks"}},"marker-fill":{F:{palette:"RedOr",quantification:"equal"},L:{palette:"BluYl",quantification:"headtails"},J:{palette:"BluYl",quantification:"headtails"},A:{palette:"Geyser",quantification:"quantiles"},C:{palette:"SunsetDark",quantification:"jenks"},U:{palette:"SunsetDark",quantification:"jenks"}}},e.exports=r},618:function(e,t,i){var s=i(0),n=i(78),a=i(623);e.exports=n.extend({defaults:s.extend({type:"category",search:!1,locked:!1},n.prototype.defaults),defaultState:s.extend({acceptedCategories:[],locked:!1,autoStyle:!1},n.prototype.defaultState),initialize:function(){n.prototype.initialize.apply(this,arguments),this.lockedCategories=new a,this.listenTo(this.dataviewModel,"change:allCategoryNames",this._onDataviewAllCategoryNamesChange),this.on("change:locked",this._onLockedChange,this),this.on("change:collapsed",this._onCollapsedChange,this),this.isAutoStyleEnabled()&&this.on("change:style",this._updateAutoStyle,this),this.dataviewModel.filter.on("change",function(){this.set("acceptedCategories",this._acceptedCategories().pluck("name"))},this),this.dataviewModel.once("change:allCategoryNames",function(){this.get("autoStyle")&&this.autoStyle()},this)},setupSearch:function(){this.dataviewModel.setupSearch(),this.lockedCategories.addItems(this._acceptedCategories().toJSON()),this.toggleSearch()},toggleSearch:function(){this.set("search",!this.get("search"))},enableSearch:function(){this.set("search",!0)},disableSearch:function(){this.set("search",!1)},isSearchEnabled:function(){return this.get("search")},cleanSearch:function(){this.dataviewModel.cleanSearch(),this.lockedCategories.reset([])},autoStyle:function(){this.autoStyler.colors.updateData(this.dataviewModel.get("allCategoryNames")),n.prototype.autoStyle.call(this)},isLocked:function(){return this.get("locked")},canBeLocked:function(){return this.isLocked()||this._acceptedCategories().size()>0},canApplyLocked:function(){return this._acceptedCategories().size()!==this.lockedCategories.size()||this._acceptedCategories().any(function(e){return!this.lockedCategories.isItemLocked(e.get("name"))},this)},applyLocked:function(){var e=this.lockedCategories.getItemsName();if(!e.length)return this.unlockCategories(),!1;this.set("locked",!0);var t=this.dataviewModel.filter;t.cleanFilter(!1),t.accept(e),t.applyFilter(),this.cleanSearch()},lockCategories:function(){this.set("locked",!0),this.dataviewModel.fetch()},unlockCategories:function(){this.set("locked",!1),this.dataviewModel.filter.acceptAll()},_onDataviewAllCategoryNamesChange:function(e,t){this.isAutoStyleEnabled()&&(this.isAutoStyle()||this.autoStyler.colors.updateData(t))},_onLockedChange:function(e,t){t?this.dataviewModel.enableFilter():this.dataviewModel.disableFilter()},_acceptedCategories:function(){return this.dataviewModel.filter.acceptedCategories},_onCollapsedChange:function(e,t){this.dataviewModel.set("enabled",!t)}})},619:function(e,t,i){var s=i(2),n=i(1),a=i(627),o=i(624),r=i(300),l=i(626),d=i(301),h=i(622),c=i(625),u=i(907);e.exports=n.extend({className:"CDB-Widget-body",_ITEMS_PER_PAGE:6,initialize:function(){this._dataviewModel=this.model.dataviewModel,this._layerModel=this.model.layerModel,this._paginatorModel=new s.Model({page:1}),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.toggleClass("is-collapsed",!!this.model.get("collapsed")),this.$el.html(u()),this._initViews(),this},_initBinds:function(){!0===this.model.get("hasInitialState")?this._onInitialState():this.model.bind("change:hasInitialState",this._onInitialState,this),this.model.bind("change:collapsed",function(e,t){this.$el.toggleClass("is-collapsed",!!t)},this)},_onInitialState:function(){this.render(),!0===this.model.get("autoStyle")&&this.model.autoStyle()},_initViews:function(){var e=new a({widgetModel:this.model,dataviewModel:this._dataviewModel,layerModel:this._layerModel});this.$(".js-header").append(e.render().el),this.addView(e);var t=new l({widgetModel:this.model,dataviewModel:this._dataviewModel});this.$(".js-header").append(t.render().el),this.addView(t);var i=new o({widgetModel:this.model,dataviewModel:this._dataviewModel});this.$(".js-content").html(i.render().el),this.addView(i);var s=new r({widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE,paginatorModel:this._paginatorModel});this.$(".js-content").append(s.render().el),this.addView(s);var n=new d({widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE,paginatorModel:this._paginatorModel});this.$(".js-footer").append(n.render().el),this.addView(n);var u=new h({widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE,paginator:!0,paginatorModel:this._paginatorModel});this.$(".js-content").append(u.render().el),this.addView(u);var _=new c({widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE,paginator:!0,paginatorModel:this._paginatorModel});this.$(".js-footer").append(_.render().el),this.addView(_)}})},620:function(e,t,i){var s=i(1),n=i(23),a=i(0),o=i(908),r=i(909);e.exports=s.extend({tagName:"li",className:"CDB-Widget-listItem",events:{"click .js-button":"_onItemClick"},initialize:function(e){this.widgetModel=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this._initBinds()},render:function(){var e=this.model.get("name"),t=this.model.get("value"),i=this.model.get("agg")||this.widgetModel.isLocked()?r:o,s=this.dataviewModel.filter.getAcceptedCategoryNames(),l=a.contains(s,e);return this.$el.html(i({isAggregated:this.model.get("agg"),name:e,value:t,formattedValue:n.formatNumber(t),percentage:t/this.dataviewModel.get("max")*100,color:this.widgetModel.getColor(e),isDisabled:this.model.get("selected")?"":"is-disabled",isAccepted:l,prefix:this.widgetModel.get("prefix"),suffix:this.widgetModel.get("suffix")})),this},_initBinds:function(){this.model.bind("change",this.render,this),this.widgetModel.bind("change:search change:prefix change:suffix change:autoStyle",this.render,this),this.add_related_model(this.widgetModel)},_onItemClick:function(){this.trigger("itemClicked",this.model,this)}})},621:function(e,t,i){var s=i(1),n=i(23),a=i(910);e.exports=s.extend({tagName:"li",className:"CDB-Widget-listItem",events:{"click .js-button":"_onItemClick"},initialize:function(e){this.dataviewModel=this.options.dataviewModel,this.widgetModel=this.options.widgetModel,this._initBinds()},render:function(){var e=this.model.get("value");return this.$el.html(a({name:this.model.get("name"),value:e,formattedValue:n.formatNumber(e),percentage:e/this.dataviewModel.get("max")*100,isDisabled:!this.model.get("selected"),prefix:this.widgetModel.get("prefix"),suffix:this.widgetModel.get("suffix")})),this},_initBinds:function(){this.model.bind("change:selected",this.render,this),this.widgetModel.bind("change:prefix change:suffix",this.render,this),this.add_related_model(this.widgetModel)},_onItemClick:function(){this.model.set("selected",!this.model.get("selected"))}})},622:function(e,t,i){var s=i(300),n=i(621),a=i(911);e.exports=s.extend({className:"CDB-Widget-list is-hidden js-list",render:function(){this.clearSubViews(),this.$el.empty();var e=this._searchResultsCollection;return e.isEmpty()||0===e.size()?this._renderPlaceholder():this._renderList(),this},_initBinds:function(){s.prototype._initBinds.apply(this,arguments),this._searchResultsCollection=this._dataviewModel.getSearchResult(),this.listenTo(this._searchResultsCollection,"change:selected",this._onSelectedItemChange),this.listenTo(this._searchResultsCollection,"reset",this.render)},_getData:function(){return this._searchResultsCollection},_renderPlaceholder:function(){this.$el.addClass("CDB-Widget-list--noresults"),this.$el.html(a({q:this._dataviewModel.getSearchQuery()}))},_addItem:function(e){var t=new n({model:e,widgetModel:this._widgetModel,dataviewModel:this._dataviewModel});this.addView(t),this.$el.append(t.render().el)},toggle:function(){this[this._widgetModel.isSearchEnabled()?"show":"hide"]()},_onSelectedItemChange:function(e,t){this._widgetModel.lockedCategories[t?"addItem":"removeItem"](e)}})},623:function(e,t,i){var s=i(0),n=i(2);e.exports=n.Collection.extend({addItem:function(e){this.isItemLocked(e.get("name"))||this.add(e)},addItems:function(e){s.each(e,function(e){this.isItemLocked(e.name)||this.add(e)},this)},resetItems:function(e){this.reset(e)},removeItem:function(e){var t=this.isItemLocked(e.get("name"));t&&this.remove(t)},removeItems:function(){this.reset([])},isItemLocked:function(e){return this.find(function(t){return t.get("name")===e})},getItemsName:function(){return this.pluck("name")}})},624:function(e,t,i){var s=i(1),n=i(912);e.exports=s.extend({className:"CDB-Widget-filter CDB-Widget-contentSpaced CDB-Widget-contentSpaced--sideMargins",events:{"click .js-all":"_onSelectAll","click .js-lock":"_lockCategories","click .js-unlock":"_unlockCategories"},initialize:function(){this.dataviewModel=this.options.dataviewModel,this.widgetModel=this.options.widgetModel,this._initBinds()},render:function(){var e=this.dataviewModel.filter.acceptedCategories.size(),t=this.dataviewModel.filter.rejectedCategories.size(),i=this.dataviewModel.filter.areAllRejected(),s=this.dataviewModel.getData().size(),a=this.widgetModel.isLocked();return this.$el.html(n({isSearchEnabled:this.widgetModel.isSearchEnabled(),isSearchApplied:this.dataviewModel.isSearchApplied(),isLocked:a,canBeLocked:this.widgetModel.canBeLocked(),allSelected:0===t&&0===e&&!i,canSelectAll:!a&&(t>0||e>0||i),noneSelected:i||!s&&!e,acceptedCats:e,totalLocked:this.widgetModel.lockedCategories.size(),totalCats:s})),this},_initBinds:function(){this.widgetModel.bind("change:search change:locked",this.render,this),this.widgetModel.lockedCategories.bind("change add remove",this.render,this),this.add_related_model(this.widgetModel),this.add_related_model(this.widgetModel.lockedCategories),this.dataviewModel.bind("change:data",this.render,this),this.add_related_model(this.dataviewModel);var e=this.dataviewModel.filter;e.acceptedCategories.bind("add remove reset",this.render,this),e.rejectedCategories.bind("add remove reset",this.render,this),this.add_related_model(e.rejectedCategories),this.add_related_model(e.acceptedCategories)},_lockCategories:function(){this.widgetModel.lockCategories()},_unlockCategories:function(){this.widgetModel.unlockCategories()},_onSelectAll:function(){this.dataviewModel.filter.acceptAll()}})},625:function(e,t,i){var s=i(301),n=i(914),a=i(336);e.exports=s.extend({className:"CDB-Widget-nav is-hidden CDB-Widget-contentSpaced",render:function(){this.clearSubViews(),this.$el.empty();var e=this._totalPages();return this.$el.html(n()),e>1&&this.$el.append(a({currentPage:this._paginatorModel.get("page"),pages:e})),this},_totalPages:function(){return Math.ceil(this._dataviewModel.getSearchCount()/this.options.itemsPerPage)},toggle:function(){this[this._widgetModel.isSearchEnabled()?"show":"hide"]()},_onSearchClicked:function(){this._widgetModel.cleanSearch(),this._widgetModel.toggleSearch()}})},626:function(e,t,i){var s=i(0),n=i(1),a=i(23),o=i(916),r=i(915),l=i(77);e.exports=n.extend({className:"CDB-Widget-info CDB-Text CDB-Size-small u-secondaryTextColor u-upperCase u-tSpace",tagName:"dl",initialize:function(){this.widgetModel=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this._initBinds()},render:function(){return this.$el.html(o({isSearchEnabled:this.widgetModel.isSearchEnabled(),isSearchApplied:this.dataviewModel.isSearchApplied(),isLocked:this.widgetModel.isLocked(),isOtherAvailable:this.dataviewModel.isOtherAvailable(),resultsCount:this.dataviewModel.getSearchCount(),totalCats:this._getCategoriesSize(),nullsPer:this._getNullPercentage(),catsPer:this._getCurrentCategoriesPercentage()})),new l({el:this.$el}).animateFromValues(this._getPreviousCategoriesPercentage(),this._getCurrentCategoriesPercentage(),".js-cats",r,{defaultValue:"-",animationSpeed:700,formatter:a.formatValue}),this._checkVisibility(),this},_initBinds:function(){this.dataviewModel.bind("change:data change:totalCount",this.render,this),this.widgetModel.bind("change:search change:locked",this.render,this),this.widgetModel.bind("change:show_stats change:collapsed",this._checkVisibility,this),this.add_related_model(this.dataviewModel),this.add_related_model(this.widgetModel)},_getNullPercentage:function(){var e=this.dataviewModel.get("nulls"),t=this.dataviewModel.get("totalCount")||0;return e?(e/t*100).toFixed(2):0},_getPreviousCategoriesPercentage:function(){var e=this.dataviewModel.previous("totalCount")||0,t=this.dataviewModel.getPreviousData();return this._getCategoriesPercentage(t,e)},_getCurrentCategoriesPercentage:function(){var e=this.dataviewModel.get("totalCount")||0,t=this.dataviewModel.getData().toJSON();return this._getCategoriesPercentage(t,e)},_getCategoriesPercentage:function(e,t){if(!t)return 0;var i=e.reduce(function(e,t){return t.agg?e:e+parseFloat(t.value)},0);return i?(i/t*100).toFixed(2):0},_getCategoriesSize:function(){return s.pluck(this.dataviewModel.getData().reject(function(e){return e.get("agg")}),"name").length},_checkVisibility:function(){var e=!!this.widgetModel.get("show_stats")&&!this.widgetModel.get("collapsed");this.$el.toggle(e)}})},627:function(e,t,i){var s=i(0),n=i(3),a=i(1),o=i(58),r=i(6),l=i(917),d=i(57),h=i(55),c=i(56);e.exports=a.extend({events:{"keyup .js-textInput":"_onKeyupInput","submit .js-form":"_onSubmitForm","click .js-applyLocked":"_applyLocked","click .js-autoStyle":"_autoStyle","click .js-cancelAutoStyle":"_cancelAutoStyle"},initialize:function(){if(!this.options.widgetModel)throw new Error("widgetModel is required");if(!this.options.dataviewModel)throw new Error("dataviewModel is required");if(!this.options.layerModel)throw new Error("layerModel is required");this.model=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this.layerModel=this.options.layerModel,this._initBinds()},render:function(){this.clearSubViews();var e=this.dataviewModel.get("source").id,t=d.letter(e),i=d.getColorForLetter(t),s=this.dataviewModel.getSourceType()||"",n=this.dataviewModel.isSourceType(),a=n?this.model.get("table_name"):this.layerModel.get("layer_name");return this.$el.html(l({isCollapsed:this.model.get("collapsed"),isAutoStyleEnabled:this._isAutoStyleButtonVisible(),isAutoStyle:this.model.isAutoStyle(),title:this.model.get("title"),sourceId:e,sourceType:h.title(s),isSourceType:n,showSource:this.model.get("show_source")&&""!==t,sourceColor:i,layerName:c(a),columnName:this.dataviewModel.get("column"),q:this.dataviewModel.getSearchQuery(),isLocked:this.model.isLocked(),canBeLocked:this.model.canBeLocked(),isSearchEnabled:this.model.isSearchEnabled(),canShowApply:this.model.canApplyLocked()})),this._initViews(),this},_initBinds:function(){this.listenTo(this.model,"change:search",this._onSearchToggled),this.listenTo(this.model,"change:title change:collapsed change:autoStyle change:style",this.render),this.listenTo(this.model.lockedCategories,"change add remove",this.render),this.listenTo(this.dataviewModel,"change:column",this.render),this.listenTo(this.dataviewModel.filter,"change",this.render),this.listenTo(this.layerModel,"change:visible change:cartocss change:layer_name",this.render)},_initViews:function(){var e=new o({model:this.model,target:".js-actions",container:this.$el});this.addView(e);var t=new r({el:this.$el.find(".js-colors"),gravity:"auto"});this.addView(t);var i=new r({el:this.$el.find(".js-actions"),gravity:"auto"});this.addView(i)},_isAutoStyleButtonVisible:function(){return this.model.isAutoStyleEnabled()&&this.layerModel.get("visible")&&this.model.hasColorsAutoStyle()},_onSearchToggled:function(){var e=this.model.isSearchEnabled();this[e?"_bindESC":"_unbindESC"](),this.render(),e&&this._focusOnInput()},_onSubmitForm:function(e){e&&e.preventDefault();var t=this.$(".js-textInput").val();this.dataviewModel.getSearchQuery()!==t&&(this.dataviewModel.setSearchQuery(t),this.dataviewModel.isSearchValid()&&this.dataviewModel.applySearch())},_focusOnInput:function(){var e=this;setTimeout(function(){e.$(".js-textInput").focus()},0)},_onKeyupInput:s.debounce(function(e){var t=this.$(".js-textInput").val();13!==e.keyCode&&27!==e.keyCode&&""!==t&&this._onSubmitForm()},250),_bindESC:function(){n(document).bind("keyup."+this.cid,s.bind(this._onKeyUp,this))},_unbindESC:function(){n(document).unbind("keyup."+this.cid)},_onKeyUp:function(e){if(27===e.keyCode)return this._cancelSearch(),!1},_applyLocked:function(){this.model.toggleSearch(),this.model.applyLocked()},_autoStyle:function(){this.model.autoStyle()},_cancelAutoStyle:function(){this.model.cancelAutoStyle()},_cancelSearch:function(){this.model.cleanSearch(),this.model.disableSearch()},clean:function(){this._unbindESC(),a.prototype.clean.call(this)}})},628:function(e,t,i){var s=i(0),n=i(35),a=i(1),o=i(23),r=i(921),l=i(58),d=i(919),h=i(77),c=i(57),u=i(55),_=i(56),g=i(6);e.exports=a.extend({className:"CDB-Widget-body",initialize:function(){this._dataviewModel=this.model.dataviewModel,this._layerModel=this.model.layerModel,!0===this.model.get("hasInitialState")?this._initBinds():this.listenToOnce(this.model,"change:hasInitialState",this._onInitialState)},_onInitialState:function(){this._initBinds(),this.render()},render:function(){this.clearSubViews();var e=this._dataviewModel.get("data"),t=function(e){var t=n.format("0,000");return s.isNumber(e)?t(e.toFixed(2)):0},i=!s.isUndefined(this._dataviewModel.get("nulls"))&&o.formatNumber(this._dataviewModel.get("nulls"))||"-",a=this.model.get("collapsed"),l=this.model.get("prefix"),g=this.model.get("suffix"),p=this._dataviewModel.get("source").id,m=c.letter(p),f=c.getColorForLetter(m),w=this._dataviewModel.getSourceType()||"",v=this._dataviewModel.isSourceType(),C=v?this.model.get("table_name"):this._layerModel.get("layer_name");return this.$el.html(r({title:this.model.get("title"),sourceId:p,sourceType:u.title(w),isSourceType:v,showStats:this.model.get("show_stats"),showSource:this.model.get("show_source")&&""!==m,operation:this._dataviewModel.get("operation"),value:e,formatedValue:t(e),description:this.model.get("description"),nulls:i,prefix:l,suffix:g,isCollapsed:a,sourceColor:f,layerName:_(C)})),new h({el:this.$el}).animateValue(this._dataviewModel,"data",".js-value",d,{animationSpeed:700,formatter:t,templateData:{prefix:l,suffix:g}}),this.$el.toggleClass("is-collapsed",!!a),this._initViews(),this},_initBinds:function(){this.listenTo(this.model,"change:title change:description change:collapsed change:prefix change:suffix",this.render),this.listenTo(this._dataviewModel,"change:data",this.render),this.listenTo(this._layerModel,"change:layer_name",this.render)},_initViews:function(){var e=new l({model:this.model,target:".js-actions",container:this.$(".js-header")});this.addView(e);var t=new g({el:this.$el.find(".js-actions"),gravity:"auto"});this.addView(t)}})},629:function(e,t,i){var s=i(0),n=i(1),a=i(23),o=i(630),r=i(302),l=i(337),d=i(923),h=i(58),c=i(6),u=i(77),_=i(922),g=i(57),p=i(55),m=i(56);e.exports=n.extend({className:"CDB-Widget-body",defaults:{chartHeight:72},events:{"click .js-clear":"_resetWidget","click .js-zoom":"_zoom"},initialize:function(){this._dataviewModel=this.model.dataviewModel,this._layerModel=this.model.layerModel,this._originalData=this._dataviewModel.getUnfilteredDataModel(),this.filter=this._dataviewModel.filter,this.lockedByUser=!1,this._numberOfFilters=0,this._initStateApplied=!1,this._originalData.get("hasBeenFetched")?this._initBinds():this.listenToOnce(this._originalData,"change:hasBeenFetched",function(){this._initBinds()}),window.addEventListener("resize",this._onWindowResized.bind(this),{passive:!0})},render:function(){this.clearSubViews(),this._unbinds(),this.$el.toggleClass("is-collapsed",!!this.model.get("collapsed"));var e=this._dataviewModel.getData(),t=this._dataviewModel.hasNulls(),i=this._originalData.getData(),n=!s.size(e)&&!s.size(i),a=this._dataviewModel.get("source").id,o=g.letter(a),r=g.getColorForLetter(o),l=this._dataviewModel.getSourceType()||"",h=this._dataviewModel.isSourceType(),c=h?this.model.get("table_name"):this._layerModel.get("layer_name");return this.$el.html(d({title:this.model.get("title"),sourceId:a,sourceType:p.title(l),isSourceType:h,showStats:this.model.get("show_stats"),showNulls:t,showSource:this.model.get("show_source")&&""!==o,itemsCount:n?"-":e.length,isCollapsed:!!this.model.get("collapsed"),sourceColor:r,layerName:m(c)})),n?(this._addPlaceholder(),this._initTitleView()):(this._setupBindings(),this._initViews()),this},_initViews:function(){this._initTitleView(),this._initDropdownView(),this._renderMiniChart(),this._renderMainChart(),this._renderAllValues()},_onWindowResized:function(){window.innerWidth<1200&&this.histogramChartView.forceResize()},_initDropdownView:function(){var e=new h({model:this.model,target:".js-actions",container:this.$(".js-header"),flags:{normalizeHistogram:!0}});this.addView(e)},_toggleTooltip:function(e){if(!e||!e.target)return this._clearTooltip();this._showTooltip(e)},_showTooltip:function(e){this.tooltip&&e&&this.tooltip.getElement()===e.target||(this._clearTooltip(),this.tooltip=new c({el:e.target,title:function(){return e.data},trigger:"manual"}),this.tooltip.showTipsy(),this.addView(this.tooltip))},_clearTooltip:function(){this.tooltip&&(this.tooltip.hideTipsy(),this.removeView(this.tooltip),this.tooltip=void 0)},_initTitleView:function(){var e=new o({widgetModel:this.model,dataviewModel:this._dataviewModel,layerModel:this._layerModel});this.$(".js-title").append(e.render().el),this.addView(e)},_initBinds:function(){this.listenTo(this.model,"change:collapsed",this.render),this.listenTo(this.model,"change:normalized",this._onNormalizedChanged),!0===this.model.get("hasInitialState")?this._setInitialState():this.listenTo(this.model,"change:hasInitialState",this._setInitialState),this.listenTo(this._layerModel,"change:layer_name",this.render)},_setInitialState:function(){0===this._dataviewModel.getData().length?this._dataviewModel.once("change:data",this._onInitialState,this):this._onInitialState()},_onNormalizedChanged:function(){var e=this.model.get("normalized");this.histogramChartView.setNormalized(e),this.miniHistogramChartView.setNormalized(e)},_onInitialState:function(){this.add_related_model(this._dataviewModel),this.render(),!0===this.model.get("autoStyle")&&this.model.autoStyle(),this._hasRange()&&(this._numberOfFilters=1),this._isZoomed()&&(this._numberOfFilters=2),0!==this._numberOfFilters?this._setInitialRange():this._completeInitialState()},_setupRange:function(e,t,i,n){var a,o,r=0,l=e.length;s.isNumber(t)&&(a=s.findWhere(e,{start:t}),r=a?a.bin:0),s.isNumber(i)&&(o=s.findWhere(e,{end:i}),l=o?o.bin+1:e.length),(r&&0!==r||l&&l!==e.length)&&(this.filter.setRange(e[r].start,e[l-1].end),this._onChangeFilterEnabled(),this.histogramChartView.selectRange(r,l)),n&&n(r,l)},_setInitialRange:function(){var e=this._dataviewModel.getData(),t=this.model.get("min"),i=this.model.get("max"),s=void 0!==t||void 0!==i;this._setupRange(e,t,i,function(e,t){this.model.set({filter_enabled:s,lo_index:e,hi_index:t}),this._dataviewModel.bind("change:data",this._onHistogramDataChanged,this),this._initStateApplied=!0,this._isZoomed()?(this._onChangeZoomEnabled(),this._onZoomIn()):this._updateStats()}.bind(this))},_completeInitialState:function(){this._dataviewModel.bind("change:data",this._onHistogramDataChanged,this),this._initStateApplied=!0,this._updateStats()},_isZoomed:function(){return this.model.get("zoomed")},_hasRange:function(){var e=this.model.get("min"),t=this.model.get("max");return null!=e||null!=t},_onHistogramDataChanged:function(){this._dataviewModel.changed.url&&this._isZoomed()||(this.lockedByUser?this.lockedByUser=!1:(this._isZoomed()?this._filteredData=this._dataviewModel.getData():(this.histogramChartView.showShadowBars(),this.miniHistogramChartView.replaceData(this._dataviewModel.getData())),this.histogramChartView.replaceData(this._dataviewModel.getData())),this.unsettingRange&&this._unsetRange(),this._updateStats())},_unsetRange:function(){this.unsettingRange=!1,this.histogramChartView.replaceData(this._dataviewModel.getData()),this.model.set({lo_index:null,hi_index:null}),this._isZoomed()||this.histogramChartView.showShadowBars()},_addPlaceholder:function(){this.$(".js-content").append(l())},_renderMainChart:function(){this.histogramChartView=new r({type:"histogram",margin:{top:4,right:4,bottom:4,left:4},hasHandles:!0,hasAxisTip:!0,chartBarColor:this.model.getColor()||"#9DE0AD",width:this.canvasWidth,height:this.defaults.chartHeight,data:this._dataviewModel.getData(),dataviewModel:this._dataviewModel,layerModel:this._layerModel,originalData:this._originalData,displayShadowBars:!this.model.get("normalized"),normalized:this.model.get("normalized"),widgetModel:this.model}),this.$(".js-chart").append(this.histogramChartView.el),this.addView(this.histogramChartView),this.histogramChartView.bind("on_brush_end",this._onBrushEnd,this),this.histogramChartView.bind("hover",this._toggleTooltip,this),this.histogramChartView.render().show(),this._updateStats()},_renderMiniChart:function(){this.miniHistogramChartView=new r({type:"histogram",className:"CDB-Chart--mini",mini:!0,margin:{top:0,right:4,bottom:4,left:4},height:40,showOnWidthChange:!1,dataviewModel:this._dataviewModel,layerModel:this._layerModel,data:this._dataviewModel.getData(),normalized:this.model.get("normalized"),chartBarColor:this.model.getColor()||"#9DE0AD",originalData:this._originalData,widgetModel:this.model}),this.addView(this.miniHistogramChartView),this.$(".js-mini-chart").append(this.miniHistogramChartView.el),this.miniHistogramChartView.bind("on_brush_end",this._onMiniRangeUpdated,this),this.miniHistogramChartView.render()},_setupBindings:function(){this._dataviewModel.bind("change:bins",this._onChangeBins,this),this.model.bind("change:zoomed",this._onChangeZoomed,this),this.model.bind("change:zoom_enabled",this._onChangeZoomEnabled,this),this.model.bind("change:filter_enabled",this._onChangeFilterEnabled,this),this.model.bind("change:total",this._onChangeTotal,this),this.model.bind("change:nulls",this._onChangeNulls,this),this.model.bind("change:max",this._onChangeMax,this),this.model.bind("change:min",this._onChangeMin,this),this.model.bind("change:avg",this._onChangeAvg,this)},_unbinds:function(){this._dataviewModel.off("change:bins",this._onChangeBins,this),this.model.off("change:zoomed",this._onChangeZoomed,this),this.model.off("change:zoom_enabled",this._onChangeZoomEnabled,this),this.model.off("change:filter_enabled",this._onChangeFilterEnabled,this),this.model.off("change:total",this._onChangeTotal,this),this.model.off("change:nulls",this._onChangeNulls,this),this.model.off("change:max",this._onChangeMax,this),this.model.off("change:min",this._onChangeMin,this),this.model.off("change:avg",this._onChangeAvg,this)},_onMiniRangeUpdated:function(e,t){this.lockedByUser=!1,this._clearTooltip(),this.histogramChartView.removeSelection();var i=this._originalData.getData();this.model.set({lo_index:e,hi_index:t,zlo_index:null,zhi_index:null}),this._applyBrushFilter(i,e,t)},_onBrushEnd:function(e,t){this._isZoomed()?this._onBrushEndFiltered(e,t):this._onBrushEndUnfiltered(e,t)},_onBrushEndFiltered:function(e,t){var i=this._filteredData;i&&i.length&&(this.model.get("zlo_index")!==e||this.model.get("zhi_index")!==t)&&(this._numberOfFilters=2,this.lockedByUser=!0,this.model.set({filter_enabled:!0,zlo_index:e,zhi_index:t}),this._applyBrushFilter(i,e,t))},_onBrushEndUnfiltered:function(e,t){var i=this._dataviewModel.getData();i&&i.length&&(this.model.get("lo_index")!==e||this.model.get("hi_index")!==t)&&(this._numberOfFilters=1,this.model.set({filter_enabled:!0,zoom_enabled:!0,lo_index:e,hi_index:t}),this._applyBrushFilter(i,e,t))},_applyBrushFilter:function(e,t,i){t!==i&&t>=0&&t<e.length&&i-1>=0&&i-1<e.length?(this.filter.setRange(e[t].start,e[i-1].end),this._updateStats()):console.error("Error accessing array bounds",t,i,e)},_onChangeFilterEnabled:function(){this.$(".js-filter").toggleClass("is-hidden",!this.model.get("filter_enabled"))},_onChangeBins:function(e,t){this._resetWidget()},_onChangeZoomEnabled:function(){this.$(".js-zoom").toggleClass("is-hidden",!this.model.get("zoom_enabled"))},_renderAllValues:function(){this._changeHeaderValue(".js-nulls","nulls",""),this._changeHeaderValue(".js-val","total","SELECTED"),this._changeHeaderValue(".js-max","max",""),this._changeHeaderValue(".js-min","min",""),this._changeHeaderValue(".js-avg","avg","")},_changeHeaderValue:function(e,t,i){if(null==this.model.get(t))return void this.$(e).text("0 "+i);this._addTitleForValue(e,t,i),new u({el:this.$el}).animateValue(this.model,t,e,_,{formatter:a.formatNumber,templateData:{suffix:" "+i}})},_onChangeNulls:function(){this._changeHeaderValue(".js-nulls","nulls","")},_onChangeTotal:function(){this._changeHeaderValue(".js-val","total","SELECTED")},_onChangeMax:function(){this._changeHeaderValue(".js-max","max","")},_onChangeMin:function(){this._changeHeaderValue(".js-min","min","")},_onChangeAvg:function(){this._changeHeaderValue(".js-avg","avg","")},_addTitleForValue:function(e,t,i){this.$(e).attr("title",this._formatNumberWithCommas(this.model.get(t).toFixed(2))+" "+i)},_formatNumberWithCommas:function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},_calculateBars:function(e){var t,i,n,a,o,r;return this._isZoomed()&&2===this._numberOfFilters?(t=this.model.get("zmin"),i=this.model.get("zmax"),n=this.model.get("zlo_index"),a=this.model.get("zhi_index")):1===this._numberOfFilters&&(t=this.model.get("min"),i=this.model.get("max"),n=this.model.get("lo_index"),a=this.model.get("hi_index")),e.length>0?(s.isNumber(t)||s.isNumber(n)?s.isNumber(t)&&!s.isNumber(n)&&(o=s.findWhere(e,{start:t}),n=o&&o.bin||0):n=0,s.isNumber(i)||s.isNumber(a)?s.isNumber(i)&&!s.isNumber(a)&&(r=s.findWhere(e,{end:i}),a=r&&r.bin+1||e.length):a=e.length):(n=0,a=e.length),{loBarIndex:n,hiBarIndex:a}},_updateStats:function(){if(this._initStateApplied){var e;if(null!=(e=!this._isZoomed()||this._isZoomed()&&2===this._numberOfFilters?this.histogramChartView.model.get("data"):this.miniHistogramChartView.model.get("data"))){var t,i,n,a,o,r=this._dataviewModel.get("nulls"),l=this._calculateBars(e),d=l.loBarIndex,h=l.hiBarIndex;e&&e.length&&(t=this._calcSum(e,d,h),i=this._calcAvg(e,d,h),d>=0&&d<e.length&&(n=e[d].start),h>=0&&h-1<e.length&&(a=e[Math.max(0,h-1)].end),this._isZoomed()&&2===this._numberOfFilters?o={zmin:n,zmax:a,zlo_index:d,zhi_index:h}:this._isZoomed()||1!==this._numberOfFilters||(o={min:n,max:a,lo_index:d,hi_index:h}),o=s.extend({total:t,nulls:r,avg:i},o),this.model.set(o))}}},_calcAvg:function(e,t,i){var n=e.slice(t,i),a=this._calcSum(e,t,i);return a?s.reduce(n,function(e,t){return t.avg&&t.freq?t.avg*t.freq+e:e},0)/a:0},_calcSum:function(e,t,i){return s.reduce(e.slice(t,i),function(e,t){return t.freq+e},0)},_onChangeZoomed:function(){this.model.get("zoomed")?this._onZoomIn():(this._resetWidget(),this._dataviewModel.fetch())},_showMiniRange:function(){var e=this.model.get("lo_index"),t=this.model.get("hi_index");this.miniHistogramChartView.selectRange(e,t),this.miniHistogramChartView.show()},_zoom:function(){this.model.set({zoomed:!0,zoom_enabled:!1}),this.histogramChartView.removeSelection()},_onZoomIn:function(){this.lockedByUser=!1,this._showMiniRange(),this.histogramChartView.setBounds(),this._dataviewModel.enableFilter(),this._dataviewModel.fetch()},_resetWidget:function(){this._numberOfFilters=0,this.model.set({zoomed:!1,zoom_enabled:!1,filter_enabled:!1,lo_index:null,hi_index:null,min:null,max:null,zlo_index:null,zhi_index:null,zmin:null,zmax:null}),this.filter.unsetRange(),this._dataviewModel.disableFilter(),this.histogramChartView.unsetBounds(),this.miniHistogramChartView.hide(),this._clearTooltip(),this._updateStats()},clean:function(){window.removeEventListener("resize",this._onWindowResized.bind(this)),n.prototype.clean.apply(this)}})},630:function(e,t,i){var s=i(1),n=i(6),a=i(924);e.exports=s.extend({className:"CDB-Widget-title CDB-Widget-contentSpaced",events:{"click .js-autoStyle":"_autoStyle","click .js-cancelAutoStyle":"_cancelAutoStyle"},initialize:function(e){if(!e.widgetModel)throw new Error("widgetModel is required");if(!e.dataviewModel)throw new Error("dataviewModel is required");if(!e.layerModel)throw new Error("layerModel is required");this.widgetModel=e.widgetModel,this.dataviewModel=e.dataviewModel,this._layerModel=e.layerModel,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(a({title:this.widgetModel.get("title"),isAutoStyleEnabled:this._isAutoStyleButtonVisible(),isAutoStyle:this.widgetModel.get("autoStyle"),isCollapsed:this.widgetModel.get("collapsed")})),this._initViews(),this},_initBinds:function(){this.widgetModel.bind("change:title change:collapsed change:autoStyle change:style",this.render,this),this.add_related_model(this.widgetModel),this._layerModel.bind("change:visible change:cartocss",this.render,this),this.add_related_model(this._layerModel)},_initViews:function(){var e=new n({el:this.$el.find(".js-sizes"),gravity:"auto"});this.addView(e);var t=new n({el:this.$el.find(".js-actions"),gravity:"auto"});this.addView(t)},_isAutoStyleButtonVisible:function(){var e=this._layerModel.get("meta"),t=this._layerModel.get("cartocss")||e&&e.cartocss,i=t&&this.widgetModel.hasColorsAutoStyle();return this.widgetModel.isAutoStyleEnabled()&&this._layerModel.get("visible")&&i},_autoStyle:function(){this.widgetModel.autoStyle()},_cancelAutoStyle:function(){this.widgetModel.cancelAutoStyle()}})},631:function(e,t,i){var s=i(0),n=i(78);e.exports=n.extend({defaults:{normalized:!0},defaultState:s.extend({autoStyle:!1,normalized:!1},n.prototype.defaultState),initialize:function(e,t){n.prototype.initialize.apply(this,arguments),this.on("change:collapsed",this._onCollapsedChange,this),this.on("change:style",this._updateAutoStyle,this),this.dataviewModel.once("change",function(){this.get("autoStyle")&&this.autoStyle()},this)},_onCollapsedChange:function(e,t){this.dataviewModel.set("enabled",!t)},getState:function(){var e=n.prototype.getState.call(this),t=this.dataviewModel.get("start"),i=this.dataviewModel.get("end"),a=this.get("min"),o=this.get("max"),r=function(e,n){return!!(s.isNumber(e)&&s.isNumber(n)&&e!==n&&Math.abs(e-n)>.01*Math.abs(t-i))};return r(t,a)?e.min=a:delete e.min,r(i,o)?e.max=o:delete e.max,!0===this.get("zoomed")&&(e.zoomed=!0),e}})},632:function(e,t,i){var s=i(0),n=i(1),a=i(338),o=i(926),r=i(303),l=i(304),d=i(58),h=i(57),c=i(55),u=i(56);e.exports=n.extend({className:"CDB-Widget-body CDB-Widget-body--timeSeries",initialize:function(){if(!this.model.dataviewModel)throw new Error("dataviewModel is required");if(!this.model.layerModel)throw new Error("layerModel is required");this._dataviewModel=this.model.dataviewModel,this._layerModel=this.model.layerModel,this._selectedAmount=0,this._initBinds()},render:function(){this.clearSubViews(),this.$el.empty();var e=this._dataviewModel.get("source").id,t=h.letter(e),i=h.getColorForLetter(t),s=this._dataviewModel.getSourceType()||"",n=this._dataviewModel.isSourceType(),r=n?this.model.get("table_name"):this._layerModel.get("layer_name");return this._isDataEmpty()||this._hasError()?this.$el.append(a({hasTorqueLayer:!1})):(this.$el.append(o({sourceId:e,sourceType:c.title(s),isSourceType:n,showSource:this.model.get("show_source")&&""!==t,sourceColor:i,layerName:u(r)})),this._createHistogramView(),this._createHeaderView(),this._createDropdownView(),this._updateRange()),this},_initBinds:function(){this._dataviewModel.once("error",function(){console.log("the tiler does not support non-torque layers just yet\u2026")}),this.listenTo(this._dataviewModel,"change:data",this.render),this.listenToOnce(this.model,"change:hasInitialState",this.render),this.listenTo(this._layerModel,"change:layer_name",this.render),this.add_related_model(this._layerModel)},_createHistogramView:function(){this._histogramView&&this._histogramView.remove(),this._histogramView=new r({timeSeriesModel:this.model,dataviewModel:this._dataviewModel,layerModel:this._layerModel,rangeFilter:this._dataviewModel.filter,displayShadowBars:!this.model.get("normalized"),normalized:!!this.model.get("normalized")}),this.addView(this._histogramView),this.$(".js-content").append(this._histogramView.render().el)},_createHeaderView:function(){if(this._headerView&&this._headerView.remove(),this._headerView=new l({dataviewModel:this._dataviewModel,layerModel:this._layerModel,rangeFilter:this._dataviewModel.filter,timeSeriesModel:this.model,showClearButton:!0,selectedAmount:this._selectedAmount}),!this._histogramView)throw new Error("Histogram view must be instantiated before the header view");this._headerView.bind("resetFilter",this._histogramView.resetFilter,this._histogramView),this.addView(this._headerView),this.$(".js-title").append(this._headerView.render().el)},_createDropdownView:function(){this._dropdownView&&this._dropdownView.remove(),this._dropdownView=new d({model:this.model,target:".js-actions",container:this.$(".js-header"),flags:{localTimezone:"date"===this._dataviewModel.getColumnType(),normalizeHistogram:!0,canCollapse:!1}}),this.addView(this._dropdownView)},_updateRange:function(){var e=this._calculateBars(),t=this._dataviewModel.get("bins"),i=Math.max(e.loBarIndex,0),s=Math.min(e.hiBarIndex,t);(i>0||s<t)&&this._histogramView.selectRange(i,s)},_calculateBars:function(){var e,t,i=this._dataviewModel.getData(),n=this.model.get("min"),a=this.model.get("max"),o=this.model.get("lo_index"),r=this.model.get("hi_index");return i.length>0?(s.isNumber(n)||s.isNumber(o)?s.isNumber(n)&&!s.isNumber(o)&&(e=s.findWhere(i,{start:n}),o=e&&e.bin||0):o=0,s.isNumber(a)||s.isNumber(r)?s.isNumber(a)&&!s.isNumber(r)&&(t=s.findWhere(i,{end:a}),r=t&&t.bin+1||i.length):r=i.length):(o=0,r=i.length),{loBarIndex:o,hiBarIndex:r}},_appendView:function(e){this.addView(e),this.$el.append(e.render().el)},_isDataEmpty:function(){var e=this._dataviewModel.getUnfilteredData();return s.isEmpty(e)||0===s.size(e)},_hasError:function(){return this._dataviewModel.has("error")}})},633:function(e,t,i){var s=i(78),n=i(0);e.exports=s.extend({defaults:{normalized:!0,animated:!1},defaultState:n.extend({normalized:!1},s.prototype.defaultState),getState:function(){var e,t,i=s.prototype.getState.call(this),a=this.dataviewModel.get("start"),o=this.dataviewModel.get("end"),r=this.dataviewModel.get("data"),l=this.get("lo_index"),d=this.get("hi_index"),h=function(e,t){return!!(n.isNumber(e)&&n.isNumber(t)&&e!==t&&Math.abs(e-t)>.01*Math.abs(a-o))};return n.isNumber(l)&&n.isNumber(d)&&l<r.length&&d-1<r.length?(e=r[l].start,t=r[d-1].end):(e=a,t=o),h(a,e)&&(i.min=e),h(o,t)&&(i.max=t),i}})},634:function(e,t,i){var s=i(0),n=i(1),a=i(930),o=i(338),r=i(637),l=i(636),d=i(58),h=i(57),c=i(55),u=i(56);e.exports=n.extend({className:"CDB-Widget-body CDB-Widget-body--timeSeries",initialize:function(){if(!this.model.dataviewModel)throw new Error("dataviewModel is required");if(!this.model.layerModel)throw new Error("layerModel is required");this._dataviewModel=this.model.dataviewModel,this._layerModel=this.model.layerModel,this._originalData=this._dataviewModel.getUnfilteredDataModel(),this._selectedAmount=0,this._initBinds()},render:function(){this.clearSubViews();var e=this._dataviewModel.get("source").id,t=h.letter(e),i=h.getColorForLetter(t),s=this._dataviewModel.getSourceType()||"",n=this._dataviewModel.isSourceType(),r=n?this.model.get("table_name"):this._layerModel.get("layer_name");return this._isDataEmpty()?this.$el.html(o({hasTorqueLayer:!0})):(this.$el.html(a({sourceId:e,sourceType:c.title(s),isSourceType:n,showSource:this.model.get("show_source")&&""!==t,sourceColor:i,layerName:u(r)})),this._createHeaderView(),this._createTorqueHistogramView(),this._createDropdownView()),this},_createHeaderView:function(){this._headerView&&this._headerView.remove(),this._headerView=new l({el:this.$(".js-torque-header"),dataviewModel:this._dataviewModel,torqueLayerModel:this._layerModel,timeSeriesModel:this.model,selectedAmount:this._selectedAmount}),this.addView(this._headerView),this._headerView.render()},_createTorqueHistogramView:function(){this._histogramView&&this._histogramView.remove(),this._histogramView=new r({timeSeriesModel:this.model,dataviewModel:this._dataviewModel,rangeFilter:this._dataviewModel.filter,torqueLayerModel:this._layerModel,layerModel:this._layerModel,displayShadowBars:!this.model.get("normalized"),normalized:!!this.model.get("normalized")}),this.addView(this._histogramView),this.$el.append(this._histogramView.render().el)},_createDropdownView:function(){this._dropdownView&&this._dropdownView.remove(),this._dropdownView=new d({model:this.model,target:".js-actions",container:this.$(".js-header"),flags:{localTimezone:"date"===this._dataviewModel.getColumnType(),normalizeHistogram:!!this.model.get("normalized"),canCollapse:!1}}),this.addView(this._dropdownView)},_initBinds:function(){this.listenTo(this._originalData,"change:data",this._onOriginalDataChange),this.listenTo(this._dataviewModel,"change:data",this.render),this.listenTo(this._dataviewModel,"change:bins",this._onChangeBins),this.listenTo(this._layerModel,"change:layer_name",this.render),this.add_related_model(this._layerModel)},_isDataEmpty:function(){var e=this._dataviewModel.getData();return s.isEmpty(e)||0===s.size(e)},_onOriginalDataChange:function(){this._dataviewModel.fetch()},_onChangeBins:function(e,t){this._originalData.setBins(t)}})},635:function(e,t,i){var s=i(1),n=i(928);e.exports=s.extend({events:{"click .CDB-Widget-controlButton":"_onClick"},initialize:function(){this._torqueLayerModel=this.options.torqueLayerModel,this._rangeFilter=this.options.rangeFilter,this.listenTo(this._torqueLayerModel,"change:isRunning",this.render),this.listenTo(this._torqueLayerModel,"change:start change.end",this.render)},render:function(){return this.$el.html(n({running:this._torqueLayerModel.get("isRunning"),disabled:!this._rangeFilter.isEmpty()})),this},_onClick:function(){this._torqueLayerModel.get("isRunning")?this._torqueLayerModel.pause():this._torqueLayerModel.play()}})},636:function(e,t,i){var s=i(1),n=i(638),a=i(304),o=i(929);e.exports=s.extend({className:"CDB-Widget-contentSpaced",initialize:function(){this._dataviewModel=this.options.dataviewModel,this._torqueLayerModel=this.options.torqueLayerModel,this._rangeFilter=this._dataviewModel.filter,this._selectedAmount=this.options.selectedAmount,this._timeSeriesModel=this.options.timeSeriesModel,this.listenTo(this._rangeFilter,"change",this.render)},render:function(){var e=!0;return this.clearSubViews(),this.$el.addClass(this.className),this.$el.html(o()),this._rangeFilter.isEmpty()&&(this._appendView(".js-torque-controls",new n({dataviewModel:this._dataviewModel,torqueLayerModel:this._torqueLayerModel,timeSeriesModel:this._timeSeriesModel})),e=!1),this._createTimeSeriesHeaderView(e),this},_createTimeSeriesHeaderView:function(e){var t=new a({dataviewModel:this._dataviewModel,layerModel:this._torqueLayerModel,rangeFilter:this._dataviewModel.filter,showClearButton:e,timeSeriesModel:this._timeSeriesModel,selectedAmount:this._selectedAmount});this._appendView(".js-time-series-header",t),t.on("resetFilter",this._resetFilter,this)},_resetFilter:function(){this._torqueLayerModel.set({step:0}),this._torqueLayerModel.resetRenderRange()},_appendView:function(e,t){this.addView(t),this.$(e).append(t.render().el)}})},637:function(e,t,i){var s=i(0),n=i(303),a=i(639),o=i(635);e.exports=n.extend({defaults:s.extend({},n.prototype.defaults,{offsetLeft:34}),className:function(){return n.prototype.className+" CDB-Widget-content CDB-Widget-content--torqueTimeSeries u-flex"},initialize:function(){if(!this.options.torqueLayerModel)throw new Error("torqeLayerModel is required");if(!this.options.rangeFilter)throw new Error("rangeFilter is required");if(!this.options.dataviewModel)throw new Error("dataviewModel is required");if(!this.options.timeSeriesModel)throw new Error("timeSeriesModel is required");this._torqueLayerModel=this.options.torqueLayerModel,this._dataviewModel=this.options.dataviewModel,this._timeSeriesModel=this.options.timeSeriesModel,n.prototype.initialize.call(this)},_initBinds:function(){n.prototype._initBinds.call(this),this.listenTo(this._torqueLayerModel,"change:renderRange",this._onRenderRangeChanged),this.listenTo(this._torqueLayerModel,"change:steps change:start change:end",this._reSelectRange),this.listenTo(this._torqueLayerModel,"change:cartocss",this._onUpdateCartocss)},_createHistogramView:function(){this._chartType="date"===this._torqueLayerModel.get("column_type")?"time":"number",n.prototype._createHistogramView.call(this),this._torqueControls=new o({torqueLayerModel:this._torqueLayerModel,rangeFilter:this._rangeFilter}),this.addView(this._torqueControls),this.$el.prepend(this._torqueControls.render().el),this._chartView.setAnimated(),this._chartView.bind("on_brush_click",this._onBrushClick,this),this._timeSliderView=new a({dataviewModel:this._dataviewModel,chartView:this._chartView,torqueLayerModel:this._torqueLayerModel,timeSeriesModel:this._timeSeriesModel,rangeFilter:this._rangeFilter}),this.addView(this._timeSliderView),this._timeSliderView.render()},_onChangeData:function(){n.prototype._onChangeData.call(this),this._chartView&&this._reSelectRange()},_onRenderRangeChanged:function(e,t){void 0===t.start&&void 0===t.end&&(this._chartView.removeSelection(),this._rangeFilter.unsetRange())},_onBrushClick:function(e){var t=this._torqueLayerModel.get("steps"),i=Math.round(t*e);i===t&&(i-=1),n.prototype.resetFilter.apply(this),this._torqueLayerModel.set({step:i})},_onBrushEnd:function(){n.prototype._onBrushEnd.apply(this,arguments),this._reSelectRange()},_timeToStep:function(e,t){var i=this._torqueLayerModel.get("steps"),s=this._torqueLayerModel.get("start"),n=this._torqueLayerModel.get("end"),a=n-s==0?"max"===t?i:0:i*(1e3*e-s)/(n-s);return a=Number(a.toFixed(2))},_reSelectRange:function(e){if(this._rangeFilter.isEmpty())this._torqueLayerModel.play(),this._updateDuration(1);else{this._torqueLayerModel.pause();var t=this._rangeFilter.get("min"),i=this._rangeFilter.get("max"),n=this._timeToStep(t,"min"),a=this._timeToStep(i,"max"),o=this._dataviewModel.get("data"),r=s.findWhere(o,{start:t}),l=s.findWhere(o,{end:i});if(!r||!l)return this._torqueLayerModel.resetRenderRange();var d=this._torqueLayerModel.get("steps"),h=this._chartView.getSelectionExtent()/100;this._updateDuration(h),this._torqueLayerModel.renderRange(this._clampRangeVal(0,d,n),this._clampRangeVal(0,d,a))}},_updateDuration:function(e,t){if(this._torqueLayerModel.getAnimationDuration){var i=this._torqueLayerModel.getAnimationDuration(t||this._torqueLayerModel.get("cartocss"));this._torqueLayerModel.set("customDuration",Math.round(i*e))}},_onUpdateCartocss:function(e,t){var i;if(this._rangeFilter.isEmpty())i=1;else{var s=this._timeToStep(this._rangeFilter.get("min"));i=(this._timeToStep(this._rangeFilter.get("max"))-s)/this._torqueLayerModel.get("steps")}this._updateDuration(i,t,{silent:!0})},_clampRangeVal:function(e,t,i){return Math.max(e,Math.min(t,i))},_getMarginLeft:function(){return 16}})},638:function(e,t,i){var s=i(35),n=i(1),a=i(5),o=i(23),r=i(931);e.exports=n.extend({className:"CDB-Widget-timeSeriesTimeInfo",initialize:function(e){if(!e.torqueLayerModel)throw new Error("torqueLayerModel is required");if(!e.dataviewModel)throw new Error("dataviewModel is required");if(!e.timeSeriesModel)throw new Error("timeSeriesModel is required");this._torqueLayerModel=this.options.torqueLayerModel,this._dataviewModel=this.options.dataviewModel,this._timeSeriesModel=this.options.timeSeriesModel,this._initBinds()},render:function(){var e=this._torqueLayerModel.get("time"),t=this._torqueLayerModel.get("column_type"),i=s.scale.linear().domain([0,this._dataviewModel.get("data").length]).range([this._dataviewModel.get("start"),this._dataviewModel.get("end")]),n="",l=o.formatNumber;return"number"===t?n=r({time:l(i(this._torqueLayerModel.get("step")))}):"date"!==t||isNaN(e&&e.getTime())||(l=o.timestampFactory(this._dataviewModel.get("aggregation"),this._dataviewModel.getCurrentOffset()),n=r({time:l(a(e).unix())})),this.$el.html(n),this},_initBinds:function(){this.listenTo(this._torqueLayerModel,"change:step",this.render)}})},639:function(e,t,i){var s=i(35),n=i(8),a=i(1),o=i(5),r=i(23),l=i(114);e.exports=a.extend({defaults:{width:6,height:8},initialize:function(){if(!this.options.chartView)throw new Error("chartView is required");if(!this.options.torqueLayerModel)throw new Error("torqeLayerModel is required");if(!this.options.timeSeriesModel)throw new Error("timeSeriesModel is required");this.model=new n.core.Model,this._dataviewModel=this.options.dataviewModel,this._chartView=this.options.chartView,this._torqueLayerModel=this.options.torqueLayerModel,this._timeSeriesModel=this.options.timeSeriesModel,this._chartMargins=this._chartView.model.get("margin"),this._initBinds(),this._updateXScale(),this._createFormatter()},render:function(){if(!this.timeSlider){var e=s.behavior.drag().on("dragstart",this._onDragStart.bind(this)).on("drag",this._onDrag.bind(this)).on("dragend",this._onDragEnd.bind(this)),t=this._chartView.canvas.append("rect");this.timeSlider=t.attr("class","CDB-TimeSlider").attr("width",this.defaults.width).attr("height",this._calcHeight()).attr("rx",3).attr("ry",3).data([{x:0,y:0}]).attr("transform",this._translateXY).call(e),this.setElement(t.node())}return this._isTabletViewport()&&this._generateTimeSliderTip(),this},_isTabletViewport:function(){return l.isTabletViewport()},_generateTimeSliderTip:function(){var e=this._calcHeight()/2+3+2;e=Math.floor(e),this.timeSliderTip=this._chartView.canvas.select(".CDB-WidgetCanvas").append("g").attr("class","CDB-Chart-timeSliderTip").data([{x:16,y:e}]).attr("transform",this._translateXY),this.timeSliderTip.append("rect").attr("class","CDB-Chart-timeSliderTipRect").attr("rx","2").attr("ry","2").attr("height",17),this.timeSliderTip.append("text").attr("class","CDB-Text CDB-Size-small CDB-Chart-timeSliderTipText").attr("dy","11").attr("dx","0")},_onLocalTimezoneChanged:function(){this._createFormatter(),this._updateTimeSliderTip()},_updateTimeSliderTip:function(){var e=this,t=this._isDateTimeSeries()?this._torqueLayerModel.get("time"):this._torqueLayerModel.get("step");if(void 0!==t){var i=this._chartView.canvas,n=i.select(".CDB-Chart-timeSliderTipText"),a=s.scale.linear().domain([0,this._dataviewModel.get("data").length]).range([this._dataviewModel.get("start"),this._dataviewModel.get("end")]);if(n.data([t]).text(function(t){return e._isDateTimeSeries()?this.formatter(o(t).unix()):this.formatter(a(t))}.bind(this)),n.node()){var r=i.select(".CDB-Chart-timeSliderTipRect"),l=n.node().getBBox(),d=l.width,h=d+6,c=this._chartView.chartWidth()+16;r.attr("width",h),n.attr("dx",3),n.attr("dy",l.height-Math.abs((l.height-17)/2));var u=this._xScale(this._torqueLayerModel.get("step")),_=u+this.defaults.width-h/2,g=this._calcHeight()/2+3+2;g=Math.floor(g);var p=this.timeSliderTip.data();p[0].y=g;var m=_;_<16?m=16:_+h>=c&&(m=c-h),isNaN(m)||(p[0].x=m,this.timeSliderTip.data(p).transition().ease("linear").attr("transform",this._translateXY))}}},_initBinds:function(){this.listenTo(this._torqueLayerModel,"change:start change:end",this._updateChartandTimeslider),this.listenTo(this._torqueLayerModel,"change:step",this._onChangeStep),this.listenTo(this._torqueLayerModel,"change:time",this._onChangeTime),this.listenTo(this._torqueLayerModel,"change:steps",this._updateChartandTimeslider),this.listenTo(this._chartView.model,"change:width",this._updateChartandTimeslider),this.listenTo(this._chartView.model,"change:height",this._onChangeChartHeight),this.listenTo(this._dataviewModel,"change:bins",this._updateChartandTimeslider),this.listenTo(this._dataviewModel,"change:column_type",this._createFormatter),this.listenTo(this._dataviewModel.filter,"change:min change:max",this._onFilterMinMaxChange),this.listenTo(this._timeSeriesModel,"change:local_timezone",this._onLocalTimezoneChanged),this.listenTo(this._dataviewModel,"change:start change:end",this._updateChartandTimeslider)},clean:function(){this.timeSlider&&this.timeSlider.remove(),a.prototype.clean.call(this)},_onFilterMinMaxChange:function(e,t){this.$el.toggle(!t)},_onDragStart:function(){var e=this._torqueLayerModel.get("isRunning");e&&this._torqueLayerModel.pause(),this.model.set({isDragging:!0,wasRunning:e})},_onDrag:function(e,t){var i=e.x+s.event.dx;if(this._isWithinRange(i)){e.x=i,this.timeSlider.attr("transform",this._translateXY);var n=Math.round(this._xScale.invert(e.x));this._torqueLayerModel.setStep(n)}},_onDragEnd:function(){this.model.set("isDragging",!1),this.model.get("wasRunning")&&this._torqueLayerModel.play()},_translateXY:function(e){return"translate("+[e.x,e.y]+")"},_isWithinRange:function(e){return e>=this._chartMargins.left&&e<=this._width()-this._chartMargins.right},_onChangeStep:function(){if(this.timeSlider&&!this.model.get("isDragging")){var e=this.timeSlider.data(),t=this._xScale(this._torqueLayerModel.get("step"));isNaN(t)||(e[0].x=t,this.timeSlider.data(e).transition().ease("linear").attr("transform",this._translateXY))}},_onChangeChartHeight:function(){var e=this._isTabletViewport()?this._calcHeight()/2+3:this._calcHeight();this.timeSlider.attr("height",e)},_onChangeTime:function(){if(this._dataviewModel.filter.isEmpty()&&this._isTabletViewport()){this._chartView.canvas.select(".CDB-Chart-timeSliderTip").node()||this._generateTimeSliderTip(),this._updateTimeSliderTip()}else this._removeTimeSliderTip()},_removeTimeSliderTip:function(){var e=this._chartView.canvas.select(".CDB-Chart-timeSliderTip");e.node()&&e.remove()},_updateChartandTimeslider:function(){this._updateXScale(),this._onChangeStep()},_calcHeight:function(){return this._chartView.chartHeight()+this.defaults.height},_createFormatter:function(){this.formatter=r.formatNumber,this._isDateTimeSeries()&&(this.formatter=r.timestampFactory(this._dataviewModel.get("aggregation"),this._dataviewModel.getCurrentOffset()))},_isDateTimeSeries:function(){return"date"===this._dataviewModel.getColumnType()},_updateXScale:function(){var e=1e3*(this._dataviewModel.get("end")-this._dataviewModel.get("start")),t=(this._torqueLayerModel.get("start")-1e3*this._dataviewModel.get("start"))/e,i=(this._torqueLayerModel.get("end")-1e3*this._dataviewModel.get("start"))/e,n=t*this._width()+this._chartMargins.left,a=i*this._width()-this._chartMargins.right;n=n<0?this._chartMargins.left:n,a=a>this._width()?this._width()-this._chartMargins.right:a,this._xScale=s.scale.linear().domain([0,this._torqueLayerModel.get("steps")]).range([n,a])},_width:function(){return this._chartView.model.get("width")}})},640:function(e,t,i){var s=i(1),n=i(0),a=i(932),o=i(933);e.exports=s.extend({className:"CDB-Widget-body is-hidden",events:{"click .js-refresh":"_onRefreshClick"},initialize:function(e){this._title=e.title,this._errorModel=e.errorModel,this.listenTo(this._errorModel,"change",this._onErrorModelChanged)},render:function(){var e=this._errorModel.get("error");if(e){var t=this._errorModel.get("placeholder"),i=n.isFunction(t)?t():"";this.$el.addClass("CDB-Widget--"+e.level);var s=e.type?o({placeholder:i,error:e.error,title:this._title,message:e.message,refresh:e.refresh}):a({placeholder:i});this.$el.html(s)}return this},_onErrorModelChanged:function(){this._reset(),n.isEmpty(this._errorModel.get("error"))?this.$el.addClass("is-hidden"):this.$el.removeClass("is-hidden"),this.render()},_onRefreshClick:function(){this._errorModel.get("model").refresh()},_reset:function(){this.$el.removeClass("CDB-Widget--alert CDB-Widget--error"),this.$el.html("")}})},641:function(e,t,i){var s=i(1);e.exports=s.extend({className:"CDB-Widget-loader",initialize:function(){this._initBinds()},render:function(){return this.$el.append('<div class="CDB-Loader js-loader"></div>'),this},show:function(){this.$(".js-loader").addClass("is-visible"),clearTimeout(this._timeout)},hide:function(){var e=this;this._timeout=setTimeout(function(){e.$(".js-loader").removeClass("is-visible")},500)},_initBinds:function(){this.model.bind("loading",this.show,this),this.model.bind("error",function(e,t){(!t||t&&"abort"!==t.statusText)&&this.hide()},this),this.model.bind("loaded",this.hide,this)}})},642:function(e,t,i){var s=i(2),n=i(0),a=i(1),o=i(641),r=i(640),l=i(611),d=i(297),h=i(7),c={category:i(335),formula:i(920),histogram:i(337)};e.exports=a.extend({className:"CDB-Widget CDB-Widget--light",options:{columns_title:[]},initialize:function(){this.errorModel=new s.Model({});var e=this.model.dataviewModel;this.listenTo(this.model,"destroy",this.clean),this.listenTo(this.model,"error",this._onError),this.listenTo(this.model,"setDisabled",this._setDisabled),this.listenTo(e,"statusError",this._onError),this.listenTo(e,"sync change:data",this._onDataChanged)},render:function(){return this.clearSubViews(),this.$el.empty(),this._appendView(new o({model:this.model.dataviewModel})),this._appendView(new r({title:this.model.get("title"),errorModel:this.errorModel})),this._appendView(this.options.contentView),this},_onDataChanged:function(e){return this._noDataAvailable()?(this.options.contentView.$el.addClass("is-hidden"),this.errorModel.set({model:e,error:l({type:"no_data_available"}),placeholder:this._getPlaceholder()})):this._dataHasTooManyBins()?(this.options.contentView.$el.addClass("is-hidden"),this.errorModel.set({model:e,error:l({type:"too_many_bins"}),placeholder:this._getPlaceholder()})):void(n.isEmpty(this.errorModel.get("error"))||(this.errorModel.clear(),this.options.contentView.render(),this.options.contentView.$el.removeClass("is-hidden")))},_onError:function(e,t){if(!t||"abort"!==t.message){var i=l(t);this.options.contentView.$el.addClass("is-hidden"),this.errorModel.set({model:e,error:i,placeholder:this._getPlaceholder()})}},_appendView:function(e){this.$el.append(e.render().el),this.addView(e)},_noDataAvailable:function(){var e=this._isHistogram()?"totalAmount":"data",t=this.model.dataviewModel.get(e);return!h.hasValue(t)||n.isArray(t)&&n.isEmpty(t)},_dataHasTooManyBins:function(){if(this._isHistogram()){var e=this.model.dataviewModel.getUnfilteredData&&this.model.dataviewModel.getUnfilteredData();return!n.isEmpty(e)&&n.size(e)>367}return!1},_isHistogram:function(){return"histogram"===this.model.dataviewModel.get("type")},_extractError:function(e){var t=d(e,"responseJSON.errors_with_context",[]);return t.length>0?t[0]:e&&e.message?(e.type=e.type||"generic",e):{}},_getPlaceholder:function(){var e=this.model.dataviewModel.get("type");return c[e]},_setDisabled:function(e,t){var i=e.get("id")!==t;t&&!i&&this.el.scrollIntoView&&this.el.scrollIntoView(),this.$el.toggleClass("is-disabled",null!==t&&i)}})},643:function(e,t,i){var s=i(0),n=i(2);e.exports=n.Collection.extend({comparator:"order",initialize:function(){this._allDataviewsFetched=!1,this._initBinds()},_initBinds:function(){this.bind("change:order",s.debounce(this._onChangeOrder.bind(this),10),this),this.bind("change:autoStyle",function(e,t){t&&this.each(function(t){t.layerModel&&t!==e&&t.layerModel.get("layer_name")===e.layerModel.get("layer_name")&&t.get("autoStyle")&&t.set("autoStyle",!1)})},this)},_onChangeOrder:function(){this.sort(),this.trigger("orderChanged",this)},getStates:function(){var e={};return this.each(function(t){var i=t.getState();s.isEmpty(i)||(e[t.get("id")]=i)}),e},setStates:function(e){for(var t in e){this.at(t).setState(e[t])}},hasInitialState:function(){return this._allDataviewsFetched},initialState:function(){this._allDataviewsFetched=!0}})},647:function(e,t,i){var s=i(3),n=i(0),a=i(2),o=a.Model.extend({initialize:function(e){return n.bindAll(this,"fetch","save","retrigger"),a.Model.prototype.initialize.call(this,e)},fetch:function(e){var t=this;this.trigger("loadModelStarted"),s.when(a.Model.prototype.fetch.call(this,e)).done(function(e){t.trigger("loadModelCompleted",e,t)}).fail(function(e){t.trigger("loadModelFailed",e,t)})},setIdAttribute:function(e){this.idAttribute=e},retrigger:function(e,t,i){i||(i=e);var s=this;t.bind&&t.bind(e,function(){s.trigger(i)},s)},save:function(e,t){var i=this;t&&t.silent||this.trigger("saving");var n=a.Model.prototype.save.apply(this,arguments);return s.when(n).done(function(){t&&t.silent||i.trigger("saved")}).fail(function(){t&&t.silent||i.trigger("errorSaving")}),n}});e.exports=o},652:function(e,t,i){function webpackContext(e){return i(webpackContextResolve(e))}function webpackContextResolve(e){var t=s[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var s={"./0.1.0/reference.json":653,"./0.10.0/reference.json":654,"./0.14.0/reference.json":655,"./0.15.0/reference.json":656,"./0.16.0/reference.json":657,"./0.17.0/reference.json":658,"./0.18.0/reference.json":659,"./0.19.0/reference.json":660,"./0.2.0/reference.json":661,"./0.20.0/reference.json":662,"./0.21.0/reference.json":663,"./0.22.0/reference.json":664,"./0.23.0/reference.json":665,"./0.26.0/reference.json":666,"./0.27.0/reference.json":667,"./0.29.0/reference.json":668,"./0.3.0/reference.json":669,"./0.33.0/reference.json":670,"./0.34.0/reference.json":671,"./0.37.0/reference.json":672,"./0.37.1/reference.json":673,"./0.38.0/reference.json":674,"./0.4.0/reference.json":675,"./0.40.0/reference.json":676,"./0.41.0/reference.json":677,"./0.43.0/reference.json":678,"./0.44.0/reference.json":679,"./0.47.0/reference.json":680,"./0.51.0/reference.json":681,"./0.52.0/reference.json":682,"./0.54.0/reference.json":683,"./0.55.0/reference.json":684,"./0.55.1/reference.json":685,"./0.58.1/reference.json":686,"./0.59.3/reference.json":687,"./0.59.4/reference.json":688,"./0.6.0/reference.json":689,"./0.7.0/reference.json":690,"./0.9.0/reference.json":691};webpackContext.keys=function(){return Object.keys(s)},webpackContext.resolve=webpackContextResolve,e.exports=webpackContext,webpackContext.id=652},7:function(e,t,i){var s=i(0),n=i(8);e.exports={isURL:function(e){var t=/^((http|https|ftp)\:\/\/)/g;return!!e&&t.test(e)},isBlank:function(e){return!e||/^\s*$/.test(e)},readablizeBytes:function(e,t){if(!e||isNaN(e))return 0;var i=["bytes","kB","MB","GB","TB","PB"],s=Math.floor(Math.log(e)/Math.log(1024)),n=(e/Math.pow(1024,Math.floor(s))).toFixed(2);return t&&(n=parseInt(n,10)),n+" "+i[s]},readizableNumber:function(e){return e>=1e9?(e/1e9).toFixed(1)+"G":e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e},formatNumber:function(e){if(!e)return"0";var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")},result:function(e,t){if(null==e)return null;var i=e[t];return s.isFunction(i)?i.apply(e,Array.prototype.slice.call(arguments,2)):i},getFileExtension:function(e){return e?e.substr(e.lastIndexOf(".")+1):""},pad:function(e,t){for(var i=e+"";i.length<t;)i="0"+i;return i},formatDate:function(e){if(!e.time)throw new Error;if(void 0===e.month)throw new Error;if(void 0===e.year)throw new Error;if(!e.day)throw new Error;var t=parseInt(e.month+1,10),i=function(e){return e=String(e),e<10&&1===e.length?"0"+e:e};return e.year+"-"+i(t)+"-"+i(e.day)+"T"+e.time+"Z"},rgbToHex:function(e,t,i){function componentToHex(e){var t=e.toString(16);return 1===t.length?"0"+t:t}return"#"+componentToHex(e)+componentToHex(t)+componentToHex(i)},isValidHex:function(e){return!!e.match(/(^#?[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i)},hexToRGB:function(e){e||(e="#FFFFFF");var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,i,s){return t+t+i+i+s+s});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null},hexToRGBA:function(e,t){var i=this.hexToRGB(e);return t=null!=t?function(e){return+(Math.round(e+"e+2")+"e-2")}(t):1,i?"rgba("+[i.r,i.g,i.b,t].join(", ")+")":e},stripHTML:function(e,t){t=(((t||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var i=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return e&&"string"==typeof e?e.replace(i,function(e,i){return t.indexOf("<"+i.toLowerCase()+">")>-1?e:""}):""},escapeHTML:function(e){return s.escape(e)},sanitizeString:function(e){return e.replace(/[^a-z0-9\s]/gi,"").replace(/[_\s]/g,"_")},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},formatDecimalPositions:function(e){var t,i=+e,s=0;if(isNaN(i)||0===i)return e;t=Math.abs(i),t>10?s=1:t>.01&&(s=Math.min(Math.ceil(Math.abs(Math.log(t)/Math.log(10)))+2,2)),e=e.toFixed(s);var n=e.match(/(\.0+)$/);return n&&(e=e.replace(n[0],"")),e},removeNewLines:function(e){return e.replace(/(\r\n|\n|\r)/gm,"")},replaceLastSpaceWithNbsp:function(e){var t=e.lastIndexOf(" ");return e.substr(0,t)+"\xa0"+e.substr(t+1)},endsWith:function(e,t){return-1!==e.indexOf(t,e.length-t.length)},cloneObject:function(e){return e?JSON.parse(JSON.stringify(e)):e},capitalize:function(e){return e?e.charAt(0).toUpperCase()+e.slice(1):e},sanitizeHtml:function(e){return n.core.sanitize.sanitize(e||"")},hasValue:function(e){return null!==e&&void 0!==e&&""!==e&&!("number"==typeof e&&isNaN(e))}}},77:function(e,t,i){var s=i(0),n=i(35),a=i(1);e.exports=a.extend({animateFromValues:function(e,t,i,a,o){var r=this.$(i),l=o||{},d=l.formatter||n.format("0,000"),h=l.templateData||{},c=l.debounceWait||500,u=t%1==0,_=function(e){e=u?Math.round(e):e;var t=s.isNaN(e)||void 0===e?l.defaultValue||0:d(e),i=s.extend({value:t},h);r.text(a(i))};if(0===l.animationSpeed)return void _(t);_(e),s.debounce(function(){r.prop("counter",e).stop().animate({counter:t},{duration:l.animationSpeed||500,easing:l.easingMethod||"swing",step:_})},c)()},animateFromCurrentValue:function(e,t,i,a){var o=this.$(t),r=a||{},l=r.debounceWait||500,d=e,h=+this.$(t).text(),c=r.formatter||n.format("0,000"),u=r.templateData||{},_=d%1==0,g=function(t){t=_?Math.round(t):t,e=s.isNaN(t)||void 0===t?r.defaultValue||0:c(t);var n=s.extend({value:e},u);o.text(i(n))};if(0===r.animationSpeed)return void g(d);g(h),s.debounce(function(){o.prop("counter",h).stop().animate({counter:d},{duration:r.animationSpeed||500,easing:r.easingMethod||"swing",step:g})},l)()},animateValue:function(e,t,i,a,o){var r=this.$(i),l=o||{},d=l.debounceWait||500,h=e.get(t),c=e.previous(t)||0,u=l.formatter||n.format("0,000"),_=l.templateData||{},g=h%1==0,p=function(e){e=g?Math.round(e):e;var t=s.isNaN(e)||void 0===e?l.defaultValue||0:u(e),i=s.extend({value:t},_);r.text(a(i))};if(0===l.animationSpeed)return void p(h);p(c),s.debounce(function(){r.prop("counter",c).stop().animate({counter:h},{duration:l.animationSpeed||500,easing:l.easingMethod||"swing",step:p})},d)()}})},78:function(e,t,i){var s=i(0),n=i(8),a=i(616);e.exports=n.core.Model.extend({defaults:{attrsNames:[],show_stats:!1,show_source:!1},defaultState:{collapsed:!1},initialize:function(e,t,i){if(i=i||{},!t.dataviewModel)throw new Error("dataviewModel is required.");if(!t.layerModel)throw new Error("layerModel is required.");this.dataviewModel=t.dataviewModel,this.layerModel=t.layerModel,this._autoStyleEnabledWhenCreated=void 0===i.autoStyleEnabled||i.autoStyleEnabled,this.activeAutoStyler(),this.listenTo(this,"change:style",this.activeAutoStyler)},activeAutoStyler:function(){this.isAutoStyleEnabled()&&!this.autoStyler&&(this.autoStyler=a.get(this.dataviewModel,this.layerModel,this.get("style")))},update:function(e){var t=s.pick(e,this.get("attrsNames"));return this.set(t),this.dataviewModel.update(e),this._triggerChangesInAutoStyle(),!(!this.changedAttributes()&&!this.dataviewModel.changedAttributes())},_triggerChangesInAutoStyle:function(){var e=this.changed&&this.changed.style&&this.changed.style.auto_style&&this.changed.style.auto_style.definition,t=this.previousAttributes(),i=t.style&&t.style.auto_style&&t.style.auto_style.definition;s.isEqual(e,i)||this.trigger("customAutoStyle",this)},remove:function(){this.dataviewModel.remove(),this.trigger("destroy",this),this.stopListening()},isAutoStyleEnabled:function(){var e=this.get("style");return("category"===this.get("type")||"histogram"===this.get("type"))&&(e&&e.auto_style?e&&e.auto_style&&e.auto_style.allowed:this._autoStyleEnabledWhenCreated)},getWidgetColor:function(){var e=this.get("style"),t=e&&e.widget_style,i=t&&t.definition&&t.definition.color&&t.definition.color.fixed;return(t&&t.widget_color_changed||t&&!t.widget_color_changed&&"#9DE0AD"!==i)&&i},hasColorsAutoStyle:function(){var e=this.getAutoStyle(),t=!1;return!(!e||s.isEmpty(e)||s.isEmpty(e.definition))&&(s.each(e.definition,function(e){e.color&&e.color.range&&e.color.range.length>0&&(t=!0)},this),t)},getColor:function(e){return this.isAutoStyleEnabled()&&this.isAutoStyle()&&"category"===this.get("type")?this.autoStyler.colors.getColorByCategory(e):this.getWidgetColor()},isAutoStyle:function(){return this.get("autoStyle")},autoStyle:function(){if(this.isAutoStyleEnabled()&&this.dataForAutoStyle()){var e=this.layerModel,t=e.get("cartocss");!t&&e.get("meta")&&(t=e.get("meta").cartocss),e.set("initialStyle",t);var i=this.autoStyler.getStyle();e.set("cartocss",i),this.set("autoStyle",!0)}},dataForAutoStyle:function(){return this.dataviewModel.get("data").length>0},reapplyAutoStyle:function(){var e=this.autoStyler.getStyle();this.layerModel.set("cartocss",e),this.set("autoStyle",!0)},cancelAutoStyle:function(e){e||this.layerModel.restoreCartoCSS(),this.set("autoStyle",!1)},getAutoStyle:function(){var e=this.get("style"),t=this.layerModel,i=t.get("cartocss")||t.get("meta")&&t.get("meta").cartocss;if(this.isAutoStyleEnabled()&&this.autoStyler){if(e&&e.auto_style&&e.auto_style.definition){var n=s.extend(e.auto_style,{cartocss:i});return s.extend({},n,{definition:this.autoStyler.getDef(i)})}return{definition:this.autoStyler.getDef(i),cartocss:i}}return{}},_updateAutoStyle:function(e,t){this.autoStyler&&this.autoStyler.updateStyle(t),this.isAutoStyle()&&this.reapplyAutoStyle()},setInitialState:function(e){this.initialState=e||{}},applyInitialState:function(){var e=s.extend(this.initialState,{hasInitialState:!0});this.setState(e)},setState:function(e){this.set(e)},getState:function(){var e={};for(var t in this.defaultState){var i=this.get(t),n=this.defaultState[t];void 0===n||void 0===i||s.isEqual(i,n)||(e[t]=i)}return e},forceResize:function(){var e=this.get("type");"time-series"!==e&&"histogram"!==e||this.trigger("forceResize")}})},904:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="CDB-Dashboard-menuContainer">\n  <div class="CDB-Dashboard-menuInner">\n    <div class="CDB-Dashboard-menuHeader">\n      ',!0===showLogo&&(__p+='\n      <div class="CDB-Dashboard-menuLogo">\n        <a href="http://carto.com" target="_blank">\n          <svg viewBox="0 0 62 24" height="24" width="62">\n              <g class="CDB-EmbedLogo" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n                  <path d="M3.94693333,15.9877346 C5.63066667,15.9877346 6.60373333,15.2552013 7.32533333,14.260268 L5.72906667,13.1232013 C5.26986667,13.6808013 4.79973333,14.0525346 4.0016,14.0525346 C2.93013333,14.0525346 2.17573333,13.1560013 2.17573333,12.0080013 L2.17573333,11.9861346 C2.17573333,10.8709346 2.93013333,9.95253464 4.0016,9.95253464 C4.73413333,9.95253464 5.23706667,10.3133346 5.6744,10.849068 L7.27066667,9.6136013 C6.5928,8.68426797 5.58693333,8.02826797 4.02346667,8.02826797 C1.7056,8.02826797 0,9.7776013 0,12.0080013 L0,12.029868 C0,14.3149346 1.76026667,15.9877346 3.94693333,15.9877346 L3.94693333,15.9877346 Z M10.93653,15.834668 L13.1559967,15.834668 L13.7026634,14.457068 L16.6655967,14.457068 L17.2122634,15.834668 L19.4863967,15.834668 L16.2282634,8.12666797 L14.18373,8.12666797 L10.93653,15.834668 Z M14.3258634,12.8061346 L15.1895967,10.6413346 L16.0423967,12.8061346 L14.3258634,12.8061346 Z M23.61653,15.834668 L25.7375966,15.834668 L25.7375966,13.5168013 L26.6778633,13.5168013 L28.2194633,15.834668 L30.6575966,15.834668 L28.83173,13.1669346 C29.78293,12.7624013 30.40613,11.9861346 30.40613,10.8053346 L30.40613,10.783468 C30.40613,10.029068 30.17653,9.4496013 29.7282633,9.00133464 C29.2143966,8.48746797 28.40533,8.18133464 27.2354633,8.18133464 L23.61653,8.18133464 L23.61653,15.834668 Z M25.7375966,11.8549346 L25.7375966,10.0072013 L27.1370633,10.0072013 C27.8367966,10.0072013 28.2850633,10.3133346 28.2850633,10.9256013 L28.2850633,10.947468 C28.2850633,11.505068 27.8586633,11.8549346 27.1479966,11.8549346 L25.7375966,11.8549346 Z M36.7338633,15.834668 L38.8549299,15.834668 L38.8549299,10.0400013 L41.1509299,10.0400013 L41.1509299,8.18133464 L34.4487966,8.18133464 L34.4487966,10.0400013 L36.7338633,10.0400013 L36.7338633,15.834668 Z" class="CDB-EmbedLogo-text" fill="#FFFFFF"></path>\n                  <g class="CDB-EmbedLogo-image"\n                    ',hasTranslation&&(__p+='\n                      transform="translate(37.000000, 0.000000)"\n                    '),__p+='\n                  >\n                      <circle class="CDB-EmbedLogo-halo" fill="rgba(255, 255, 255, 0.20)"  cx="12.3333333" cy="12" r="12"></circle>\n                      <path d="M12.3333333,16.5 C14.8186147,16.5 16.8333333,14.4852814 16.8333333,12 C16.8333333,9.51471863 14.8186147,7.5 12.3333333,7.5 C9.84805196,7.5 7.83333333,9.51471863 7.83333333,12 C7.83333333,14.4852814 9.84805196,16.5 12.3333333,16.5 L12.3333333,16.5 Z" class="CDB-EmbedLogo-point" fill="#FFFFFF" ></path>\n                  </g>\n              </g>\n          </svg>\n        </a>\n      </div>\n      '),__p+='\n\n      <ul class="CDB-Dashboard-menuActions">\n        <li class="CDB-Dashboard-menuActionsItem">\n          <a href="https://twitter.com/share?url='+__e(urlWithoutParams)+"&text="+__e(shortTitle)+'" target="_blank" class="u-hintTextColor">\n            <i class="CDB-IconFont CDB-IconFont-twitter CDB-Size-large"></i>\n          </a>\n        </li>\n        <li class="CDB-Dashboard-menuActionsItem">\n          <a href="http://www.facebook.com/sharer.php?u='+__e(urlWithoutParams)+"&text="+__e(shortTitle)+'" target="_blank" class="u-hintTextColor">\n            <i class="CDB-IconFont CDB-IconFont-facebook CDB-Size-medium"></i>\n          </a>\n        </li>\n        ',inIframe&&(__p+='\n          <li class="CDB-Dashboard-menuActionsItem">\n            <a href="'+__e(url)+'" target="_blank" class="u-hintTextColor">\n              <i class="CDB-IconFont CDB-IconFont-anchor CDB-Size-medium"></i>\n            </a>\n          </li>\n        '),__p+='\n      </ul>\n\n\n      <div class="CDB-Dashboard-menuInfo">\n        <button class="js-toggle-view">\n          <i class="CDB-IconFont CDB-Size-medium CDB-IconFont-rArrowLight Size-large"></i>\n        </button>\n      </div>\n\n      <div class="CDB-Dashboard-menuTexts CDB-Dashboard-hideMobile">\n        <div class="CDB-Dashboard-menuTextInner js-content">\n          <button class="js-toggle-view u-actionTextColor CDB-Dashboard-menuTextActions">\n            <svg width="10px" height="7px" viewBox="12 13 10 7" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n              <path d="M12,13.5 C12,13.2238576 12.1908338,13 12.4169561,13 L21.5830439,13 C21.8133224,13 22,13.2319336 22,13.5 C22,13.7761424 21.8091662,14 21.5830439,14 L12.4169561,14 C12.1866776,14 12,13.7680664 12,13.5 L12,13.5 L12,13.5 Z M12,16.5 C12,16.2238576 12.1908338,16 12.4169561,16 L21.5830439,16 C21.8133224,16 22,16.2319336 22,16.5 C22,16.7761424 21.8091662,17 21.5830439,17 L12.4169561,17 C12.1866776,17 12,16.7680664 12,16.5 L12,16.5 L12,16.5 Z M12,19.5 C12,19.2238576 12.1908338,19 12.4169561,19 L21.5830439,19 C21.8133224,19 22,19.2319336 22,19.5 C22,19.7761424 21.8091662,20 21.5830439,20 L12.4169561,20 C12.1866776,20 12,19.7680664 12,19.5 L12,19.5 L12,19.5 Z" id="Combined-Shape" stroke="none" fill="#1785fB" fill-rule="evenodd"></path>\n            </svg>\n          </button>\n          <p class="CDB-Dashboard-menuTime CDB-Text CDB-Size-small u-upperCase u-altTextColor u-bSpace--m js-timeAgo">UPDATED '+__e(updatedAt)+'</p>\n          <div class="CDB-Dashboard-metadata">\n            <h1 class="CDB-Dashboard-menuTitle CDB-Dashboard-menuTitle--mobile CDB-Text CDB-Size-huge u-ellipsis js-title" title="'+__e(title)+'">'+__e(title)+'</h1>\n\n            <div class="CDB-Dashboard-scrollWrapper js-scroll-wrapper">\n              <div class="CDB-Dashboard-scrollContent js-scroll-content">\n                <h2 class="CDB-Dashboard-menuDescription CDB-Text CDB-Size-large is-light u-secondaryTextColor js-description">'+(null==(__t=cdb.core.sanitize.html(description))?"":__t)+'</h2>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n    </div>\n\n    <div class="CDB-Dashboard-menuFooter">\n      <ul>\n        <li class="CDB-Dashboard-menuFooterItem ">\n          <div class="CDB-Dashboard-menuMedia CDB-Dashboard-menuAvatar">\n            <img src="'+__e(userAvatarURL)+'" alt="avatar" class="inline-block"/>\n          </div>\n          <p class="CDB-Text CDB-Size-medium CDB-Dashboard-menuFooterTxt">Map by <a href="'+__e(userProfileURL)+'" target="_blank">'+__e(userName)+'</a></p>\n        </li>\n      </ul>\n    </div>\n  </div>\n  <div class="CDB-Dashboard-bg js-toggle-view"></div>\n\n  <div class="CDB-Dashboard-menuHeaderMobile">\n    <div class="u-flex u-alignStart CDB-Dashboard-menuHeaderMobileInner">\n      <button class="js-toggle-view u-actionTextColor CDB-Dashboard-menuHeaderMobileActions">\n        <i class="CDB-IconFont CDB-Size-medium CDB-IconFont-rArrowLight Size-large"></i>\n      </button>\n      <div class="CDB-Dashboard-menuHeaderMobileText">\n        ',!0===showLogo&&(__p+='\n        <div class="CDB-Dashboard-menuLogo">\n          <a href="http://carto.com" target="_blank">\n          <svg width="62px" height="24px" viewBox="35 63 62 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n              <g class="CDB-EmbedLogo" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(35.000000, 63.000000)">\n                  <path d="M3.94693333,15.9877346 C5.63066667,15.9877346 6.60373333,15.2552013 7.32533333,14.260268 L5.72906667,13.1232013 C5.26986667,13.6808013 4.79973333,14.0525346 4.0016,14.0525346 C2.93013333,14.0525346 2.17573333,13.1560013 2.17573333,12.0080013 L2.17573333,11.9861346 C2.17573333,10.8709346 2.93013333,9.95253464 4.0016,9.95253464 C4.73413333,9.95253464 5.23706667,10.3133346 5.6744,10.849068 L7.27066667,9.6136013 C6.5928,8.68426797 5.58693333,8.02826797 4.02346667,8.02826797 C1.7056,8.02826797 0,9.7776013 0,12.0080013 L0,12.029868 C0,14.3149346 1.76026667,15.9877346 3.94693333,15.9877346 L3.94693333,15.9877346 Z M10.93653,15.834668 L13.1559967,15.834668 L13.7026634,14.457068 L16.6655967,14.457068 L17.2122634,15.834668 L19.4863967,15.834668 L16.2282634,8.12666797 L14.18373,8.12666797 L10.93653,15.834668 Z M14.3258634,12.8061346 L15.1895967,10.6413346 L16.0423967,12.8061346 L14.3258634,12.8061346 Z M23.61653,15.834668 L25.7375966,15.834668 L25.7375966,13.5168013 L26.6778633,13.5168013 L28.2194633,15.834668 L30.6575966,15.834668 L28.83173,13.1669346 C29.78293,12.7624013 30.40613,11.9861346 30.40613,10.8053346 L30.40613,10.783468 C30.40613,10.029068 30.17653,9.4496013 29.7282633,9.00133464 C29.2143966,8.48746797 28.40533,8.18133464 27.2354633,8.18133464 L23.61653,8.18133464 L23.61653,15.834668 Z M25.7375966,11.8549346 L25.7375966,10.0072013 L27.1370633,10.0072013 C27.8367966,10.0072013 28.2850633,10.3133346 28.2850633,10.9256013 L28.2850633,10.947468 C28.2850633,11.505068 27.8586633,11.8549346 27.1479966,11.8549346 L25.7375966,11.8549346 Z M36.7338633,15.834668 L38.8549299,15.834668 L38.8549299,10.0400013 L41.1509299,10.0400013 L41.1509299,8.18133464 L34.4487966,8.18133464 L34.4487966,10.0400013 L36.7338633,10.0400013 L36.7338633,15.834668 Z" class="CDB-EmbedLogo-text" fill="#FFFFFF"></path>\n                  <g class="CDB-EmbedLogo-image" transform="translate(37.000000, 0.000000)">\n                      <circle class="CDB-EmbedLogo-halo" fill="rgba(255, 255, 255, 0.20)"  cx="12.3333333" cy="12" r="12"></circle>\n                      <path d="M12.3333333,16.5 C14.8186147,16.5 16.8333333,14.4852814 16.8333333,12 C16.8333333,9.51471863 14.8186147,7.5 12.3333333,7.5 C9.84805196,7.5 7.83333333,9.51471863 7.83333333,12 C7.83333333,14.4852814 9.84805196,16.5 12.3333333,16.5 L12.3333333,16.5 Z" class="CDB-EmbedLogo-point" fill="#FFFFFF" ></path>\n                  </g>\n              </g>\n          </svg>\n          </a>\n        </div>\n        '),__p+='\n        <p class="CDB-Dashboard-menuTime CDB-Text CDB-Size-small u-upperCase u-altTextColor u-bSpace--m js-timeAgo">UPDATED '+__e(updatedAt)+'</p>\n        <h1 class="CDB-Text CDB-Size-large u-ellipsis js-title u-bSpace--xl u-ellipsis">'+__e(title)+'</h1>\n        <h2 class="CDB-Text CDB-Size-medium u-secondaryTextColor js-description">'+(null==(__t=cdb.core.sanitize.html(description))?"":__t)+"</h2>\n      </div>\n    </div>\n  </div>\n</div>\n";return __p}},905:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="CDB-Widget-canvasInner js-container"></div>\n';return __p}},906:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="CDB-Dashboard-mapWrapper js-map-wrapper">\n  <div class="CDB-Map-canvas">\n    <div class="CDB-Map" id="map"></div>\n  </div>\n</div>\n';return __p}},907:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="CDB-Widget-header js-header"></div>\n<div class="CDB-Widget-content CDB-Widget-content--noSidesMargin">\n  <div class="CDB-Widget-listWrapper js-content"></div>\n</div>\n<div class="CDB-Widget-footer js-footer"></div>\n';return __p}},908:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<button type="button" class="CDB-Widget-listItemInner CDB-Widget-listButton js-button '+__e(isDisabled?"is-disabled":"")+'">\n  <div class="CDB-Widget-contentSpaced">\n    <p class="CDB-Text is-semibold u-upperCase CDB-Size-medium u-ellipsis u-rSpace--xl" title="'+__e(name)+'">'+__e(name)+'</p>\n    <p class="CDB-Text CDB-Size-small u-secondaryTextColor" title="'+__e(value)+'">'+__e(prefix)+__e(formattedValue)+__e(suffix)+'</p>\n  </div>\n  <div class="CDB-Widget-progressBar">\n    <div class="CDB-Widget-progressState '+__e(isAggregated?"CDB-Widget-progressState--pattern":"")+" "+__e(isAccepted?"is-accepted":"")+'" style="width: '+__e(percentage)+"%; background-color: "+__e(color)+'"></div>\n  </div>\n</button>\n';return __p}},909:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="CDB-Widget-listItemInner '+__e(isDisabled?"is-disabled":"")+'">\n  <div class="CDB-Widget-contentSpaced">\n    <p class="CDB-Text is-semibold u-upperCase CDB-Size-medium u-ellipsis u-rSpace--xl" title="'+__e(name)+'">'+__e(name)+'</p>\n    <p class="CDB-Text CDB-Size-small u-secondaryTextColor" title="'+__e(value)+'">'+__e(prefix)+__e(formattedValue)+__e(suffix)+'</p>\n  </div>\n  <div class="CDB-Widget-progressBar">\n    <div class="CDB-Widget-progressState CDB-Widget-progressState--pattern '+__e(isAggregated?"CDB-Widget-progressState--inactive":"")+'"\n      style="width: '+__e(percentage)+"%; background-color: "+__e(color)+'"></div>\n  </div>\n</div>\n';return __p}},910:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<button type="button" class="CDB-Widget-listItemInner CDB-Widget-listItemInner--fullSpace CDB-Widget-listButton js-button '+__e(isDisabled?"is-disabled":"")+'">\n  <span class="CDB-Widget-checkbox '+__e(isDisabled?"":"is-checked")+'"></span>\n  <div class="u-lSpace u-ellipsis">\n    <div class="CDB-Widget-contentSpaced">\n      <p class="CDB-Text is-semibold u-upperCase CDB-Size-medium u-ellipsis u-rSpace--xl" title="'+__e(name)+'">'+__e(name)+'</p>\n      <p class="CDB-Text CDB-Size-small u-secondaryTextColor" title="'+__e(value)+'">'+__e(prefix)+__e(formattedValue)+__e(suffix)+'</p>\n    </div>\n    <div class="CDB-Widget-progressBar">\n      <div class="CDB-Widget-progressState is-accepted" style="width: '+__e(percentage)+'%"></div>\n    </div>\n  </div>\n</button>\n';return __p}},911:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<li class="CDB-Widget-listItem">\n  <h4 class="CDB-Text CDB-Size-large">No results</h4>\n  <p class="CDB-Text CDB-Size-medium u-tSpace-xl u-altTextColor">Your search "'+__e(q)+'" didn\'t match<br/>with any value.</p>\n  <p class="CDB-Text CDB-Size-medium u-tSpace-xl u-altTextColor">Try searching again.</p>\n</li>\n';return __p}},912:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)isSearchEnabled?__p+='\n  <p class="CDB-Text is-semibold CDB-Size-small u-upperCase js-lockCategories">'+__e(totalLocked)+" selected</p>\n":(__p+='\n  <p class="CDB-Text is-semibold CDB-Size-small u-upperCase js-textInfo">\n    ',isLocked?__p+="\n      "+__e(totalCats)+' blocked <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-link u-lSpace js-unlock">unlock</button>\n    ':(__p+="\n      ",noneSelected?__p+="\n        None selected\n      ":(__p+="\n        "+__e(allSelected?"All selected":acceptedCats+" selected")+"\n        ",canBeLocked&&(__p+='\n          <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-link u-lSpace js-lock">lock</button>\n        '),__p+="\n      "),__p+="\n    "),__p+="\n  </p>\n  ",canSelectAll&&(__p+='\n    <div class="CDB-Widget-filterButtons">\n      <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-link CDB-Widget-filterButton js-all">all</button>\n    </div>\n  '),__p+="\n"),__p+="\n";return __p}},913:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="CDB-Widget-contentFlex">\n  <button class="u-rSpace--m CDB-Text is-semibold u-upperCase CDB-Size-small js-searchToggle">\n    <div class="CDB-Shape u-iBlock">\n      <span class="CDB-Shape-magnify is-small is-blue"></span>\n    </div>\n    <span class="u-iBlock u-actionTextColor">\n      search in '+__e(categoriesCount)+" categor"+__e(1===categoriesCount?"y":"ies")+"\n    </span>\n  </button>\n</div>\n\n";return __p}},914:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="CDB-Widget-contentFlex u-rSpace--xl">\n  <button class="CDB-Text is-semibold u-upperCase CDB-Size-small u-rSpace--m js-searchToggle u-actionTextColor">cancel</button>\n</div>\n';return __p}},915:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+=__e(value)+"\n";return __p}},916:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)isSearchEnabled?(__p+="\n    ",isSearchApplied?__p+='\n      <dt class="CDB-Widget-infoCount">'+__e(resultsCount)+'</dt><dd class="CDB-Widget-infoDescription">found</dd>\n    ':__p+="\n      &nbsp;\n    ",__p+="\n  </dt>\n"):__p+='\n  <dt class="CDB-Widget-infoCount">'+__e(nullsPer)+'%</dt><dd class="CDB-Widget-infoDescription"> null rows</dd>\n  <dt class="CDB-Widget-infoCount"><span class="js-cats">'+__e(catsPer)+'</span>%</dt><dd class="CDB-Widget-infoDescription">of total</dd>\n',__p+="\n";return __p}},917:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)isSearchEnabled?(__p+='\n  <form class="CDB-Widget-search js-form">\n    <div class="CDB-Shape CDB-Widget-searchLens u-iBlock u-rSpace js-searchIcon">\n      <span class="CDB-Shape-magnify is-small is-blue"></span>\n    </div>\n    <input type="text" class="CDB-Text CDB-Size-large CDB-Widget-textInput CDB-Widget-searchTextInput js-textInput" value="'+__e(q)+'" placeholder="Search by '+__e(columnName)+'"/>\n    ',canShowApply&&(__p+='\n      <button type="button" class="CDB-Text is-semibold u-upperCase CDB-Size-small CDB-Widget-searchApply js-applyLocked u-actionTextColor">apply</button>\n    '),__p+="\n  </form>\n"):(__p+='\n  <div class="CDB-Widget-title CDB-Widget-contentSpaced js-title">\n    <h3 class="CDB-Text CDB-Size-large u-ellipsis js-titleText" title="'+__e(title)+'">'+__e(title)+'</h3>\n    <div class="CDB-Widget-options CDB-Widget-contentSpaced">\n      ',isAutoStyleEnabled&&(__p+='\n        <button class="CDB-Widget-buttonIcon CDB-Widget-buttonIcon--circle js-colors\n          '+__e(isAutoStyle?"is-selected":"")+"\n          "+__e(isAutoStyle?"js-cancelAutoStyle":"js-autoStyle")+'\n          " data-tooltip="\n            '+__e(isAutoStyle?"Remove Auto style":"Apply Auto Style")+'\n          ">\n          <i class="CDB-IconFont CDB-IconFont-drop CDB-IconFont--small CDB-IconFont--top"></i>\n        </button>\n      '),__p+='\n      <button class="CDB-Shape CDB-Widget-actions js-actions u-lSpace" data-tooltip="More options">\n        <div class="CDB-Shape-threePoints is-blue is-small">\n          <div class="CDB-Shape-threePointsItem"></div>\n          <div class="CDB-Shape-threePointsItem"></div>\n          <div class="CDB-Shape-threePointsItem"></div>\n        </div>\n      </button>\n    </div>\n  </div>\n  ',showSource&&(__p+='\n    <dl class="CDB-Widget-info u-tSpace">\n      <div class="u-flex u-alignCenter">\n        <span class="CDB-Text CDB-Size-small is-semibold u-upperCase" style="color: '+__e(sourceColor)+';">\n          '+__e(sourceId)+"\n        </span>\n\n        ",isSourceType||(__p+='\n          <span class="CDB-Text CDB-Size-small u-lSpace--s u-flex" style="color: '+__e(sourceColor)+';">\n            <i class="CDB-IconFont CDB-IconFont-ray CDB-Size-small"></i>\n          </span>\n        '),__p+='\n\n        <span class="CDB-Text CDB-Size-small u-mainTextColor u-lSpace">\n          '+(null==(__t=sourceType)?"":__t)+'\n        </span>\n\n        <span class="CDB-Text CDB-Size-small u-altTextColor u-ellipsis u-lSpace" title="'+(null==(__t=layerName)?"":__t)+'">\n          '+(null==(__t=layerName)?"":__t)+"\n        </span>\n      </div>\n    </dl>\n  "),__p+="\n"),__p+="\n";return __p}},918:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)__p+='<ul class="CDB-Dropdown-list CDB-Text CDB-Size-medium">\n\n  ',flags.canCollapse&&(__p+='\n    <li class="CDB-Dropdown-item">\n      <button class="CDB-Dropdown-link js-toggleCollapsed">\n        Toggle widget\n          <div class="CDB-Dropdown-toggle">\n          ',collapsed?__p+='\n            <input class="CDB-Toggle js-inputCollapsed" checked="checked" type="checkbox" name="collapsed">\n          ':__p+='\n            <input class="CDB-Toggle js-inputCollapsed" type="checkbox" name="collapsed">\n          ',__p+='\n            <span class="u-iBlock CDB-ToggleFace"></span>\n          </div>\n      </button>\n    </li>\n  '),__p+="\n\n  ",flags.localTimezone&&(__p+='\n  <li class="CDB-Dropdown-item">\n    <button class="CDB-Dropdown-link js-toggleLocalTimezone">\n      Local Time Zone\n      <div class="CDB-Dropdown-toggle">\n        ',local_timezone?__p+='\n          <input class="CDB-Toggle u-iBlock js-localTimezone" checked="checked" type="checkbox" name="localtimezone">\n        ':__p+='\n          <input class="CDB-Toggle u-iBlock js-localTimezone" type="checkbox" name="localtimezone">\n        ',__p+='\n        <span class="u-iBlock CDB-ToggleFace"></span>\n      </div>\n    </button>\n  </li>\n  '),__p+="\n\n  ",flags.normalizeHistogram&&(__p+='\n  <li class="CDB-Dropdown-item">\n    <button class="CDB-Dropdown-link js-toggleNormalized">\n      Show totals\n      <div class="CDB-Dropdown-toggle">\n        ',normalized?__p+='\n          <input class="CDB-Toggle u-iBlock js-inputNormalized" type="checkbox" name="normalized">\n        ':__p+='\n          <input class="CDB-Toggle u-iBlock js-inputNormalized" checked="checked" type="checkbox" name="normalized">\n        ',__p+='\n        <span class="u-iBlock CDB-ToggleFace"></span>\n      </div>\n    </button>\n  </li>\n  '),__p+="\n\n  ",show_options&&(__p+='\n    <li class="CDB-Dropdown-item">\n      <button type="button" class="CDB-Dropdown-link u-ellipsis u-actionTextColor js-editWidget" title="Edit">Edit</button>\n    </li>\n    <li class="CDB-Dropdown-item">\n      <button type="button" class="CDB-Dropdown-link u-ellipsis u-errorTextColor js-removeWidget" title="Delete...">Delete...</button>\n    </li>\n  '),__p+="\n</ul>\n";return __p}},919:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+=__e(prefix)+""+__e(value)+__e(suffix)+"\n";return __p}},920:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="CDB-Widget-listItem--fake"></div>\n';return __p}},921:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="CDB-Widget-header js-header">\n  <div class="CDB-Widget-title CDB-Widget-contentSpaced">\n    <h3 class="CDB-Text CDB-Size-large u-ellipsis js-title '+__e(isCollapsed?"is-collapsed":"")+'">'+__e(title)+'</h3>\n    <div class="CDB-Widget-options">\n      <button class="CDB-Shape CDB-Widget-actions js-actions" data-tooltip="More options">\n        <div class="CDB-Shape-threePoints is-blue is-small">\n          <div class="CDB-Shape-threePointsItem"></div>\n          <div class="CDB-Shape-threePointsItem"></div>\n          <div class="CDB-Shape-threePointsItem"></div>\n        </div>\n      </button>\n    </div>\n  </div>\n  ',showSource&&(__p+='\n    <dl class="CDB-Widget-info u-tSpace">\n      <div class="u-flex u-alignCenter">\n        <span class="CDB-Text CDB-Size-small is-semibold u-upperCase" style="color: '+__e(sourceColor)+';">\n          '+__e(sourceId)+"\n        </span>\n\n        ",isSourceType||(__p+='\n          <span class="CDB-Text CDB-Size-small u-lSpace--s u-flex" style="color: '+__e(sourceColor)+';">\n            <i class="CDB-IconFont CDB-IconFont-ray CDB-Size-small"></i>\n          </span>\n        '),__p+='\n\n        <span class="CDB-Text CDB-Size-small u-mainTextColor u-lSpace">\n          '+(null==(__t=sourceType)?"":__t)+'\n        </span>\n\n        <span class="CDB-Text CDB-Size-small u-altTextColor u-ellipsis u-lSpace" title="'+(null==(__t=layerName)?"":__t)+'">\n          '+(null==(__t=layerName)?"":__t)+"\n        </span>\n      </div>\n    </dl>\n  "),__p+="\n  ",showStats&&(__p+='\n    <dl class="CDB-Widget-info CDB-Text CDB-Size-small u-secondaryTextColor u-upperCase u-tSpace">\n      <dt class="CDB-Widget-infoCount">'+__e(nulls)+'</dt><dd class="CDB-Widget-infoDescription">null rows</dd>\n    </dl>\n  '),__p+='\n</div>\n<div class="CDB-Widget-content CDB-Widget-content--formula">\n  ',_.isNumber(value)?(__p+='\n    <h4 class="CDB-Text CDB-Size-huge '+__e(isCollapsed?"":"js-value")+'" title="'+__e(value)+'">\n      '+__e(prefix)+__e(value)+__e(suffix)+"\n    </h4>\n    ",description&&(__p+='\n      <p class="CDB-Text CDB-Size-small u-tSpace js-description">'+__e(description)+"</p>\n    "),__p+="\n  "):__p+='\n    <div class="CDB-Widget-listItem--fake"></div>\n  ',__p+="\n</div>\n";return __p}},922:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+=__e(value)+" "+__e(suffix)+"\n";return __p}},923:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="CDB-Widget-header js-header">\n  <div class="js-title"></div>\n  ',showSource&&(__p+='\n    <dl class="CDB-Widget-info u-tSpace">\n      <div class="u-flex u-alignCenter">\n        <span class="CDB-Text CDB-Size-small is-semibold u-upperCase" style="color: '+__e(sourceColor)+';">\n          '+__e(sourceId)+"\n        </span>\n\n        ",isSourceType||(__p+='\n          <span class="CDB-Text CDB-Size-small u-lSpace--s u-flex" style="color: '+__e(sourceColor)+';">\n            <i class="CDB-IconFont CDB-IconFont-ray CDB-Size-small"></i>\n          </span>\n        '),__p+='\n\n        <span class="CDB-Text CDB-Size-small u-mainTextColor u-lSpace">\n          '+(null==(__t=sourceType)?"":__t)+'\n        </span>\n\n        <span class="CDB-Text CDB-Size-small u-altTextColor u-ellipsis u-lSpace" title="'+(null==(__t=layerName)?"":__t)+'">\n          '+(null==(__t=layerName)?"":__t)+"\n        </span>\n      </div>\n    </dl>\n  "),__p+="\n  ",showStats&&(__p+='\n    <dl class="CDB-Widget-info CDB-Text CDB-Size-small u-secondaryTextColor u-upperCase u-tSpace">\n      ',showNulls&&(__p+='\n      <dt class="CDB-Widget-infoCount js-nulls">0</dt><dd class="CDB-Widget-infoDescription">NULL ROWS</dd>\n      '),__p+='\n      <dt class="CDB-Widget-infoCount js-min">0</dt><dd class="CDB-Widget-infoDescription">MIN</dd>\n      <dt class="CDB-Widget-infoCount js-avg">0</dt><dd class="CDB-Widget-infoDescription">AVG</dd>\n      <dt class="CDB-Widget-infoCount js-max">0</dt><dd class="CDB-Widget-infoDescription">MAX</dd>\n    </dl>\n  '),__p+='\n</div>\n\n<div class="CDB-Widget-content CDB-Widget-content--histogram js-content">\n  <div class="CDB-Widget-filter CDB-Widget-contentSpaced ">\n    <p class="CDB-Text CDB-Size-small is-semibold u-upperCase js-val">\u2026</p>\n    <div class="CDB-Widget-filterButtons js-filter is-hidden">\n      <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-filterButton js-zoom">zoom</button>\n      <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-filterButton js-clear">clear</button>\n    </div>\n  </div>\n  <div class="js-mini-chart"></div>\n  <div class="CDB-Chart--histogram js-chart"></div>\n</div>\n';return __p}},924:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="CDB-Widget-title CDB-Widget-contentSpaced">\n  <h3 class="CDB-Text CDB-Size-large u-ellipsis" title="'+__e(title)+'">'+__e(title)+'</h3>\n  <div class="CDB-Widget-options CDB-Widget-contentSpaced">\n    ',isAutoStyleEnabled&&(__p+='\n      <button class="CDB-Widget-buttonIcon CDB-Widget-buttonIcon--circle js-sizes\n        '+__e(isAutoStyle?"is-selected":"")+"\n        "+__e(isAutoStyle?"js-cancelAutoStyle":"js-autoStyle")+'\n        " data-tooltip="'+__e(isAutoStyle?"Remove Auto style":"Apply Auto Style")+'">\n        <i class="CDB-IconFont CDB-IconFont-drop CDB-IconFont--small CDB-IconFont--top"></i>\n      </button>\n    '),__p+='\n    <button class="CDB-Shape CDB-Widget-actions js-actions u-lSpace" data-tooltip="More options">\n      <div class="CDB-Shape-threePoints is-blue is-small">\n        <div class="CDB-Shape-threePointsItem"></div>\n        <div class="CDB-Shape-threePointsItem"></div>\n        <div class="CDB-Shape-threePointsItem"></div>\n      </div>\n    </button>\n  </div>\n</div>\n';return __p}},925:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+=__e(value)+" "+__e(suffix)+"\n";return __p}},926:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="CDB-Widget-header js-header">\n  <div class="js-title"></div>\n\n  ',showSource&&(__p+='\n    <div class="CDB-Widget-contentSpaced CDB-Widget-contentFull">\n      <dl class="CDB-Widget-info u-tSpace">\n        <div class="u-flex u-alignCenter">\n          <span class="CDB-Text CDB-Size-small is-semibold u-upperCase" style="color: '+__e(sourceColor)+';">\n            '+__e(sourceId)+"\n          </span>\n\n          ",isSourceType||(__p+='\n            <span class="CDB-Text CDB-Size-small u-lSpace--s u-flex" style="color: '+__e(sourceColor)+';">\n              <i class="CDB-IconFont CDB-IconFont-ray CDB-Size-small"></i>\n            </span>\n          '),__p+='\n\n          <span class="CDB-Text CDB-Size-small u-mainTextColor u-lSpace">\n            '+(null==(__t=sourceType)?"":__t)+'\n          </span>\n\n          <span class="CDB-Text CDB-Size-small u-altTextColor u-ellipsis u-lSpace" title="'+(null==(__t=layerName)?"":__t)+'">\n            '+(null==(__t=layerName)?"":__t)+"\n          </span>\n        </div>\n      </dl>\n    </div>\n  "),__p+='\n</div>\n\n<div class="CDB-Widget-content CDB-Widget-content--timeSeries js-content"></div>\n';return __p}},927:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<p class="CDB-Text CDB-Size-large js-widget-title u-iBlock u-ellipsis u-rSpace">'+__e(title)+'</p>\n<div class="CDB-Widget-contentSpaced--end">\n  <div class="CDB-Widget-options CDB-Widget-contentSpaced">\n    <p class="CDB-Text CDB-Size-small is-semibold u-upperCase u-rSpace--m js-val">\u2026</p>\n\n    ',showSelection&&start&&end&&(__p+='\n      <div class="CDB-Chart-staticTips">\n        <div class="CDB-Chart-staticTip u-iBlock u-rSpace">\n          <p class="CDB-Text CDB-Size-small CDB-Chart-staticTipText">'+(null==(__t=start)?"":__t)+'</p>\n        </div>\n\n        <p class="CDB-Text CDB-Size-small is-semibold u-upperCase u-iBlock u-rSpace">to</p>\n\n        <div class="CDB-Chart-staticTip u-iBlock">\n          <p class="CDB-Text CDB-Size-small CDB-Chart-staticTipText">'+(null==(__t=end)?"":__t)+"</p>\n        </div>\n      </div>\n    "),__p+="\n\n    ",showClearButton&&(__p+='\n      <button class="CDB-Text CDB-Size-small is-semibold u-upperCase u-actionTextColor CDB-Widget-filterButton js-clear">Clear</button>\n    '),__p+='\n    <button class="CDB-Shape CDB-Widget-actions js-actions u-lSpace" data-tooltip="More options">\n      <div class="CDB-Shape-threePoints is-blue is-small">\n        <div class="CDB-Shape-threePointsItem"></div>\n        <div class="CDB-Shape-threePointsItem"></div>\n        <div class="CDB-Shape-threePointsItem"></div>\n      </div>\n    </button>\n  </div>\n</div>\n';return __p}},928:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)__p+='<button class="CDB-Widget-controlButton ',disabled&&(__p+="is-disabled "),__p+='" ',disabled&&(__p+=" disabled "),__p+='>\n    <div class="CDB-Widget-controlButtonContent">\n\n    ',running?__p+='\n        <svg width="6px" height="10px" viewBox="0 0 6 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <g id="Time-series" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n            <g id="Time-Series" transform="translate(-201.000000, -543.000000)" fill="#FFFFFF">\n                <g id="TS---01" transform="translate(168.000000, 432.000000)">\n                    <g id="Torque-bar" transform="translate(24.000000, 100.000000)">\n                        <g id="Button-Pause" transform="translate(0.000000, 4.000000)">\n                            <path d="M9,7 L10,7 L10,17 L9,17 L9,7 Z M14,7 L15,7 L15,17 L14,17 L14,7 Z" id="Combined-Shape"></path>\n                        </g>\n                    </g>\n                </g>\n            </g>\n        </g>\n        </svg>\n    ':__p+='\n        <svg width="9px" height="11px" viewBox="0 0 9 11" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <g id="Time-series" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n            <g id="Time-Series" transform="translate(-200.000000, -279.000000)" fill-rule="nonzero" fill="#FFFFFF">\n                <g id="TS---01" transform="translate(168.000000, 168.000000)">\n                    <g id="Torque-bar" transform="translate(24.000000, 72.000000)">\n                        <g id="Button-Play" transform="translate(0.000000, 32.000000)">\n                            <path d="M15.766443,12.044867 L9.20456553,8.10774058 C8.92171794,7.93803203 9,7.89347968 9,8.22734108 L9,16.2102807 C9,16.5418859 8.92367044,16.4984182 9.20456553,16.3298812 L15.766443,12.3927547 C16.0692969,12.2110424 16.0693051,12.2265843 15.766443,12.044867 Z M16.2809387,11.1873741 C17.23035,11.7570209 17.2319213,12.6796581 16.2809387,13.2502477 L9.71906129,17.1873741 C8.76964995,17.7570209 8,17.3168605 8,16.2102807 L8,8.22734108 C8,7.11806049 8.76807871,6.67965811 9.71906129,7.25024766 L16.2809387,11.1873741 Z" id="Triangle"></path>\n                        </g>\n                    </g>\n                </g>\n            </g>\n        </g>\n        </svg>\n    ',__p+="\n    </div>\n</button>\n";return __p}},929:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="CDB-Widget-contentSpaced CDB-Widget-contentSpaced--end js-torque-controls"></div>\n<div class="CDB-Widget-contentFull">\n  <div class="js-time-series-header"></div>\n</div>\n';return __p}},930:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="CDB-Widget-header js-header">\n  <div class="js-torque-header"></div>\n\n  ',showSource&&(__p+='\n    <div class="CDB-Widget-contentSpaced CDB-Widget-contentFull">\n      <dl class="CDB-Widget-info u-tSpace">\n        <div class="u-flex u-alignCenter">\n          <span class="CDB-Text CDB-Size-small is-semibold u-upperCase" style="color: '+__e(sourceColor)+';">\n            '+__e(sourceId)+"\n          </span>\n\n          ",isSourceType||(__p+='\n            <span class="CDB-Text CDB-Size-small u-lSpace--s u-flex" style="color: '+__e(sourceColor)+';">\n              <i class="CDB-IconFont CDB-IconFont-ray CDB-Size-small"></i>\n            </span>\n          '),__p+='\n\n          <span class="CDB-Text CDB-Size-small u-mainTextColor u-lSpace">\n            '+(null==(__t=sourceType)?"":__t)+'\n          </span>\n\n          <span class="CDB-Text CDB-Size-small u-altTextColor u-ellipsis u-lSpace" title="'+(null==(__t=layerName)?"":__t)+'">\n            '+(null==(__t=layerName)?"":__t)+"\n          </span>\n        </div>\n      </dl>\n    </div>\n  "),__p+="\n</div>\n";return __p}},931:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<p class="CDB-Text CDB-Size-large u-secondaryTextColor u-iBlock">\n  '+__e(time)+"\n</p>\n";return __p}},932:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+=(null==(__t=placeholder)?"":__t)+'\n<button class="CDB-Button CDB-Button--secondary CDB-Button--medium CDB-Widget-errorButton js-refresh">\n  <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium">REFRESH</span>\n</button>\n\n';return __p}},933:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="CDB-Widget-title CDB-Widget-contentSpaced">\n  <h3 class="CDB-Text CDB-Size-large u-ellipsis" title="'+__e(title)+'">'+__e(title)+'</h3>\n</div>\n\n<h2 class="CDB-Text CDB-Size-small is-semibold u-upperCase u-tSpace">'+__e(error)+'</h2>\n\n<div class="CDB-Text CDB-Size-medium u-tSpace-xl">'+__e(message)+"</div>\n\n",refresh?__p+='\n  <button class="CDB-Button CDB-Button--secondary CDB-Button--medium u-tSpace-xl js-refresh">\n    <span class="CDB-Button-Text CDB-Text is-semibold CDB-Size-medium">REFRESH</span>\n  </button>\n':__p+="\n  "+(null==(__t=placeholder)?"":__t)+"\n",__p+="\n\n";return __p}},938:function(e,t){},939:function(e,t){}},[2091]);
//# sourceMappingURL=builder_embed.js.map